<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>WooCommerce Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1626085994">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1626085994">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.svg" alt="WooCommerce" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">WooCommerce Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/automattic.html"><abbr title="\Automattic">Automattic</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/automattic-woocommerce.html"><abbr title="\Automattic\WooCommerce">WooCommerce</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WooCommerce.html"><abbr title="\WooCommerce">WooCommerce</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WooCommerce-Classes.html"><abbr title="\WooCommerce\Classes">Classes</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Abstracts.html"><abbr title="\WooCommerce\Abstracts">Abstracts</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Admin.html"><abbr title="\WooCommerce\Admin">Admin</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Views.html"><abbr title="\WooCommerce\Views">Views</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Helper.html"><abbr title="\WooCommerce\Helper">Helper</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Templates.html"><abbr title="\WooCommerce\Templates">Templates</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Reports.html"><abbr title="\WooCommerce\Reports">Reports</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Blocks.html"><abbr title="\WooCommerce\Blocks">Blocks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-RestApi.html"><abbr title="\WooCommerce\RestApi">RestApi</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-CLI.html"><abbr title="\WooCommerce\CLI">CLI</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-l10n.html"><abbr title="\WooCommerce\l10n">l10n</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Webhooks.html"><abbr title="\WooCommerce\Webhooks">Webhooks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-DataStores.html"><abbr title="\WooCommerce\DataStores">DataStores</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Emails.html"><abbr title="\WooCommerce\Emails">Emails</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Export.html"><abbr title="\WooCommerce\Export">Export</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Gateways.html"><abbr title="\WooCommerce\Gateways">Gateways</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-PayPal.html"><abbr title="\WooCommerce\PayPal">PayPal</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Import.html"><abbr title="\WooCommerce\Import">Import</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Integrations.html"><abbr title="\WooCommerce\Integrations">Integrations</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Interfaces.html"><abbr title="\WooCommerce\Interfaces">Interfaces</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Interface.html"><abbr title="\WooCommerce\Interface">Interface</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-LogHandlers.html"><abbr title="\WooCommerce\LogHandlers">LogHandlers</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-PaymentTokens.html"><abbr title="\WooCommerce\PaymentTokens">PaymentTokens</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Utilities.html"><abbr title="\WooCommerce\Utilities">Utilities</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Shipping.html"><abbr title="\WooCommerce\Shipping">Shipping</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Shortcodes.html"><abbr title="\WooCommerce\Shortcodes">Shortcodes</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Tracks.html"><abbr title="\WooCommerce\Tracks">Tracks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Traits.html"><abbr title="\WooCommerce\Traits">Traits</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Functions.html"><abbr title="\WooCommerce\Functions">Functions</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-WCCom.html"><abbr title="\WooCommerce\WCCom">WCCom</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Widgets.html"><abbr title="\WooCommerce\Widgets">Widgets</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Uninstaller.html"><abbr title="\WooCommerce\Uninstaller">Uninstaller</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WoocommerceAdmin.html"><abbr title="\WoocommerceAdmin">WoocommerceAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WoocommerceNavigation.html"><abbr title="\WoocommerceNavigation">WoocommerceNavigation</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Automattic.html"><abbr title="\Automattic">Automattic</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/Automattic-WooCommerce.html"><abbr title="\Automattic\WooCommerce">WooCommerce</abbr></a></li>
                            </ul>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-wc-install.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * Installation related functions and actions.
 *
 * @package WooCommerce\Classes
 * @version 3.0.0
 */

use Automattic\Jetpack\Constants;
use Automattic\WooCommerce\Internal\WCCom\ConnectionHelper as WCConnectionHelper;

defined( &#039;ABSPATH&#039; ) || exit;

/**
 * WC_Install Class.
 */
class WC_Install {

	/**
	 * DB updates and callbacks that need to be run per version.
	 *
	 * @var array
	 */
	private static $db_updates = array(
		&#039;2.0.0&#039; =&gt; array(
			&#039;wc_update_200_file_paths&#039;,
			&#039;wc_update_200_permalinks&#039;,
			&#039;wc_update_200_subcat_display&#039;,
			&#039;wc_update_200_taxrates&#039;,
			&#039;wc_update_200_line_items&#039;,
			&#039;wc_update_200_images&#039;,
			&#039;wc_update_200_db_version&#039;,
		),
		&#039;2.0.9&#039; =&gt; array(
			&#039;wc_update_209_brazillian_state&#039;,
			&#039;wc_update_209_db_version&#039;,
		),
		&#039;2.1.0&#039; =&gt; array(
			&#039;wc_update_210_remove_pages&#039;,
			&#039;wc_update_210_file_paths&#039;,
			&#039;wc_update_210_db_version&#039;,
		),
		&#039;2.2.0&#039; =&gt; array(
			&#039;wc_update_220_shipping&#039;,
			&#039;wc_update_220_order_status&#039;,
			&#039;wc_update_220_variations&#039;,
			&#039;wc_update_220_attributes&#039;,
			&#039;wc_update_220_db_version&#039;,
		),
		&#039;2.3.0&#039; =&gt; array(
			&#039;wc_update_230_options&#039;,
			&#039;wc_update_230_db_version&#039;,
		),
		&#039;2.4.0&#039; =&gt; array(
			&#039;wc_update_240_options&#039;,
			&#039;wc_update_240_shipping_methods&#039;,
			&#039;wc_update_240_api_keys&#039;,
			&#039;wc_update_240_refunds&#039;,
			&#039;wc_update_240_db_version&#039;,
		),
		&#039;2.4.1&#039; =&gt; array(
			&#039;wc_update_241_variations&#039;,
			&#039;wc_update_241_db_version&#039;,
		),
		&#039;2.5.0&#039; =&gt; array(
			&#039;wc_update_250_currency&#039;,
			&#039;wc_update_250_db_version&#039;,
		),
		&#039;2.6.0&#039; =&gt; array(
			&#039;wc_update_260_options&#039;,
			&#039;wc_update_260_termmeta&#039;,
			&#039;wc_update_260_zones&#039;,
			&#039;wc_update_260_zone_methods&#039;,
			&#039;wc_update_260_refunds&#039;,
			&#039;wc_update_260_db_version&#039;,
		),
		&#039;3.0.0&#039; =&gt; array(
			&#039;wc_update_300_grouped_products&#039;,
			&#039;wc_update_300_settings&#039;,
			&#039;wc_update_300_product_visibility&#039;,
			&#039;wc_update_300_db_version&#039;,
		),
		&#039;3.1.0&#039; =&gt; array(
			&#039;wc_update_310_downloadable_products&#039;,
			&#039;wc_update_310_old_comments&#039;,
			&#039;wc_update_310_db_version&#039;,
		),
		&#039;3.1.2&#039; =&gt; array(
			&#039;wc_update_312_shop_manager_capabilities&#039;,
			&#039;wc_update_312_db_version&#039;,
		),
		&#039;3.2.0&#039; =&gt; array(
			&#039;wc_update_320_mexican_states&#039;,
			&#039;wc_update_320_db_version&#039;,
		),
		&#039;3.3.0&#039; =&gt; array(
			&#039;wc_update_330_image_options&#039;,
			&#039;wc_update_330_webhooks&#039;,
			&#039;wc_update_330_product_stock_status&#039;,
			&#039;wc_update_330_set_default_product_cat&#039;,
			&#039;wc_update_330_clear_transients&#039;,
			&#039;wc_update_330_set_paypal_sandbox_credentials&#039;,
			&#039;wc_update_330_db_version&#039;,
		),
		&#039;3.4.0&#039; =&gt; array(
			&#039;wc_update_340_states&#039;,
			&#039;wc_update_340_state&#039;,
			&#039;wc_update_340_last_active&#039;,
			&#039;wc_update_340_db_version&#039;,
		),
		&#039;3.4.3&#039; =&gt; array(
			&#039;wc_update_343_cleanup_foreign_keys&#039;,
			&#039;wc_update_343_db_version&#039;,
		),
		&#039;3.4.4&#039; =&gt; array(
			&#039;wc_update_344_recreate_roles&#039;,
			&#039;wc_update_344_db_version&#039;,
		),
		&#039;3.5.0&#039; =&gt; array(
			&#039;wc_update_350_reviews_comment_type&#039;,
			&#039;wc_update_350_db_version&#039;,
		),
		&#039;3.5.2&#039; =&gt; array(
			&#039;wc_update_352_drop_download_log_fk&#039;,
		),
		&#039;3.5.4&#039; =&gt; array(
			&#039;wc_update_354_modify_shop_manager_caps&#039;,
			&#039;wc_update_354_db_version&#039;,
		),
		&#039;3.6.0&#039; =&gt; array(
			&#039;wc_update_360_product_lookup_tables&#039;,
			&#039;wc_update_360_term_meta&#039;,
			&#039;wc_update_360_downloadable_product_permissions_index&#039;,
			&#039;wc_update_360_db_version&#039;,
		),
		&#039;3.7.0&#039; =&gt; array(
			&#039;wc_update_370_tax_rate_classes&#039;,
			&#039;wc_update_370_mro_std_currency&#039;,
			&#039;wc_update_370_db_version&#039;,
		),
		&#039;3.9.0&#039; =&gt; array(
			&#039;wc_update_390_move_maxmind_database&#039;,
			&#039;wc_update_390_change_geolocation_database_update_cron&#039;,
			&#039;wc_update_390_db_version&#039;,
		),
		&#039;4.0.0&#039; =&gt; array(
			&#039;wc_update_product_lookup_tables&#039;,
			&#039;wc_update_400_increase_size_of_column&#039;,
			&#039;wc_update_400_reset_action_scheduler_migration_status&#039;,
			&#039;wc_update_400_db_version&#039;,
		),
		&#039;4.4.0&#039; =&gt; array(
			&#039;wc_update_440_insert_attribute_terms_for_variable_products&#039;,
			&#039;wc_update_440_db_version&#039;,
		),
		&#039;4.5.0&#039; =&gt; array(
			&#039;wc_update_450_sanitize_coupons_code&#039;,
			&#039;wc_update_450_db_version&#039;,
		),
		&#039;5.0.0&#039; =&gt; array(
			&#039;wc_update_500_fix_product_review_count&#039;,
			&#039;wc_update_500_db_version&#039;,
		),
	);

	/**
	 * Hook in tabs.
	 */
	public static function init() {
		add_action( &#039;init&#039;, array( __CLASS__, &#039;check_version&#039; ), 5 );
		add_action( &#039;init&#039;, array( __CLASS__, &#039;manual_database_update&#039; ), 20 );
		add_action( &#039;admin_init&#039;, array( __CLASS__, &#039;wc_admin_db_update_notice&#039; ) );
		add_action( &#039;woocommerce_run_update_callback&#039;, array( __CLASS__, &#039;run_update_callback&#039; ) );
		add_action( &#039;admin_init&#039;, array( __CLASS__, &#039;install_actions&#039; ) );
		add_filter( &#039;plugin_action_links_&#039; . WC_PLUGIN_BASENAME, array( __CLASS__, &#039;plugin_action_links&#039; ) );
		add_filter( &#039;plugin_row_meta&#039;, array( __CLASS__, &#039;plugin_row_meta&#039; ), 10, 2 );
		add_filter( &#039;wpmu_drop_tables&#039;, array( __CLASS__, &#039;wpmu_drop_tables&#039; ) );
		add_filter( &#039;cron_schedules&#039;, array( __CLASS__, &#039;cron_schedules&#039; ) );
	}

	/**
	 * Check WooCommerce version and run the updater is required.
	 *
	 * This check is done on all requests and runs if the versions do not match.
	 */
	public static function check_version() {
		if ( ! Constants::is_defined( &#039;IFRAME_REQUEST&#039; ) &amp;&amp; version_compare( get_option( &#039;woocommerce_version&#039; ), WC()-&gt;version, &#039;&lt;&#039; ) ) {
			self::install();
			do_action( &#039;woocommerce_updated&#039; );
		}
	}

	/**
	 * Performan manual database update when triggered by WooCommerce System Tools.
	 *
	 * @since 3.6.5
	 */
	public static function manual_database_update() {
		$blog_id = get_current_blog_id();

		add_action( &#039;wp_&#039; . $blog_id . &#039;_wc_updater_cron&#039;, array( __CLASS__, &#039;run_manual_database_update&#039; ) );
	}

	/**
	 * Add WC Admin based db update notice.
	 *
	 * @since 4.0.0
	 */
	public static function wc_admin_db_update_notice() {
		if (
			WC()-&gt;is_wc_admin_active() &amp;&amp;
			false !== get_option( &#039;woocommerce_admin_install_timestamp&#039; )
		) {
			new WC_Notes_Run_Db_Update();
		}
	}

	/**
	 * Run manual database update.
	 */
	public static function run_manual_database_update() {
		self::update();
	}

	/**
	 * Run an update callback when triggered by ActionScheduler.
	 *
	 * @param string $update_callback Callback name.
	 *
	 * @since 3.6.0
	 */
	public static function run_update_callback( $update_callback ) {
		include_once dirname( __FILE__ ) . &#039;/wc-update-functions.php&#039;;

		if ( is_callable( $update_callback ) ) {
			self::run_update_callback_start( $update_callback );
			$result = (bool) call_user_func( $update_callback );
			self::run_update_callback_end( $update_callback, $result );
		}
	}

	/**
	 * Triggered when a callback will run.
	 *
	 * @since 3.6.0
	 * @param string $callback Callback name.
	 */
	protected static function run_update_callback_start( $callback ) {
		wc_maybe_define_constant( &#039;WC_UPDATING&#039;, true );
	}

	/**
	 * Triggered when a callback has ran.
	 *
	 * @since 3.6.0
	 * @param string $callback Callback name.
	 * @param bool   $result Return value from callback. Non-false need to run again.
	 */
	protected static function run_update_callback_end( $callback, $result ) {
		if ( $result ) {
			WC()-&gt;queue()-&gt;add(
				&#039;woocommerce_run_update_callback&#039;,
				array(
					&#039;update_callback&#039; =&gt; $callback,
				),
				&#039;woocommerce-db-updates&#039;
			);
		}
	}

	/**
	 * Install actions when a update button is clicked within the admin area.
	 *
	 * This function is hooked into admin_init to affect admin only.
	 */
	public static function install_actions() {
		if ( ! empty( $_GET[&#039;do_update_woocommerce&#039;] ) ) { // WPCS: input var ok.
			check_admin_referer( &#039;wc_db_update&#039;, &#039;wc_db_update_nonce&#039; );
			self::update();
			WC_Admin_Notices::add_notice( &#039;update&#039;, true );
		}
	}

	/**
	 * Install WC.
	 */
	public static function install() {
		if ( ! is_blog_installed() ) {
			return;
		}

		// Check if we are not already running this routine.
		if ( &#039;yes&#039; === get_transient( &#039;wc_installing&#039; ) ) {
			return;
		}

		// If we made it till here nothing is running yet, lets set the transient now.
		set_transient( &#039;wc_installing&#039;, &#039;yes&#039;, MINUTE_IN_SECONDS * 10 );
		wc_maybe_define_constant( &#039;WC_INSTALLING&#039;, true );

		WC()-&gt;wpdb_table_fix();
		self::remove_admin_notices();
		self::create_tables();
		self::verify_base_tables();
		self::create_options();
		self::create_roles();
		self::setup_environment();
		self::create_terms();
		self::create_cron_jobs();
		self::create_files();
		self::maybe_create_pages();
		self::maybe_set_activation_transients();
		self::set_paypal_standard_load_eligibility();
		self::update_wc_version();
		self::maybe_update_db_version();

		delete_transient( &#039;wc_installing&#039; );

		do_action( &#039;woocommerce_flush_rewrite_rules&#039; );
		do_action( &#039;woocommerce_installed&#039; );
	}

	/**
	 * Check if all the base tables are present.
	 *
	 * @param bool $modify_notice Whether to modify notice based on if all tables are present.
	 * @param bool $execute       Whether to execute get_schema queries as well.
	 *
	 * @return array List of querues.
	 */
	public static function verify_base_tables( $modify_notice = true, $execute = false ) {
		require_once ABSPATH . &#039;wp-admin/includes/upgrade.php&#039;;

		if ( $execute ) {
			self::create_tables();
		}
		$queries        = dbDelta( self::get_schema(), false );
		$missing_tables = array();
		foreach ( $queries as $table_name =&gt; $result ) {
			if ( &quot;Created table $table_name&quot; === $result ) {
				$missing_tables[] = $table_name;
			}
		}

		if ( 0 &lt; count( $missing_tables ) ) {
			if ( $modify_notice ) {
				WC_Admin_Notices::add_notice( &#039;base_tables_missing&#039; );
			}
			update_option( &#039;woocommerce_schema_missing_tables&#039;, $missing_tables );
		} else {
			if ( $modify_notice ) {
				WC_Admin_Notices::remove_notice( &#039;base_tables_missing&#039; );
			}
			update_option( &#039;woocommerce_schema_version&#039;, WC()-&gt;db_version );
			delete_option( &#039;woocommerce_schema_missing_tables&#039; );
		}
		return $missing_tables;
	}

	/**
	 * Reset any notices added to admin.
	 *
	 * @since 3.2.0
	 */
	private static function remove_admin_notices() {
		include_once dirname( __FILE__ ) . &#039;/admin/class-wc-admin-notices.php&#039;;
		WC_Admin_Notices::remove_all_notices();
	}

	/**
	 * Setup WC environment - post types, taxonomies, endpoints.
	 *
	 * @since 3.2.0
	 */
	private static function setup_environment() {
		WC_Post_types::register_post_types();
		WC_Post_types::register_taxonomies();
		WC()-&gt;query-&gt;init_query_vars();
		WC()-&gt;query-&gt;add_endpoints();
		WC_API::add_endpoint();
		WC_Auth::add_endpoint();
	}

	/**
	 * Is this a brand new WC install?
	 *
	 * A brand new install has no version yet. Also treat empty installs as &#039;new&#039;.
	 *
	 * @since  3.2.0
	 * @return boolean
	 */
	public static function is_new_install() {
		$product_count = array_sum( (array) wp_count_posts( &#039;product&#039; ) );

		return is_null( get_option( &#039;woocommerce_version&#039;, null ) ) || ( 0 === $product_count &amp;&amp; -1 === wc_get_page_id( &#039;shop&#039; ) );
	}

	/**
	 * Is a DB update needed?
	 *
	 * @since  3.2.0
	 * @return boolean
	 */
	public static function needs_db_update() {
		$current_db_version = get_option( &#039;woocommerce_db_version&#039;, null );
		$updates            = self::get_db_update_callbacks();
		$update_versions    = array_keys( $updates );
		usort( $update_versions, &#039;version_compare&#039; );

		return ! is_null( $current_db_version ) &amp;&amp; version_compare( $current_db_version, end( $update_versions ), &#039;&lt;&#039; );
	}

	/**
	 * See if we need to set redirect transients for activation or not.
	 *
	 * @since 4.6.0
	 */
	private static function maybe_set_activation_transients() {
		if ( self::is_new_install() ) {
			set_transient( &#039;_wc_activation_redirect&#039;, 1, 30 );
		}
	}

	/**
	 * See if we need to show or run database updates during install.
	 *
	 * @since 3.2.0
	 */
	private static function maybe_update_db_version() {
		if ( self::needs_db_update() ) {
			if ( apply_filters( &#039;woocommerce_enable_auto_update_db&#039;, false ) ) {
				self::update();
			} else {
				WC_Admin_Notices::add_notice( &#039;update&#039;, true );
			}
		} else {
			self::update_db_version();
		}
	}

	/**
	 * Update WC version to current.
	 */
	private static function update_wc_version() {
		update_option( &#039;woocommerce_version&#039;, WC()-&gt;version );
	}

	/**
	 * Get list of DB update callbacks.
	 *
	 * @since  3.0.0
	 * @return array
	 */
	public static function get_db_update_callbacks() {
		return self::$db_updates;
	}

	/**
	 * Push all needed DB updates to the queue for processing.
	 */
	private static function update() {
		$current_db_version = get_option( &#039;woocommerce_db_version&#039; );
		$loop               = 0;

		foreach ( self::get_db_update_callbacks() as $version =&gt; $update_callbacks ) {
			if ( version_compare( $current_db_version, $version, &#039;&lt;&#039; ) ) {
				foreach ( $update_callbacks as $update_callback ) {
					WC()-&gt;queue()-&gt;schedule_single(
						time() + $loop,
						&#039;woocommerce_run_update_callback&#039;,
						array(
							&#039;update_callback&#039; =&gt; $update_callback,
						),
						&#039;woocommerce-db-updates&#039;
					);
					$loop++;
				}
			}
		}
	}

	/**
	 * Update DB version to current.
	 *
	 * @param string|null $version New WooCommerce DB version or null.
	 */
	public static function update_db_version( $version = null ) {
		update_option( &#039;woocommerce_db_version&#039;, is_null( $version ) ? WC()-&gt;version : $version );
	}

	/**
	 * Add more cron schedules.
	 *
	 * @param array $schedules List of WP scheduled cron jobs.
	 *
	 * @return array
	 */
	public static function cron_schedules( $schedules ) {
		$schedules[&#039;monthly&#039;]     = array(
			&#039;interval&#039; =&gt; 2635200,
			&#039;display&#039;  =&gt; __( &#039;Monthly&#039;, &#039;woocommerce&#039; ),
		);
		$schedules[&#039;fifteendays&#039;] = array(
			&#039;interval&#039; =&gt; 1296000,
			&#039;display&#039;  =&gt; __( &#039;Every 15 Days&#039;, &#039;woocommerce&#039; ),
		);
		return $schedules;
	}

	/**
	 * Create cron jobs (clear them first).
	 */
	private static function create_cron_jobs() {
		wp_clear_scheduled_hook( &#039;woocommerce_scheduled_sales&#039; );
		wp_clear_scheduled_hook( &#039;woocommerce_cancel_unpaid_orders&#039; );
		wp_clear_scheduled_hook( &#039;woocommerce_cleanup_sessions&#039; );
		wp_clear_scheduled_hook( &#039;woocommerce_cleanup_personal_data&#039; );
		wp_clear_scheduled_hook( &#039;woocommerce_cleanup_logs&#039; );
		wp_clear_scheduled_hook( &#039;woocommerce_geoip_updater&#039; );
		wp_clear_scheduled_hook( &#039;woocommerce_tracker_send_event&#039; );

		$ve = get_option( &#039;gmt_offset&#039; ) &gt; 0 ? &#039;-&#039; : &#039;+&#039;;

		wp_schedule_event( strtotime( &#039;00:00 tomorrow &#039; . $ve . absint( get_option( &#039;gmt_offset&#039; ) ) . &#039; HOURS&#039; ), &#039;daily&#039;, &#039;woocommerce_scheduled_sales&#039; );

		$held_duration = get_option( &#039;woocommerce_hold_stock_minutes&#039;, &#039;60&#039; );

		if ( &#039;&#039; !== $held_duration ) {
			$cancel_unpaid_interval = apply_filters( &#039;woocommerce_cancel_unpaid_orders_interval_minutes&#039;, absint( $held_duration ) );
			wp_schedule_single_event( time() + ( absint( $cancel_unpaid_interval ) * 60 ), &#039;woocommerce_cancel_unpaid_orders&#039; );
		}

		// Delay the first run of `woocommerce_cleanup_personal_data` by 10 seconds
		// so it doesn&#039;t occur in the same request. WooCommerce Admin also schedules
		// a daily cron that gets lost due to a race condition. WC_Privacy&#039;s background
		// processing instance updates the cron schedule from within a cron job.
		wp_schedule_event( time() + 10, &#039;daily&#039;, &#039;woocommerce_cleanup_personal_data&#039; );
		wp_schedule_event( time() + ( 3 * HOUR_IN_SECONDS ), &#039;daily&#039;, &#039;woocommerce_cleanup_logs&#039; );
		wp_schedule_event( time() + ( 6 * HOUR_IN_SECONDS ), &#039;twicedaily&#039;, &#039;woocommerce_cleanup_sessions&#039; );
		wp_schedule_event( time() + MINUTE_IN_SECONDS, &#039;fifteendays&#039;, &#039;woocommerce_geoip_updater&#039; );
		wp_schedule_event( time() + 10, apply_filters( &#039;woocommerce_tracker_event_recurrence&#039;, &#039;daily&#039; ), &#039;woocommerce_tracker_send_event&#039; );
	}

	/**
	 * Create pages on installation.
	 */
	public static function maybe_create_pages() {
		if ( empty( get_option( &#039;woocommerce_db_version&#039; ) ) ) {
			self::create_pages();
		}
	}

	/**
	 * Create pages that the plugin relies on, storing page IDs in variables.
	 */
	public static function create_pages() {
		include_once dirname( __FILE__ ) . &#039;/admin/wc-admin-functions.php&#039;;

		$pages = apply_filters(
			&#039;woocommerce_create_pages&#039;,
			array(
				&#039;shop&#039;      =&gt; array(
					&#039;name&#039;    =&gt; _x( &#039;shop&#039;, &#039;Page slug&#039;, &#039;woocommerce&#039; ),
					&#039;title&#039;   =&gt; _x( &#039;Shop&#039;, &#039;Page title&#039;, &#039;woocommerce&#039; ),
					&#039;content&#039; =&gt; &#039;&#039;,
				),
				&#039;cart&#039;      =&gt; array(
					&#039;name&#039;    =&gt; _x( &#039;cart&#039;, &#039;Page slug&#039;, &#039;woocommerce&#039; ),
					&#039;title&#039;   =&gt; _x( &#039;Cart&#039;, &#039;Page title&#039;, &#039;woocommerce&#039; ),
					&#039;content&#039; =&gt; &#039;&lt;!-- wp:shortcode --&gt;[&#039; . apply_filters( &#039;woocommerce_cart_shortcode_tag&#039;, &#039;woocommerce_cart&#039; ) . &#039;]&lt;!-- /wp:shortcode --&gt;&#039;,
				),
				&#039;checkout&#039;  =&gt; array(
					&#039;name&#039;    =&gt; _x( &#039;checkout&#039;, &#039;Page slug&#039;, &#039;woocommerce&#039; ),
					&#039;title&#039;   =&gt; _x( &#039;Checkout&#039;, &#039;Page title&#039;, &#039;woocommerce&#039; ),
					&#039;content&#039; =&gt; &#039;&lt;!-- wp:shortcode --&gt;[&#039; . apply_filters( &#039;woocommerce_checkout_shortcode_tag&#039;, &#039;woocommerce_checkout&#039; ) . &#039;]&lt;!-- /wp:shortcode --&gt;&#039;,
				),
				&#039;myaccount&#039; =&gt; array(
					&#039;name&#039;    =&gt; _x( &#039;my-account&#039;, &#039;Page slug&#039;, &#039;woocommerce&#039; ),
					&#039;title&#039;   =&gt; _x( &#039;My account&#039;, &#039;Page title&#039;, &#039;woocommerce&#039; ),
					&#039;content&#039; =&gt; &#039;&lt;!-- wp:shortcode --&gt;[&#039; . apply_filters( &#039;woocommerce_my_account_shortcode_tag&#039;, &#039;woocommerce_my_account&#039; ) . &#039;]&lt;!-- /wp:shortcode --&gt;&#039;,
				),
			)
		);

		foreach ( $pages as $key =&gt; $page ) {
			wc_create_page( esc_sql( $page[&#039;name&#039;] ), &#039;woocommerce_&#039; . $key . &#039;_page_id&#039;, $page[&#039;title&#039;], $page[&#039;content&#039;], ! empty( $page[&#039;parent&#039;] ) ? wc_get_page_id( $page[&#039;parent&#039;] ) : &#039;&#039; );
		}
	}

	/**
	 * Default options.
	 *
	 * Sets up the default options used on the settings page.
	 */
	private static function create_options() {
		// Include settings so that we can run through defaults.
		include_once dirname( __FILE__ ) . &#039;/admin/class-wc-admin-settings.php&#039;;

		$settings = WC_Admin_Settings::get_settings_pages();

		foreach ( $settings as $section ) {
			if ( ! method_exists( $section, &#039;get_settings&#039; ) ) {
				continue;
			}
			$subsections = array_unique( array_merge( array( &#039;&#039; ), array_keys( $section-&gt;get_sections() ) ) );

			/**
			 * We are using &#039;WC_Settings_Page::get_settings&#039; on purpose even thought it&#039;s deprecated.
			 * See the method documentation for an explanation.
			 */

			foreach ( $subsections as $subsection ) {
				foreach ( $section-&gt;get_settings( $subsection ) as $value ) {
					if ( isset( $value[&#039;default&#039;] ) &amp;&amp; isset( $value[&#039;id&#039;] ) ) {
						$autoload = isset( $value[&#039;autoload&#039;] ) ? (bool) $value[&#039;autoload&#039;] : true;
						add_option( $value[&#039;id&#039;], $value[&#039;default&#039;], &#039;&#039;, ( $autoload ? &#039;yes&#039; : &#039;no&#039; ) );
					}
				}
			}
		}

		// Define other defaults if not in setting screens.
		add_option( &#039;woocommerce_single_image_width&#039;, &#039;600&#039;, &#039;&#039;, &#039;yes&#039; );
		add_option( &#039;woocommerce_thumbnail_image_width&#039;, &#039;300&#039;, &#039;&#039;, &#039;yes&#039; );
		add_option( &#039;woocommerce_checkout_highlight_required_fields&#039;, &#039;yes&#039;, &#039;&#039;, &#039;yes&#039; );
		add_option( &#039;woocommerce_demo_store&#039;, &#039;no&#039;, &#039;&#039;, &#039;no&#039; );

		if ( self::is_new_install() ) {
			// Define initial tax classes.
			WC_Tax::create_tax_class( __( &#039;Reduced rate&#039;, &#039;woocommerce&#039; ) );
			WC_Tax::create_tax_class( __( &#039;Zero rate&#039;, &#039;woocommerce&#039; ) );
		}
	}

	/**
	 * Add the default terms for WC taxonomies - product types and order statuses. Modify this at your own risk.
	 */
	public static function create_terms() {
		$taxonomies = array(
			&#039;product_type&#039;       =&gt; array(
				&#039;simple&#039;,
				&#039;grouped&#039;,
				&#039;variable&#039;,
				&#039;external&#039;,
			),
			&#039;product_visibility&#039; =&gt; array(
				&#039;exclude-from-search&#039;,
				&#039;exclude-from-catalog&#039;,
				&#039;featured&#039;,
				&#039;outofstock&#039;,
				&#039;rated-1&#039;,
				&#039;rated-2&#039;,
				&#039;rated-3&#039;,
				&#039;rated-4&#039;,
				&#039;rated-5&#039;,
			),
		);

		foreach ( $taxonomies as $taxonomy =&gt; $terms ) {
			foreach ( $terms as $term ) {
				if ( ! get_term_by( &#039;name&#039;, $term, $taxonomy ) ) { // @codingStandardsIgnoreLine.
					wp_insert_term( $term, $taxonomy );
				}
			}
		}

		$woocommerce_default_category = (int) get_option( &#039;default_product_cat&#039;, 0 );

		if ( ! $woocommerce_default_category || ! term_exists( $woocommerce_default_category, &#039;product_cat&#039; ) ) {
			$default_product_cat_id   = 0;
			$default_product_cat_slug = sanitize_title( _x( &#039;Uncategorized&#039;, &#039;Default category slug&#039;, &#039;woocommerce&#039; ) );
			$default_product_cat      = get_term_by( &#039;slug&#039;, $default_product_cat_slug, &#039;product_cat&#039; ); // @codingStandardsIgnoreLine.

			if ( $default_product_cat ) {
				$default_product_cat_id = absint( $default_product_cat-&gt;term_taxonomy_id );
			} else {
				$result = wp_insert_term( _x( &#039;Uncategorized&#039;, &#039;Default category slug&#039;, &#039;woocommerce&#039; ), &#039;product_cat&#039;, array( &#039;slug&#039; =&gt; $default_product_cat_slug ) );

				if ( ! is_wp_error( $result ) &amp;&amp; ! empty( $result[&#039;term_taxonomy_id&#039;] ) ) {
					$default_product_cat_id = absint( $result[&#039;term_taxonomy_id&#039;] );
				}
			}

			if ( $default_product_cat_id ) {
				update_option( &#039;default_product_cat&#039;, $default_product_cat_id );
			}
		}
	}

	/**
	 * Set up the database tables which the plugin needs to function.
	 * WARNING: If you are modifying this method, make sure that its safe to call regardless of the state of database.
	 *
	 * This is called from `install` method and is executed in-sync when WC is installed or updated. This can also be called optionally from `verify_base_tables`.
	 *
	 * TODO: Add all crucial tables that we have created from workers in the past.
	 *
	 * Tables:
	 *      woocommerce_attribute_taxonomies - Table for storing attribute taxonomies - these are user defined
	 *      woocommerce_downloadable_product_permissions - Table for storing user and guest download permissions.
	 *          KEY(order_id, product_id, download_id) used for organizing downloads on the My Account page
	 *      woocommerce_order_items - Order line items are stored in a table to make them easily queryable for reports
	 *      woocommerce_order_itemmeta - Order line item meta is stored in a table for storing extra data.
	 *      woocommerce_tax_rates - Tax Rates are stored inside 2 tables making tax queries simple and efficient.
	 *      woocommerce_tax_rate_locations - Each rate can be applied to more than one postcode/city hence the second table.
	 */
	private static function create_tables() {
		global $wpdb;

		$wpdb-&gt;hide_errors();

		require_once ABSPATH . &#039;wp-admin/includes/upgrade.php&#039;;

		/**
		 * Before updating with DBDELTA, remove any primary keys which could be
		 * modified due to schema updates.
		 */
		if ( $wpdb-&gt;get_var( &quot;SHOW TABLES LIKE &#039;{$wpdb-&gt;prefix}woocommerce_downloadable_product_permissions&#039;;&quot; ) ) {
			if ( ! $wpdb-&gt;get_var( &quot;SHOW COLUMNS FROM `{$wpdb-&gt;prefix}woocommerce_downloadable_product_permissions` LIKE &#039;permission_id&#039;;&quot; ) ) {
				$wpdb-&gt;query( &quot;ALTER TABLE {$wpdb-&gt;prefix}woocommerce_downloadable_product_permissions DROP PRIMARY KEY, ADD `permission_id` BIGINT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT;&quot; );
			}
		}

		/**
		 * Change wp_woocommerce_sessions schema to use a bigint auto increment field instead of char(32) field as
		 * the primary key as it is not a good practice to use a char(32) field as the primary key of a table and as
		 * there were reports of issues with this table (see https://github.com/woocommerce/woocommerce/issues/20912).
		 *
		 * This query needs to run before dbDelta() as this WP function is not able to handle primary key changes
		 * (see https://github.com/woocommerce/woocommerce/issues/21534 and https://core.trac.wordpress.org/ticket/40357).
		 */
		if ( $wpdb-&gt;get_var( &quot;SHOW TABLES LIKE &#039;{$wpdb-&gt;prefix}woocommerce_sessions&#039;&quot; ) ) {
			if ( ! $wpdb-&gt;get_var( &quot;SHOW KEYS FROM {$wpdb-&gt;prefix}woocommerce_sessions WHERE Key_name = &#039;PRIMARY&#039; AND Column_name = &#039;session_id&#039;&quot; ) ) {
				$wpdb-&gt;query(
					&quot;ALTER TABLE `{$wpdb-&gt;prefix}woocommerce_sessions` DROP PRIMARY KEY, DROP KEY `session_id`, ADD PRIMARY KEY(`session_id`), ADD UNIQUE KEY(`session_key`)&quot;
				);
			}
		}

		dbDelta( self::get_schema() );

		$index_exists = $wpdb-&gt;get_row( &quot;SHOW INDEX FROM {$wpdb-&gt;comments} WHERE column_name = &#039;comment_type&#039; and key_name = &#039;woo_idx_comment_type&#039;&quot; );

		if ( is_null( $index_exists ) ) {
			// Add an index to the field comment_type to improve the response time of the query
			// used by WC_Comments::wp_count_comments() to get the number of comments by type.
			$wpdb-&gt;query( &quot;ALTER TABLE {$wpdb-&gt;comments} ADD INDEX woo_idx_comment_type (comment_type)&quot; );
		}

		// Get tables data types and check it matches before adding constraint.
		$download_log_columns     = $wpdb-&gt;get_results( &quot;SHOW COLUMNS FROM {$wpdb-&gt;prefix}wc_download_log WHERE Field = &#039;permission_id&#039;&quot;, ARRAY_A );
		$download_log_column_type = &#039;&#039;;
		if ( isset( $download_log_columns[0][&#039;Type&#039;] ) ) {
			$download_log_column_type = $download_log_columns[0][&#039;Type&#039;];
		}

		$download_permissions_columns     = $wpdb-&gt;get_results( &quot;SHOW COLUMNS FROM {$wpdb-&gt;prefix}woocommerce_downloadable_product_permissions WHERE Field = &#039;permission_id&#039;&quot;, ARRAY_A );
		$download_permissions_column_type = &#039;&#039;;
		if ( isset( $download_permissions_columns[0][&#039;Type&#039;] ) ) {
			$download_permissions_column_type = $download_permissions_columns[0][&#039;Type&#039;];
		}

		// Add constraint to download logs if the columns matches.
		if ( ! empty( $download_permissions_column_type ) &amp;&amp; ! empty( $download_log_column_type ) &amp;&amp; $download_permissions_column_type === $download_log_column_type ) {
			$fk_result = $wpdb-&gt;get_row( &quot;SHOW CREATE TABLE {$wpdb-&gt;prefix}wc_download_log&quot; );
			if ( false === strpos( $fk_result-&gt;{&#039;Create Table&#039;}, &quot;fk_{$wpdb-&gt;prefix}wc_download_log_permission_id&quot; ) ) {
				$wpdb-&gt;query(
					&quot;ALTER TABLE `{$wpdb-&gt;prefix}wc_download_log`
					ADD CONSTRAINT `fk_{$wpdb-&gt;prefix}wc_download_log_permission_id`
					FOREIGN KEY (`permission_id`)
					REFERENCES `{$wpdb-&gt;prefix}woocommerce_downloadable_product_permissions` (`permission_id`) ON DELETE CASCADE;&quot;
				);
			}
		}

		// Clear table caches.
		delete_transient( &#039;wc_attribute_taxonomies&#039; );
	}

	/**
	 * Get Table schema.
	 *
	 * See https://github.com/woocommerce/woocommerce/wiki/Database-Description/
	 *
	 * A note on indexes; Indexes have a maximum size of 767 bytes. Historically, we haven&#039;t need to be concerned about that.
	 * As of WordPress 4.2, however, we moved to utf8mb4, which uses 4 bytes per character. This means that an index which
	 * used to have room for floor(767/3) = 255 characters, now only has room for floor(767/4) = 191 characters.
	 *
	 * Changing indexes may cause duplicate index notices in logs due to https://core.trac.wordpress.org/ticket/34870 but dropping
	 * indexes first causes too much load on some servers/larger DB.
	 *
	 * When adding or removing a table, make sure to update the list of tables in WC_Install::get_tables().
	 *
	 * @return string
	 */
	private static function get_schema() {
		global $wpdb;

		$collate = &#039;&#039;;

		if ( $wpdb-&gt;has_cap( &#039;collation&#039; ) ) {
			$collate = $wpdb-&gt;get_charset_collate();
		}

		/*
		 * Indexes have a maximum size of 767 bytes. Historically, we haven&#039;t need to be concerned about that.
		 * As of WP 4.2, however, they moved to utf8mb4, which uses 4 bytes per character. This means that an index which
		 * used to have room for floor(767/3) = 255 characters, now only has room for floor(767/4) = 191 characters.
		 */
		$max_index_length = 191;

		$tables = &quot;
CREATE TABLE {$wpdb-&gt;prefix}woocommerce_sessions (
  session_id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  session_key char(32) NOT NULL,
  session_value longtext NOT NULL,
  session_expiry BIGINT UNSIGNED NOT NULL,
  PRIMARY KEY  (session_id),
  UNIQUE KEY session_key (session_key)
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}woocommerce_api_keys (
  key_id BIGINT UNSIGNED NOT NULL auto_increment,
  user_id BIGINT UNSIGNED NOT NULL,
  description varchar(200) NULL,
  permissions varchar(10) NOT NULL,
  consumer_key char(64) NOT NULL,
  consumer_secret char(43) NOT NULL,
  nonces longtext NULL,
  truncated_key char(7) NOT NULL,
  last_access datetime NULL default null,
  PRIMARY KEY  (key_id),
  KEY consumer_key (consumer_key),
  KEY consumer_secret (consumer_secret)
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}woocommerce_attribute_taxonomies (
  attribute_id BIGINT UNSIGNED NOT NULL auto_increment,
  attribute_name varchar(200) NOT NULL,
  attribute_label varchar(200) NULL,
  attribute_type varchar(20) NOT NULL,
  attribute_orderby varchar(20) NOT NULL,
  attribute_public int(1) NOT NULL DEFAULT 1,
  PRIMARY KEY  (attribute_id),
  KEY attribute_name (attribute_name(20))
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}woocommerce_downloadable_product_permissions (
  permission_id BIGINT UNSIGNED NOT NULL auto_increment,
  download_id varchar(36) NOT NULL,
  product_id BIGINT UNSIGNED NOT NULL,
  order_id BIGINT UNSIGNED NOT NULL DEFAULT 0,
  order_key varchar(200) NOT NULL,
  user_email varchar(200) NOT NULL,
  user_id BIGINT UNSIGNED NULL,
  downloads_remaining varchar(9) NULL,
  access_granted datetime NOT NULL default &#039;0000-00-00 00:00:00&#039;,
  access_expires datetime NULL default null,
  download_count BIGINT UNSIGNED NOT NULL DEFAULT 0,
  PRIMARY KEY  (permission_id),
  KEY download_order_key_product (product_id,order_id,order_key(16),download_id),
  KEY download_order_product (download_id,order_id,product_id),
  KEY order_id (order_id),
  KEY user_order_remaining_expires (user_id,order_id,downloads_remaining,access_expires)
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}woocommerce_order_items (
  order_item_id BIGINT UNSIGNED NOT NULL auto_increment,
  order_item_name TEXT NOT NULL,
  order_item_type varchar(200) NOT NULL DEFAULT &#039;&#039;,
  order_id BIGINT UNSIGNED NOT NULL,
  PRIMARY KEY  (order_item_id),
  KEY order_id (order_id)
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}woocommerce_order_itemmeta (
  meta_id BIGINT UNSIGNED NOT NULL auto_increment,
  order_item_id BIGINT UNSIGNED NOT NULL,
  meta_key varchar(255) default NULL,
  meta_value longtext NULL,
  PRIMARY KEY  (meta_id),
  KEY order_item_id (order_item_id),
  KEY meta_key (meta_key(32))
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}woocommerce_tax_rates (
  tax_rate_id BIGINT UNSIGNED NOT NULL auto_increment,
  tax_rate_country varchar(2) NOT NULL DEFAULT &#039;&#039;,
  tax_rate_state varchar(200) NOT NULL DEFAULT &#039;&#039;,
  tax_rate varchar(8) NOT NULL DEFAULT &#039;&#039;,
  tax_rate_name varchar(200) NOT NULL DEFAULT &#039;&#039;,
  tax_rate_priority BIGINT UNSIGNED NOT NULL,
  tax_rate_compound int(1) NOT NULL DEFAULT 0,
  tax_rate_shipping int(1) NOT NULL DEFAULT 1,
  tax_rate_order BIGINT UNSIGNED NOT NULL,
  tax_rate_class varchar(200) NOT NULL DEFAULT &#039;&#039;,
  PRIMARY KEY  (tax_rate_id),
  KEY tax_rate_country (tax_rate_country),
  KEY tax_rate_state (tax_rate_state(2)),
  KEY tax_rate_class (tax_rate_class(10)),
  KEY tax_rate_priority (tax_rate_priority)
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}woocommerce_tax_rate_locations (
  location_id BIGINT UNSIGNED NOT NULL auto_increment,
  location_code varchar(200) NOT NULL,
  tax_rate_id BIGINT UNSIGNED NOT NULL,
  location_type varchar(40) NOT NULL,
  PRIMARY KEY  (location_id),
  KEY tax_rate_id (tax_rate_id),
  KEY location_type_code (location_type(10),location_code(20))
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}woocommerce_shipping_zones (
  zone_id BIGINT UNSIGNED NOT NULL auto_increment,
  zone_name varchar(200) NOT NULL,
  zone_order BIGINT UNSIGNED NOT NULL,
  PRIMARY KEY  (zone_id)
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}woocommerce_shipping_zone_locations (
  location_id BIGINT UNSIGNED NOT NULL auto_increment,
  zone_id BIGINT UNSIGNED NOT NULL,
  location_code varchar(200) NOT NULL,
  location_type varchar(40) NOT NULL,
  PRIMARY KEY  (location_id),
  KEY location_id (location_id),
  KEY location_type_code (location_type(10),location_code(20))
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}woocommerce_shipping_zone_methods (
  zone_id BIGINT UNSIGNED NOT NULL,
  instance_id BIGINT UNSIGNED NOT NULL auto_increment,
  method_id varchar(200) NOT NULL,
  method_order BIGINT UNSIGNED NOT NULL,
  is_enabled tinyint(1) NOT NULL DEFAULT &#039;1&#039;,
  PRIMARY KEY  (instance_id)
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}woocommerce_payment_tokens (
  token_id BIGINT UNSIGNED NOT NULL auto_increment,
  gateway_id varchar(200) NOT NULL,
  token text NOT NULL,
  user_id BIGINT UNSIGNED NOT NULL DEFAULT &#039;0&#039;,
  type varchar(200) NOT NULL,
  is_default tinyint(1) NOT NULL DEFAULT &#039;0&#039;,
  PRIMARY KEY  (token_id),
  KEY user_id (user_id)
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}woocommerce_payment_tokenmeta (
  meta_id BIGINT UNSIGNED NOT NULL auto_increment,
  payment_token_id BIGINT UNSIGNED NOT NULL,
  meta_key varchar(255) NULL,
  meta_value longtext NULL,
  PRIMARY KEY  (meta_id),
  KEY payment_token_id (payment_token_id),
  KEY meta_key (meta_key(32))
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}woocommerce_log (
  log_id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  timestamp datetime NOT NULL,
  level smallint(4) NOT NULL,
  source varchar(200) NOT NULL,
  message longtext NOT NULL,
  context longtext NULL,
  PRIMARY KEY (log_id),
  KEY level (level)
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}wc_webhooks (
  webhook_id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  status varchar(200) NOT NULL,
  name text NOT NULL,
  user_id BIGINT UNSIGNED NOT NULL,
  delivery_url text NOT NULL,
  secret text NOT NULL,
  topic varchar(200) NOT NULL,
  date_created datetime NOT NULL DEFAULT &#039;0000-00-00 00:00:00&#039;,
  date_created_gmt datetime NOT NULL DEFAULT &#039;0000-00-00 00:00:00&#039;,
  date_modified datetime NOT NULL DEFAULT &#039;0000-00-00 00:00:00&#039;,
  date_modified_gmt datetime NOT NULL DEFAULT &#039;0000-00-00 00:00:00&#039;,
  api_version smallint(4) NOT NULL,
  failure_count smallint(10) NOT NULL DEFAULT &#039;0&#039;,
  pending_delivery tinyint(1) NOT NULL DEFAULT &#039;0&#039;,
  PRIMARY KEY  (webhook_id),
  KEY user_id (user_id)
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}wc_download_log (
  download_log_id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  timestamp datetime NOT NULL,
  permission_id BIGINT UNSIGNED NOT NULL,
  user_id BIGINT UNSIGNED NULL,
  user_ip_address VARCHAR(100) NULL DEFAULT &#039;&#039;,
  PRIMARY KEY  (download_log_id),
  KEY permission_id (permission_id),
  KEY timestamp (timestamp)
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}wc_product_meta_lookup (
  `product_id` bigint(20) NOT NULL,
  `sku` varchar(100) NULL default &#039;&#039;,
  `virtual` tinyint(1) NULL default 0,
  `downloadable` tinyint(1) NULL default 0,
  `min_price` decimal(19,4) NULL default NULL,
  `max_price` decimal(19,4) NULL default NULL,
  `onsale` tinyint(1) NULL default 0,
  `stock_quantity` double NULL default NULL,
  `stock_status` varchar(100) NULL default &#039;instock&#039;,
  `rating_count` bigint(20) NULL default 0,
  `average_rating` decimal(3,2) NULL default 0.00,
  `total_sales` bigint(20) NULL default 0,
  `tax_status` varchar(100) NULL default &#039;taxable&#039;,
  `tax_class` varchar(100) NULL default &#039;&#039;,
  PRIMARY KEY  (`product_id`),
  KEY `virtual` (`virtual`),
  KEY `downloadable` (`downloadable`),
  KEY `stock_status` (`stock_status`),
  KEY `stock_quantity` (`stock_quantity`),
  KEY `onsale` (`onsale`),
  KEY min_max_price (`min_price`, `max_price`)
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}wc_tax_rate_classes (
  tax_rate_class_id BIGINT UNSIGNED NOT NULL auto_increment,
  name varchar(200) NOT NULL DEFAULT &#039;&#039;,
  slug varchar(200) NOT NULL DEFAULT &#039;&#039;,
  PRIMARY KEY  (tax_rate_class_id),
  UNIQUE KEY slug (slug($max_index_length))
) $collate;
CREATE TABLE {$wpdb-&gt;prefix}wc_reserved_stock (
	`order_id` bigint(20) NOT NULL,
	`product_id` bigint(20) NOT NULL,
	`stock_quantity` double NOT NULL DEFAULT 0,
	`timestamp` datetime NOT NULL DEFAULT &#039;0000-00-00 00:00:00&#039;,
	`expires` datetime NOT NULL DEFAULT &#039;0000-00-00 00:00:00&#039;,
	PRIMARY KEY  (`order_id`, `product_id`)
) $collate;
		&quot;;

		return $tables;
	}

	/**
	 * Return a list of WooCommerce tables. Used to make sure all WC tables are dropped when uninstalling the plugin
	 * in a single site or multi site environment.
	 *
	 * @return array WC tables.
	 */
	public static function get_tables() {
		global $wpdb;

		$tables = array(
			&quot;{$wpdb-&gt;prefix}wc_download_log&quot;,
			&quot;{$wpdb-&gt;prefix}wc_product_meta_lookup&quot;,
			&quot;{$wpdb-&gt;prefix}wc_tax_rate_classes&quot;,
			&quot;{$wpdb-&gt;prefix}wc_webhooks&quot;,
			&quot;{$wpdb-&gt;prefix}woocommerce_api_keys&quot;,
			&quot;{$wpdb-&gt;prefix}woocommerce_attribute_taxonomies&quot;,
			&quot;{$wpdb-&gt;prefix}woocommerce_downloadable_product_permissions&quot;,
			&quot;{$wpdb-&gt;prefix}woocommerce_log&quot;,
			&quot;{$wpdb-&gt;prefix}woocommerce_order_itemmeta&quot;,
			&quot;{$wpdb-&gt;prefix}woocommerce_order_items&quot;,
			&quot;{$wpdb-&gt;prefix}woocommerce_payment_tokenmeta&quot;,
			&quot;{$wpdb-&gt;prefix}woocommerce_payment_tokens&quot;,
			&quot;{$wpdb-&gt;prefix}woocommerce_sessions&quot;,
			&quot;{$wpdb-&gt;prefix}woocommerce_shipping_zone_locations&quot;,
			&quot;{$wpdb-&gt;prefix}woocommerce_shipping_zone_methods&quot;,
			&quot;{$wpdb-&gt;prefix}woocommerce_shipping_zones&quot;,
			&quot;{$wpdb-&gt;prefix}woocommerce_tax_rate_locations&quot;,
			&quot;{$wpdb-&gt;prefix}woocommerce_tax_rates&quot;,
			&quot;{$wpdb-&gt;prefix}wc_reserved_stock&quot;,
		);

		/**
		 * Filter the list of known WooCommerce tables.
		 *
		 * If WooCommerce plugins need to add new tables, they can inject them here.
		 *
		 * @param array $tables An array of WooCommerce-specific database table names.
		 */
		$tables = apply_filters( &#039;woocommerce_install_get_tables&#039;, $tables );

		return $tables;
	}

	/**
	 * Drop WooCommerce tables.
	 *
	 * @return void
	 */
	public static function drop_tables() {
		global $wpdb;

		$tables = self::get_tables();

		foreach ( $tables as $table ) {
			$wpdb-&gt;query( &quot;DROP TABLE IF EXISTS {$table}&quot; ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared
		}
	}

	/**
	 * Uninstall tables when MU blog is deleted.
	 *
	 * @param array $tables List of tables that will be deleted by WP.
	 *
	 * @return string[]
	 */
	public static function wpmu_drop_tables( $tables ) {
		return array_merge( $tables, self::get_tables() );
	}

	/**
	 * Create roles and capabilities.
	 */
	public static function create_roles() {
		global $wp_roles;

		if ( ! class_exists( &#039;WP_Roles&#039; ) ) {
			return;
		}

		if ( ! isset( $wp_roles ) ) {
			$wp_roles = new WP_Roles(); // @codingStandardsIgnoreLine
		}

		// Dummy gettext calls to get strings in the catalog.
		/* translators: user role */
		_x( &#039;Customer&#039;, &#039;User role&#039;, &#039;woocommerce&#039; );
		/* translators: user role */
		_x( &#039;Shop manager&#039;, &#039;User role&#039;, &#039;woocommerce&#039; );

		// Customer role.
		add_role(
			&#039;customer&#039;,
			&#039;Customer&#039;,
			array(
				&#039;read&#039; =&gt; true,
			)
		);

		// Shop manager role.
		add_role(
			&#039;shop_manager&#039;,
			&#039;Shop manager&#039;,
			array(
				&#039;level_9&#039;                =&gt; true,
				&#039;level_8&#039;                =&gt; true,
				&#039;level_7&#039;                =&gt; true,
				&#039;level_6&#039;                =&gt; true,
				&#039;level_5&#039;                =&gt; true,
				&#039;level_4&#039;                =&gt; true,
				&#039;level_3&#039;                =&gt; true,
				&#039;level_2&#039;                =&gt; true,
				&#039;level_1&#039;                =&gt; true,
				&#039;level_0&#039;                =&gt; true,
				&#039;read&#039;                   =&gt; true,
				&#039;read_private_pages&#039;     =&gt; true,
				&#039;read_private_posts&#039;     =&gt; true,
				&#039;edit_posts&#039;             =&gt; true,
				&#039;edit_pages&#039;             =&gt; true,
				&#039;edit_published_posts&#039;   =&gt; true,
				&#039;edit_published_pages&#039;   =&gt; true,
				&#039;edit_private_pages&#039;     =&gt; true,
				&#039;edit_private_posts&#039;     =&gt; true,
				&#039;edit_others_posts&#039;      =&gt; true,
				&#039;edit_others_pages&#039;      =&gt; true,
				&#039;publish_posts&#039;          =&gt; true,
				&#039;publish_pages&#039;          =&gt; true,
				&#039;delete_posts&#039;           =&gt; true,
				&#039;delete_pages&#039;           =&gt; true,
				&#039;delete_private_pages&#039;   =&gt; true,
				&#039;delete_private_posts&#039;   =&gt; true,
				&#039;delete_published_pages&#039; =&gt; true,
				&#039;delete_published_posts&#039; =&gt; true,
				&#039;delete_others_posts&#039;    =&gt; true,
				&#039;delete_others_pages&#039;    =&gt; true,
				&#039;manage_categories&#039;      =&gt; true,
				&#039;manage_links&#039;           =&gt; true,
				&#039;moderate_comments&#039;      =&gt; true,
				&#039;upload_files&#039;           =&gt; true,
				&#039;export&#039;                 =&gt; true,
				&#039;import&#039;                 =&gt; true,
				&#039;list_users&#039;             =&gt; true,
				&#039;edit_theme_options&#039;     =&gt; true,
			)
		);

		$capabilities = self::get_core_capabilities();

		foreach ( $capabilities as $cap_group ) {
			foreach ( $cap_group as $cap ) {
				$wp_roles-&gt;add_cap( &#039;shop_manager&#039;, $cap );
				$wp_roles-&gt;add_cap( &#039;administrator&#039;, $cap );
			}
		}
	}

	/**
	 * Get capabilities for WooCommerce - these are assigned to admin/shop manager during installation or reset.
	 *
	 * @return array
	 */
	public static function get_core_capabilities() {
		$capabilities = array();

		$capabilities[&#039;core&#039;] = array(
			&#039;manage_woocommerce&#039;,
			&#039;view_woocommerce_reports&#039;,
		);

		$capability_types = array( &#039;product&#039;, &#039;shop_order&#039;, &#039;shop_coupon&#039; );

		foreach ( $capability_types as $capability_type ) {

			$capabilities[ $capability_type ] = array(
				// Post type.
				&quot;edit_{$capability_type}&quot;,
				&quot;read_{$capability_type}&quot;,
				&quot;delete_{$capability_type}&quot;,
				&quot;edit_{$capability_type}s&quot;,
				&quot;edit_others_{$capability_type}s&quot;,
				&quot;publish_{$capability_type}s&quot;,
				&quot;read_private_{$capability_type}s&quot;,
				&quot;delete_{$capability_type}s&quot;,
				&quot;delete_private_{$capability_type}s&quot;,
				&quot;delete_published_{$capability_type}s&quot;,
				&quot;delete_others_{$capability_type}s&quot;,
				&quot;edit_private_{$capability_type}s&quot;,
				&quot;edit_published_{$capability_type}s&quot;,

				// Terms.
				&quot;manage_{$capability_type}_terms&quot;,
				&quot;edit_{$capability_type}_terms&quot;,
				&quot;delete_{$capability_type}_terms&quot;,
				&quot;assign_{$capability_type}_terms&quot;,
			);
		}

		return $capabilities;
	}

	/**
	 * Remove WooCommerce roles.
	 */
	public static function remove_roles() {
		global $wp_roles;

		if ( ! class_exists( &#039;WP_Roles&#039; ) ) {
			return;
		}

		if ( ! isset( $wp_roles ) ) {
			$wp_roles = new WP_Roles(); // @codingStandardsIgnoreLine
		}

		$capabilities = self::get_core_capabilities();

		foreach ( $capabilities as $cap_group ) {
			foreach ( $cap_group as $cap ) {
				$wp_roles-&gt;remove_cap( &#039;shop_manager&#039;, $cap );
				$wp_roles-&gt;remove_cap( &#039;administrator&#039;, $cap );
			}
		}

		remove_role( &#039;customer&#039; );
		remove_role( &#039;shop_manager&#039; );
	}

	/**
	 * Create files/directories.
	 */
	private static function create_files() {
		// Bypass if filesystem is read-only and/or non-standard upload system is used.
		if ( apply_filters( &#039;woocommerce_install_skip_create_files&#039;, false ) ) {
			return;
		}

		// Install files and folders for uploading files and prevent hotlinking.
		$upload_dir      = wp_get_upload_dir();
		$download_method = get_option( &#039;woocommerce_file_download_method&#039;, &#039;force&#039; );

		$files = array(
			array(
				&#039;base&#039;    =&gt; $upload_dir[&#039;basedir&#039;] . &#039;/woocommerce_uploads&#039;,
				&#039;file&#039;    =&gt; &#039;index.html&#039;,
				&#039;content&#039; =&gt; &#039;&#039;,
			),
			array(
				&#039;base&#039;    =&gt; WC_LOG_DIR,
				&#039;file&#039;    =&gt; &#039;.htaccess&#039;,
				&#039;content&#039; =&gt; &#039;deny from all&#039;,
			),
			array(
				&#039;base&#039;    =&gt; WC_LOG_DIR,
				&#039;file&#039;    =&gt; &#039;index.html&#039;,
				&#039;content&#039; =&gt; &#039;&#039;,
			),
			array(
				&#039;base&#039;    =&gt; $upload_dir[&#039;basedir&#039;] . &#039;/woocommerce_uploads&#039;,
				&#039;file&#039;    =&gt; &#039;.htaccess&#039;,
				&#039;content&#039; =&gt; &#039;redirect&#039; === $download_method ? &#039;Options -Indexes&#039; : &#039;deny from all&#039;,
			),
		);

		foreach ( $files as $file ) {
			if ( wp_mkdir_p( $file[&#039;base&#039;] ) &amp;&amp; ! file_exists( trailingslashit( $file[&#039;base&#039;] ) . $file[&#039;file&#039;] ) ) {
				$file_handle = @fopen( trailingslashit( $file[&#039;base&#039;] ) . $file[&#039;file&#039;], &#039;wb&#039; ); // phpcs:ignore WordPress.PHP.NoSilencedErrors.Discouraged, WordPress.WP.AlternativeFunctions.file_system_read_fopen
				if ( $file_handle ) {
					fwrite( $file_handle, $file[&#039;content&#039;] ); // phpcs:ignore WordPress.WP.AlternativeFunctions.file_system_read_fwrite
					fclose( $file_handle ); // phpcs:ignore WordPress.WP.AlternativeFunctions.file_system_read_fclose
				}
			}
		}

		// Create attachment for placeholders.
		self::create_placeholder_image();
	}

	/**
	 * Create a placeholder image in the media library.
	 *
	 * @since 3.5.0
	 */
	private static function create_placeholder_image() {
		$placeholder_image = get_option( &#039;woocommerce_placeholder_image&#039;, 0 );

		// Validate current setting if set. If set, return.
		if ( ! empty( $placeholder_image ) ) {
			if ( ! is_numeric( $placeholder_image ) ) {
				return;
			} elseif ( $placeholder_image &amp;&amp; wp_attachment_is_image( $placeholder_image ) ) {
				return;
			}
		}

		$upload_dir = wp_upload_dir();
		$source     = WC()-&gt;plugin_path() . &#039;/assets/images/placeholder-attachment.png&#039;;
		$filename   = $upload_dir[&#039;basedir&#039;] . &#039;/woocommerce-placeholder.png&#039;;

		if ( ! file_exists( $filename ) ) {
			copy( $source, $filename ); // @codingStandardsIgnoreLine.
		}

		if ( ! file_exists( $filename ) ) {
			update_option( &#039;woocommerce_placeholder_image&#039;, 0 );
			return;
		}

		$filetype   = wp_check_filetype( basename( $filename ), null );
		$attachment = array(
			&#039;guid&#039;           =&gt; $upload_dir[&#039;url&#039;] . &#039;/&#039; . basename( $filename ),
			&#039;post_mime_type&#039; =&gt; $filetype[&#039;type&#039;],
			&#039;post_title&#039;     =&gt; preg_replace( &#039;/\.[^.]+$/&#039;, &#039;&#039;, basename( $filename ) ),
			&#039;post_content&#039;   =&gt; &#039;&#039;,
			&#039;post_status&#039;    =&gt; &#039;inherit&#039;,
		);

		$attach_id = wp_insert_attachment( $attachment, $filename );
		if ( is_wp_error( $attach_id ) ) {
			update_option( &#039;woocommerce_placeholder_image&#039;, 0 );
			return;
		}

		update_option( &#039;woocommerce_placeholder_image&#039;, $attach_id );

		// Make sure that this file is included, as wp_generate_attachment_metadata() depends on it.
		require_once ABSPATH . &#039;wp-admin/includes/image.php&#039;;

		// Generate the metadata for the attachment, and update the database record.
		$attach_data = wp_generate_attachment_metadata( $attach_id, $filename );
		wp_update_attachment_metadata( $attach_id, $attach_data );
	}

	/**
	 * Show action links on the plugin screen.
	 *
	 * @param mixed $links Plugin Action links.
	 *
	 * @return array
	 */
	public static function plugin_action_links( $links ) {
		$action_links = array(
			&#039;settings&#039; =&gt; &#039;&lt;a href=&quot;&#039; . admin_url( &#039;admin.php?page=wc-settings&#039; ) . &#039;&quot; aria-label=&quot;&#039; . esc_attr__( &#039;View WooCommerce settings&#039;, &#039;woocommerce&#039; ) . &#039;&quot;&gt;&#039; . esc_html__( &#039;Settings&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/a&gt;&#039;,
		);

		return array_merge( $action_links, $links );
	}

	/**
	 * Show row meta on the plugin screen.
	 *
	 * @param mixed $links Plugin Row Meta.
	 * @param mixed $file  Plugin Base file.
	 *
	 * @return array
	 */
	public static function plugin_row_meta( $links, $file ) {
		if ( WC_PLUGIN_BASENAME !== $file ) {
			return $links;
		}

		$row_meta = array(
			&#039;docs&#039;    =&gt; &#039;&lt;a href=&quot;&#039; . esc_url( apply_filters( &#039;woocommerce_docs_url&#039;, &#039;https://docs.woocommerce.com/documentation/plugins/woocommerce/&#039; ) ) . &#039;&quot; aria-label=&quot;&#039; . esc_attr__( &#039;View WooCommerce documentation&#039;, &#039;woocommerce&#039; ) . &#039;&quot;&gt;&#039; . esc_html__( &#039;Docs&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/a&gt;&#039;,
			&#039;apidocs&#039; =&gt; &#039;&lt;a href=&quot;&#039; . esc_url( apply_filters( &#039;woocommerce_apidocs_url&#039;, &#039;https://docs.woocommerce.com/wc-apidocs/&#039; ) ) . &#039;&quot; aria-label=&quot;&#039; . esc_attr__( &#039;View WooCommerce API docs&#039;, &#039;woocommerce&#039; ) . &#039;&quot;&gt;&#039; . esc_html__( &#039;API docs&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/a&gt;&#039;,
			&#039;support&#039; =&gt; &#039;&lt;a href=&quot;&#039; . esc_url( apply_filters( &#039;woocommerce_community_support_url&#039;, &#039;https://wordpress.org/support/plugin/woocommerce/&#039; ) ) . &#039;&quot; aria-label=&quot;&#039; . esc_attr__( &#039;Visit community forums&#039;, &#039;woocommerce&#039; ) . &#039;&quot;&gt;&#039; . esc_html__( &#039;Community support&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/a&gt;&#039;,
		);

		if ( WCConnectionHelper::is_connected() ) {
			$row_meta[&#039;premium_support&#039;] = &#039;&lt;a href=&quot;&#039; . esc_url( apply_filters( &#039;woocommerce_support_url&#039;, &#039;https://woocommerce.com/my-account/create-a-ticket/&#039; ) ) . &#039;&quot; aria-label=&quot;&#039; . esc_attr__( &#039;Visit premium customer support&#039;, &#039;woocommerce&#039; ) . &#039;&quot;&gt;&#039; . esc_html__( &#039;Premium support&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/a&gt;&#039;;
		}

		return array_merge( $links, $row_meta );
	}

	/**
	 * Get slug from path and associate it with the path.
	 *
	 * @param array  $plugins Associative array of plugin files to paths.
	 * @param string $key Plugin relative path. Example: woocommerce/woocommerce.php.
	 */
	private static function associate_plugin_file( $plugins, $key ) {
		$path                 = explode( &#039;/&#039;, $key );
		$filename             = end( $path );
		$plugins[ $filename ] = $key;
		return $plugins;
	}

	/**
	 * Install a plugin from .org in the background via a cron job (used by
	 * installer - opt in).
	 *
	 * @param string $plugin_to_install_id Plugin ID.
	 * @param array  $plugin_to_install Plugin information.
	 *
	 * @throws Exception If unable to proceed with plugin installation.
	 * @since  2.6.0
	 */
	public static function background_installer( $plugin_to_install_id, $plugin_to_install ) {
		// Explicitly clear the event.
		$args = func_get_args();

		if ( ! empty( $plugin_to_install[&#039;repo-slug&#039;] ) ) {
			require_once ABSPATH . &#039;wp-admin/includes/file.php&#039;;
			require_once ABSPATH . &#039;wp-admin/includes/plugin-install.php&#039;;
			require_once ABSPATH . &#039;wp-admin/includes/class-wp-upgrader.php&#039;;
			require_once ABSPATH . &#039;wp-admin/includes/plugin.php&#039;;

			WP_Filesystem();

			$skin              = new Automatic_Upgrader_Skin();
			$upgrader          = new WP_Upgrader( $skin );
			$installed_plugins = array_reduce( array_keys( get_plugins() ), array( __CLASS__, &#039;associate_plugin_file&#039; ) );
			if ( empty( $installed_plugins ) ) {
				$installed_plugins = array();
			}
			$plugin_slug = $plugin_to_install[&#039;repo-slug&#039;];
			$plugin_file = isset( $plugin_to_install[&#039;file&#039;] ) ? $plugin_to_install[&#039;file&#039;] : $plugin_slug . &#039;.php&#039;;
			$installed   = false;
			$activate    = false;

			// See if the plugin is installed already.
			if ( isset( $installed_plugins[ $plugin_file ] ) ) {
				$installed = true;
				$activate  = ! is_plugin_active( $installed_plugins[ $plugin_file ] );
			}

			// Install this thing!
			if ( ! $installed ) {
				// Suppress feedback.
				ob_start();

				try {
					$plugin_information = plugins_api(
						&#039;plugin_information&#039;,
						array(
							&#039;slug&#039;   =&gt; $plugin_slug,
							&#039;fields&#039; =&gt; array(
								&#039;short_description&#039; =&gt; false,
								&#039;sections&#039;          =&gt; false,
								&#039;requires&#039;          =&gt; false,
								&#039;rating&#039;            =&gt; false,
								&#039;ratings&#039;           =&gt; false,
								&#039;downloaded&#039;        =&gt; false,
								&#039;last_updated&#039;      =&gt; false,
								&#039;added&#039;             =&gt; false,
								&#039;tags&#039;              =&gt; false,
								&#039;homepage&#039;          =&gt; false,
								&#039;donate_link&#039;       =&gt; false,
								&#039;author_profile&#039;    =&gt; false,
								&#039;author&#039;            =&gt; false,
							),
						)
					);

					if ( is_wp_error( $plugin_information ) ) {
						throw new Exception( $plugin_information-&gt;get_error_message() );
					}

					$package  = $plugin_information-&gt;download_link;
					$download = $upgrader-&gt;download_package( $package );

					if ( is_wp_error( $download ) ) {
						throw new Exception( $download-&gt;get_error_message() );
					}

					$working_dir = $upgrader-&gt;unpack_package( $download, true );

					if ( is_wp_error( $working_dir ) ) {
						throw new Exception( $working_dir-&gt;get_error_message() );
					}

					$result = $upgrader-&gt;install_package(
						array(
							&#039;source&#039;                      =&gt; $working_dir,
							&#039;destination&#039;                 =&gt; WP_PLUGIN_DIR,
							&#039;clear_destination&#039;           =&gt; false,
							&#039;abort_if_destination_exists&#039; =&gt; false,
							&#039;clear_working&#039;               =&gt; true,
							&#039;hook_extra&#039;                  =&gt; array(
								&#039;type&#039;   =&gt; &#039;plugin&#039;,
								&#039;action&#039; =&gt; &#039;install&#039;,
							),
						)
					);

					if ( is_wp_error( $result ) ) {
						throw new Exception( $result-&gt;get_error_message() );
					}

					$activate = true;

				} catch ( Exception $e ) {
					WC_Admin_Notices::add_custom_notice(
						$plugin_to_install_id . &#039;_install_error&#039;,
						sprintf(
							// translators: 1: plugin name, 2: error message, 3: URL to install plugin manually.
							__( &#039;%1$s could not be installed (%2$s). &lt;a href=&quot;%3$s&quot;&gt;Please install it manually by clicking here.&lt;/a&gt;&#039;, &#039;woocommerce&#039; ),
							$plugin_to_install[&#039;name&#039;],
							$e-&gt;getMessage(),
							esc_url( admin_url( &#039;index.php?wc-install-plugin-redirect=&#039; . $plugin_slug ) )
						)
					);
				}

				// Discard feedback.
				ob_end_clean();
			}

			wp_clean_plugins_cache();

			// Activate this thing.
			if ( $activate ) {
				try {
					add_action( &#039;add_option_mailchimp_woocommerce_plugin_do_activation_redirect&#039;, array( __CLASS__, &#039;remove_mailchimps_redirect&#039; ), 10, 2 );
					$result = activate_plugin( $installed ? $installed_plugins[ $plugin_file ] : $plugin_slug . &#039;/&#039; . $plugin_file );

					if ( is_wp_error( $result ) ) {
						throw new Exception( $result-&gt;get_error_message() );
					}
				} catch ( Exception $e ) {
					WC_Admin_Notices::add_custom_notice(
						$plugin_to_install_id . &#039;_install_error&#039;,
						sprintf(
							// translators: 1: plugin name, 2: URL to WP plugin page.
							__( &#039;%1$s was installed but could not be activated. &lt;a href=&quot;%2$s&quot;&gt;Please activate it manually by clicking here.&lt;/a&gt;&#039;, &#039;woocommerce&#039; ),
							$plugin_to_install[&#039;name&#039;],
							admin_url( &#039;plugins.php&#039; )
						)
					);
				}
			}
		}
	}

	/**
	 * Removes redirect added during MailChimp plugin&#039;s activation.
	 *
	 * @param string $option Option name.
	 * @param string $value  Option value.
	 */
	public static function remove_mailchimps_redirect( $option, $value ) {
		// Remove this action to prevent infinite looping.
		remove_action( &#039;add_option_mailchimp_woocommerce_plugin_do_activation_redirect&#039;, array( __CLASS__, &#039;remove_mailchimps_redirect&#039; ) );

		// Update redirect back to false.
		update_option( &#039;mailchimp_woocommerce_plugin_do_activation_redirect&#039;, false );
	}

	/**
	 * Install a theme from .org in the background via a cron job (used by installer - opt in).
	 *
	 * @param string $theme_slug Theme slug.
	 *
	 * @throws Exception If unable to proceed with theme installation.
	 * @since  3.1.0
	 */
	public static function theme_background_installer( $theme_slug ) {
		// Explicitly clear the event.
		$args = func_get_args();

		if ( ! empty( $theme_slug ) ) {
			// Suppress feedback.
			ob_start();

			try {
				$theme = wp_get_theme( $theme_slug );

				if ( ! $theme-&gt;exists() ) {
					require_once ABSPATH . &#039;wp-admin/includes/file.php&#039;;
					include_once ABSPATH . &#039;wp-admin/includes/class-wp-upgrader.php&#039;;
					include_once ABSPATH . &#039;wp-admin/includes/theme.php&#039;;

					WP_Filesystem();

					$skin     = new Automatic_Upgrader_Skin();
					$upgrader = new Theme_Upgrader( $skin );
					$api      = themes_api(
						&#039;theme_information&#039;,
						array(
							&#039;slug&#039;   =&gt; $theme_slug,
							&#039;fields&#039; =&gt; array( &#039;sections&#039; =&gt; false ),
						)
					);
					$result   = $upgrader-&gt;install( $api-&gt;download_link );

					if ( is_wp_error( $result ) ) {
						throw new Exception( $result-&gt;get_error_message() );
					} elseif ( is_wp_error( $skin-&gt;result ) ) {
						throw new Exception( $skin-&gt;result-&gt;get_error_message() );
					} elseif ( is_null( $result ) ) {
						throw new Exception( &#039;Unable to connect to the filesystem. Please confirm your credentials.&#039; );
					}
				}

				switch_theme( $theme_slug );
			} catch ( Exception $e ) {
				WC_Admin_Notices::add_custom_notice(
					$theme_slug . &#039;_install_error&#039;,
					sprintf(
						// translators: 1: theme slug, 2: error message, 3: URL to install theme manually.
						__( &#039;%1$s could not be installed (%2$s). &lt;a href=&quot;%3$s&quot;&gt;Please install it manually by clicking here.&lt;/a&gt;&#039;, &#039;woocommerce&#039; ),
						$theme_slug,
						$e-&gt;getMessage(),
						esc_url( admin_url( &#039;update.php?action=install-theme&amp;theme=&#039; . $theme_slug . &#039;&amp;_wpnonce=&#039; . wp_create_nonce( &#039;install-theme_&#039; . $theme_slug ) ) )
					)
				);
			}

			// Discard feedback.
			ob_end_clean();
		}
	}

	/**
	 * Sets whether PayPal Standard will be loaded on install.
	 *
	 * @since 5.5.0
	 */
	private static function set_paypal_standard_load_eligibility() {
		// Initiating the payment gateways sets the flag.
		if ( class_exists( &#039;WC_Gateway_Paypal&#039; ) ) {
			( new WC_Gateway_Paypal() )-&gt;should_load();
		}
	}
}

WC_Install::init();
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>WooCommerce Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on July 12th, 2021 at 10:33 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1626085995"></script>
    <script src="../js/search.js?updated=1626085995"></script>
</body>
</html>
