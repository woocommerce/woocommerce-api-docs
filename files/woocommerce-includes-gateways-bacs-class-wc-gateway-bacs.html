<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>WooCommerce Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1626085995">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1626085995">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.svg" alt="WooCommerce" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">WooCommerce Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/automattic.html"><abbr title="\Automattic">Automattic</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/automattic-woocommerce.html"><abbr title="\Automattic\WooCommerce">WooCommerce</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WooCommerce.html"><abbr title="\WooCommerce">WooCommerce</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WooCommerce-Classes.html"><abbr title="\WooCommerce\Classes">Classes</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Abstracts.html"><abbr title="\WooCommerce\Abstracts">Abstracts</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Admin.html"><abbr title="\WooCommerce\Admin">Admin</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Views.html"><abbr title="\WooCommerce\Views">Views</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Helper.html"><abbr title="\WooCommerce\Helper">Helper</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Templates.html"><abbr title="\WooCommerce\Templates">Templates</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Reports.html"><abbr title="\WooCommerce\Reports">Reports</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Blocks.html"><abbr title="\WooCommerce\Blocks">Blocks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-RestApi.html"><abbr title="\WooCommerce\RestApi">RestApi</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-CLI.html"><abbr title="\WooCommerce\CLI">CLI</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-l10n.html"><abbr title="\WooCommerce\l10n">l10n</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Webhooks.html"><abbr title="\WooCommerce\Webhooks">Webhooks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-DataStores.html"><abbr title="\WooCommerce\DataStores">DataStores</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Emails.html"><abbr title="\WooCommerce\Emails">Emails</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Export.html"><abbr title="\WooCommerce\Export">Export</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Gateways.html"><abbr title="\WooCommerce\Gateways">Gateways</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-PayPal.html"><abbr title="\WooCommerce\PayPal">PayPal</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Import.html"><abbr title="\WooCommerce\Import">Import</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Integrations.html"><abbr title="\WooCommerce\Integrations">Integrations</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Interfaces.html"><abbr title="\WooCommerce\Interfaces">Interfaces</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Interface.html"><abbr title="\WooCommerce\Interface">Interface</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-LogHandlers.html"><abbr title="\WooCommerce\LogHandlers">LogHandlers</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-PaymentTokens.html"><abbr title="\WooCommerce\PaymentTokens">PaymentTokens</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Utilities.html"><abbr title="\WooCommerce\Utilities">Utilities</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Shipping.html"><abbr title="\WooCommerce\Shipping">Shipping</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Shortcodes.html"><abbr title="\WooCommerce\Shortcodes">Shortcodes</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Tracks.html"><abbr title="\WooCommerce\Tracks">Tracks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Traits.html"><abbr title="\WooCommerce\Traits">Traits</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Functions.html"><abbr title="\WooCommerce\Functions">Functions</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-WCCom.html"><abbr title="\WooCommerce\WCCom">WCCom</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Widgets.html"><abbr title="\WooCommerce\Widgets">Widgets</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Uninstaller.html"><abbr title="\WooCommerce\Uninstaller">Uninstaller</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WoocommerceAdmin.html"><abbr title="\WoocommerceAdmin">WoocommerceAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WoocommerceNavigation.html"><abbr title="\WoocommerceNavigation">WoocommerceNavigation</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Automattic.html"><abbr title="\Automattic">Automattic</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/Automattic-WooCommerce.html"><abbr title="\Automattic\WooCommerce">WooCommerce</abbr></a></li>
                            </ul>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-wc-gateway-bacs.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * Class WC_Gateway_BACS file.
 *
 * @package WooCommerce\Gateways
 */

if ( ! defined( &#039;ABSPATH&#039; ) ) {
	exit; // Exit if accessed directly.
}

/**
 * Bank Transfer Payment Gateway.
 *
 * Provides a Bank Transfer Payment Gateway. Based on code by Mike Pepper.
 *
 * @class       WC_Gateway_BACS
 * @extends     WC_Payment_Gateway
 * @version     2.1.0
 * @package     WooCommerce\Classes\Payment
 */
class WC_Gateway_BACS extends WC_Payment_Gateway {

	/**
	 * Array of locales
	 *
	 * @var array
	 */
	public $locale;

	/**
	 * Constructor for the gateway.
	 */
	public function __construct() {

		$this-&gt;id                 = &#039;bacs&#039;;
		$this-&gt;icon               = apply_filters( &#039;woocommerce_bacs_icon&#039;, &#039;&#039; );
		$this-&gt;has_fields         = false;
		$this-&gt;method_title       = __( &#039;Direct bank transfer&#039;, &#039;woocommerce&#039; );
		$this-&gt;method_description = __( &#039;Take payments in person via BACS. More commonly known as direct bank/wire transfer.&#039;, &#039;woocommerce&#039; );

		// Load the settings.
		$this-&gt;init_form_fields();
		$this-&gt;init_settings();

		// Define user set variables.
		$this-&gt;title        = $this-&gt;get_option( &#039;title&#039; );
		$this-&gt;description  = $this-&gt;get_option( &#039;description&#039; );
		$this-&gt;instructions = $this-&gt;get_option( &#039;instructions&#039; );

		// BACS account fields shown on the thanks page and in emails.
		$this-&gt;account_details = get_option(
			&#039;woocommerce_bacs_accounts&#039;,
			array(
				array(
					&#039;account_name&#039;   =&gt; $this-&gt;get_option( &#039;account_name&#039; ),
					&#039;account_number&#039; =&gt; $this-&gt;get_option( &#039;account_number&#039; ),
					&#039;sort_code&#039;      =&gt; $this-&gt;get_option( &#039;sort_code&#039; ),
					&#039;bank_name&#039;      =&gt; $this-&gt;get_option( &#039;bank_name&#039; ),
					&#039;iban&#039;           =&gt; $this-&gt;get_option( &#039;iban&#039; ),
					&#039;bic&#039;            =&gt; $this-&gt;get_option( &#039;bic&#039; ),
				),
			)
		);

		// Actions.
		add_action( &#039;woocommerce_update_options_payment_gateways_&#039; . $this-&gt;id, array( $this, &#039;process_admin_options&#039; ) );
		add_action( &#039;woocommerce_update_options_payment_gateways_&#039; . $this-&gt;id, array( $this, &#039;save_account_details&#039; ) );
		add_action( &#039;woocommerce_thankyou_bacs&#039;, array( $this, &#039;thankyou_page&#039; ) );

		// Customer Emails.
		add_action( &#039;woocommerce_email_before_order_table&#039;, array( $this, &#039;email_instructions&#039; ), 10, 3 );
	}

	/**
	 * Initialise Gateway Settings Form Fields.
	 */
	public function init_form_fields() {

		$this-&gt;form_fields = array(
			&#039;enabled&#039;         =&gt; array(
				&#039;title&#039;   =&gt; __( &#039;Enable/Disable&#039;, &#039;woocommerce&#039; ),
				&#039;type&#039;    =&gt; &#039;checkbox&#039;,
				&#039;label&#039;   =&gt; __( &#039;Enable bank transfer&#039;, &#039;woocommerce&#039; ),
				&#039;default&#039; =&gt; &#039;no&#039;,
			),
			&#039;title&#039;           =&gt; array(
				&#039;title&#039;       =&gt; __( &#039;Title&#039;, &#039;woocommerce&#039; ),
				&#039;type&#039;        =&gt; &#039;text&#039;,
				&#039;description&#039; =&gt; __( &#039;This controls the title which the user sees during checkout.&#039;, &#039;woocommerce&#039; ),
				&#039;default&#039;     =&gt; __( &#039;Direct bank transfer&#039;, &#039;woocommerce&#039; ),
				&#039;desc_tip&#039;    =&gt; true,
			),
			&#039;description&#039;     =&gt; array(
				&#039;title&#039;       =&gt; __( &#039;Description&#039;, &#039;woocommerce&#039; ),
				&#039;type&#039;        =&gt; &#039;textarea&#039;,
				&#039;description&#039; =&gt; __( &#039;Payment method description that the customer will see on your checkout.&#039;, &#039;woocommerce&#039; ),
				&#039;default&#039;     =&gt; __( &#039;Make your payment directly into our bank account. Please use your Order ID as the payment reference. Your order will not be shipped until the funds have cleared in our account.&#039;, &#039;woocommerce&#039; ),
				&#039;desc_tip&#039;    =&gt; true,
			),
			&#039;instructions&#039;    =&gt; array(
				&#039;title&#039;       =&gt; __( &#039;Instructions&#039;, &#039;woocommerce&#039; ),
				&#039;type&#039;        =&gt; &#039;textarea&#039;,
				&#039;description&#039; =&gt; __( &#039;Instructions that will be added to the thank you page and emails.&#039;, &#039;woocommerce&#039; ),
				&#039;default&#039;     =&gt; &#039;&#039;,
				&#039;desc_tip&#039;    =&gt; true,
			),
			&#039;account_details&#039; =&gt; array(
				&#039;type&#039; =&gt; &#039;account_details&#039;,
			),
		);

	}

	/**
	 * Generate account details html.
	 *
	 * @return string
	 */
	public function generate_account_details_html() {

		ob_start();

		$country = WC()-&gt;countries-&gt;get_base_country();
		$locale  = $this-&gt;get_country_locale();

		// Get sortcode label in the $locale array and use appropriate one.
		$sortcode = isset( $locale[ $country ][&#039;sortcode&#039;][&#039;label&#039;] ) ? $locale[ $country ][&#039;sortcode&#039;][&#039;label&#039;] : __( &#039;Sort code&#039;, &#039;woocommerce&#039; );

		?&gt;
		&lt;tr valign=&quot;top&quot;&gt;
			&lt;th scope=&quot;row&quot; class=&quot;titledesc&quot;&gt;&lt;?php esc_html_e( &#039;Account details:&#039;, &#039;woocommerce&#039; ); ?&gt;&lt;/th&gt;
			&lt;td class=&quot;forminp&quot; id=&quot;bacs_accounts&quot;&gt;
				&lt;div class=&quot;wc_input_table_wrapper&quot;&gt;
					&lt;table class=&quot;widefat wc_input_table sortable&quot; cellspacing=&quot;0&quot;&gt;
						&lt;thead&gt;
							&lt;tr&gt;
								&lt;th class=&quot;sort&quot;&gt;&amp;nbsp;&lt;/th&gt;
								&lt;th&gt;&lt;?php esc_html_e( &#039;Account name&#039;, &#039;woocommerce&#039; ); ?&gt;&lt;/th&gt;
								&lt;th&gt;&lt;?php esc_html_e( &#039;Account number&#039;, &#039;woocommerce&#039; ); ?&gt;&lt;/th&gt;
								&lt;th&gt;&lt;?php esc_html_e( &#039;Bank name&#039;, &#039;woocommerce&#039; ); ?&gt;&lt;/th&gt;
								&lt;th&gt;&lt;?php echo esc_html( $sortcode ); ?&gt;&lt;/th&gt;
								&lt;th&gt;&lt;?php esc_html_e( &#039;IBAN&#039;, &#039;woocommerce&#039; ); ?&gt;&lt;/th&gt;
								&lt;th&gt;&lt;?php esc_html_e( &#039;BIC / Swift&#039;, &#039;woocommerce&#039; ); ?&gt;&lt;/th&gt;
							&lt;/tr&gt;
						&lt;/thead&gt;
						&lt;tbody class=&quot;accounts&quot;&gt;
							&lt;?php
							$i = -1;
							if ( $this-&gt;account_details ) {
								foreach ( $this-&gt;account_details as $account ) {
									$i++;

									echo &#039;&lt;tr class=&quot;account&quot;&gt;
										&lt;td class=&quot;sort&quot;&gt;&lt;/td&gt;
										&lt;td&gt;&lt;input type=&quot;text&quot; value=&quot;&#039; . esc_attr( wp_unslash( $account[&#039;account_name&#039;] ) ) . &#039;&quot; name=&quot;bacs_account_name[&#039; . esc_attr( $i ) . &#039;]&quot; /&gt;&lt;/td&gt;
										&lt;td&gt;&lt;input type=&quot;text&quot; value=&quot;&#039; . esc_attr( $account[&#039;account_number&#039;] ) . &#039;&quot; name=&quot;bacs_account_number[&#039; . esc_attr( $i ) . &#039;]&quot; /&gt;&lt;/td&gt;
										&lt;td&gt;&lt;input type=&quot;text&quot; value=&quot;&#039; . esc_attr( wp_unslash( $account[&#039;bank_name&#039;] ) ) . &#039;&quot; name=&quot;bacs_bank_name[&#039; . esc_attr( $i ) . &#039;]&quot; /&gt;&lt;/td&gt;
										&lt;td&gt;&lt;input type=&quot;text&quot; value=&quot;&#039; . esc_attr( $account[&#039;sort_code&#039;] ) . &#039;&quot; name=&quot;bacs_sort_code[&#039; . esc_attr( $i ) . &#039;]&quot; /&gt;&lt;/td&gt;
										&lt;td&gt;&lt;input type=&quot;text&quot; value=&quot;&#039; . esc_attr( $account[&#039;iban&#039;] ) . &#039;&quot; name=&quot;bacs_iban[&#039; . esc_attr( $i ) . &#039;]&quot; /&gt;&lt;/td&gt;
										&lt;td&gt;&lt;input type=&quot;text&quot; value=&quot;&#039; . esc_attr( $account[&#039;bic&#039;] ) . &#039;&quot; name=&quot;bacs_bic[&#039; . esc_attr( $i ) . &#039;]&quot; /&gt;&lt;/td&gt;
									&lt;/tr&gt;&#039;;
								}
							}
							?&gt;
						&lt;/tbody&gt;
						&lt;tfoot&gt;
							&lt;tr&gt;
								&lt;th colspan=&quot;7&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;add button&quot;&gt;&lt;?php esc_html_e( &#039;+ Add account&#039;, &#039;woocommerce&#039; ); ?&gt;&lt;/a&gt; &lt;a href=&quot;#&quot; class=&quot;remove_rows button&quot;&gt;&lt;?php esc_html_e( &#039;Remove selected account(s)&#039;, &#039;woocommerce&#039; ); ?&gt;&lt;/a&gt;&lt;/th&gt;
							&lt;/tr&gt;
						&lt;/tfoot&gt;
					&lt;/table&gt;
				&lt;/div&gt;
				&lt;script type=&quot;text/javascript&quot;&gt;
					jQuery(function() {
						jQuery(&#039;#bacs_accounts&#039;).on( &#039;click&#039;, &#039;a.add&#039;, function(){

							var size = jQuery(&#039;#bacs_accounts&#039;).find(&#039;tbody .account&#039;).length;

							jQuery(&#039;&lt;tr class=&quot;account&quot;&gt;\
									&lt;td class=&quot;sort&quot;&gt;&lt;/td&gt;\
									&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;bacs_account_name[&#039; + size + &#039;]&quot; /&gt;&lt;/td&gt;\
									&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;bacs_account_number[&#039; + size + &#039;]&quot; /&gt;&lt;/td&gt;\
									&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;bacs_bank_name[&#039; + size + &#039;]&quot; /&gt;&lt;/td&gt;\
									&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;bacs_sort_code[&#039; + size + &#039;]&quot; /&gt;&lt;/td&gt;\
									&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;bacs_iban[&#039; + size + &#039;]&quot; /&gt;&lt;/td&gt;\
									&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;bacs_bic[&#039; + size + &#039;]&quot; /&gt;&lt;/td&gt;\
								&lt;/tr&gt;&#039;).appendTo(&#039;#bacs_accounts table tbody&#039;);

							return false;
						});
					});
				&lt;/script&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
		&lt;?php
		return ob_get_clean();

	}

	/**
	 * Save account details table.
	 */
	public function save_account_details() {

		$accounts = array();

		// phpcs:disable WordPress.Security.NonceVerification.Missing -- Nonce verification already handled in WC_Admin_Settings::save()
		if ( isset( $_POST[&#039;bacs_account_name&#039;] ) &amp;&amp; isset( $_POST[&#039;bacs_account_number&#039;] ) &amp;&amp; isset( $_POST[&#039;bacs_bank_name&#039;] )
			 &amp;&amp; isset( $_POST[&#039;bacs_sort_code&#039;] ) &amp;&amp; isset( $_POST[&#039;bacs_iban&#039;] ) &amp;&amp; isset( $_POST[&#039;bacs_bic&#039;] ) ) {

			$account_names   = wc_clean( wp_unslash( $_POST[&#039;bacs_account_name&#039;] ) );
			$account_numbers = wc_clean( wp_unslash( $_POST[&#039;bacs_account_number&#039;] ) );
			$bank_names      = wc_clean( wp_unslash( $_POST[&#039;bacs_bank_name&#039;] ) );
			$sort_codes      = wc_clean( wp_unslash( $_POST[&#039;bacs_sort_code&#039;] ) );
			$ibans           = wc_clean( wp_unslash( $_POST[&#039;bacs_iban&#039;] ) );
			$bics            = wc_clean( wp_unslash( $_POST[&#039;bacs_bic&#039;] ) );

			foreach ( $account_names as $i =&gt; $name ) {
				if ( ! isset( $account_names[ $i ] ) ) {
					continue;
				}

				$accounts[] = array(
					&#039;account_name&#039;   =&gt; $account_names[ $i ],
					&#039;account_number&#039; =&gt; $account_numbers[ $i ],
					&#039;bank_name&#039;      =&gt; $bank_names[ $i ],
					&#039;sort_code&#039;      =&gt; $sort_codes[ $i ],
					&#039;iban&#039;           =&gt; $ibans[ $i ],
					&#039;bic&#039;            =&gt; $bics[ $i ],
				);
			}
		}
		// phpcs:enable

		update_option( &#039;woocommerce_bacs_accounts&#039;, $accounts );
	}

	/**
	 * Output for the order received page.
	 *
	 * @param int $order_id Order ID.
	 */
	public function thankyou_page( $order_id ) {

		if ( $this-&gt;instructions ) {
			echo wp_kses_post( wpautop( wptexturize( wp_kses_post( $this-&gt;instructions ) ) ) );
		}
		$this-&gt;bank_details( $order_id );

	}

	/**
	 * Add content to the WC emails.
	 *
	 * @param WC_Order $order Order object.
	 * @param bool     $sent_to_admin Sent to admin.
	 * @param bool     $plain_text Email format: plain text or HTML.
	 */
	public function email_instructions( $order, $sent_to_admin, $plain_text = false ) {

		if ( ! $sent_to_admin &amp;&amp; &#039;bacs&#039; === $order-&gt;get_payment_method() &amp;&amp; $order-&gt;has_status( &#039;on-hold&#039; ) ) {
			if ( $this-&gt;instructions ) {
				echo wp_kses_post( wpautop( wptexturize( $this-&gt;instructions ) ) . PHP_EOL );
			}
			$this-&gt;bank_details( $order-&gt;get_id() );
		}

	}

	/**
	 * Get bank details and place into a list format.
	 *
	 * @param int $order_id Order ID.
	 */
	private function bank_details( $order_id = &#039;&#039; ) {

		if ( empty( $this-&gt;account_details ) ) {
			return;
		}

		// Get order and store in $order.
		$order = wc_get_order( $order_id );

		// Get the order country and country $locale.
		$country = $order-&gt;get_billing_country();
		$locale  = $this-&gt;get_country_locale();

		// Get sortcode label in the $locale array and use appropriate one.
		$sortcode = isset( $locale[ $country ][&#039;sortcode&#039;][&#039;label&#039;] ) ? $locale[ $country ][&#039;sortcode&#039;][&#039;label&#039;] : __( &#039;Sort code&#039;, &#039;woocommerce&#039; );

		$bacs_accounts = apply_filters( &#039;woocommerce_bacs_accounts&#039;, $this-&gt;account_details, $order_id );

		if ( ! empty( $bacs_accounts ) ) {
			$account_html = &#039;&#039;;
			$has_details  = false;

			foreach ( $bacs_accounts as $bacs_account ) {
				$bacs_account = (object) $bacs_account;

				if ( $bacs_account-&gt;account_name ) {
					$account_html .= &#039;&lt;h3 class=&quot;wc-bacs-bank-details-account-name&quot;&gt;&#039; . wp_kses_post( wp_unslash( $bacs_account-&gt;account_name ) ) . &#039;:&lt;/h3&gt;&#039; . PHP_EOL;
				}

				$account_html .= &#039;&lt;ul class=&quot;wc-bacs-bank-details order_details bacs_details&quot;&gt;&#039; . PHP_EOL;

				// BACS account fields shown on the thanks page and in emails.
				$account_fields = apply_filters(
					&#039;woocommerce_bacs_account_fields&#039;,
					array(
						&#039;bank_name&#039;      =&gt; array(
							&#039;label&#039; =&gt; __( &#039;Bank&#039;, &#039;woocommerce&#039; ),
							&#039;value&#039; =&gt; $bacs_account-&gt;bank_name,
						),
						&#039;account_number&#039; =&gt; array(
							&#039;label&#039; =&gt; __( &#039;Account number&#039;, &#039;woocommerce&#039; ),
							&#039;value&#039; =&gt; $bacs_account-&gt;account_number,
						),
						&#039;sort_code&#039;      =&gt; array(
							&#039;label&#039; =&gt; $sortcode,
							&#039;value&#039; =&gt; $bacs_account-&gt;sort_code,
						),
						&#039;iban&#039;           =&gt; array(
							&#039;label&#039; =&gt; __( &#039;IBAN&#039;, &#039;woocommerce&#039; ),
							&#039;value&#039; =&gt; $bacs_account-&gt;iban,
						),
						&#039;bic&#039;            =&gt; array(
							&#039;label&#039; =&gt; __( &#039;BIC&#039;, &#039;woocommerce&#039; ),
							&#039;value&#039; =&gt; $bacs_account-&gt;bic,
						),
					),
					$order_id
				);

				foreach ( $account_fields as $field_key =&gt; $field ) {
					if ( ! empty( $field[&#039;value&#039;] ) ) {
						$account_html .= &#039;&lt;li class=&quot;&#039; . esc_attr( $field_key ) . &#039;&quot;&gt;&#039; . wp_kses_post( $field[&#039;label&#039;] ) . &#039;: &lt;strong&gt;&#039; . wp_kses_post( wptexturize( $field[&#039;value&#039;] ) ) . &#039;&lt;/strong&gt;&lt;/li&gt;&#039; . PHP_EOL;
						$has_details   = true;
					}
				}

				$account_html .= &#039;&lt;/ul&gt;&#039;;
			}

			if ( $has_details ) {
				echo &#039;&lt;section class=&quot;woocommerce-bacs-bank-details&quot;&gt;&lt;h2 class=&quot;wc-bacs-bank-details-heading&quot;&gt;&#039; . esc_html__( &#039;Our bank details&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/h2&gt;&#039; . wp_kses_post( PHP_EOL . $account_html ) . &#039;&lt;/section&gt;&#039;;
			}
		}

	}

	/**
	 * Process the payment and return the result.
	 *
	 * @param int $order_id Order ID.
	 * @return array
	 */
	public function process_payment( $order_id ) {

		$order = wc_get_order( $order_id );

		if ( $order-&gt;get_total() &gt; 0 ) {
			// Mark as on-hold (we&#039;re awaiting the payment).
			$order-&gt;update_status( apply_filters( &#039;woocommerce_bacs_process_payment_order_status&#039;, &#039;on-hold&#039;, $order ), __( &#039;Awaiting BACS payment&#039;, &#039;woocommerce&#039; ) );
		} else {
			$order-&gt;payment_complete();
		}

		// Remove cart.
		WC()-&gt;cart-&gt;empty_cart();

		// Return thankyou redirect.
		return array(
			&#039;result&#039;   =&gt; &#039;success&#039;,
			&#039;redirect&#039; =&gt; $this-&gt;get_return_url( $order ),
		);

	}

	/**
	 * Get country locale if localized.
	 *
	 * @return array
	 */
	public function get_country_locale() {

		if ( empty( $this-&gt;locale ) ) {

			// Locale information to be used - only those that are not &#039;Sort Code&#039;.
			$this-&gt;locale = apply_filters(
				&#039;woocommerce_get_bacs_locale&#039;,
				array(
					&#039;AU&#039; =&gt; array(
						&#039;sortcode&#039; =&gt; array(
							&#039;label&#039; =&gt; __( &#039;BSB&#039;, &#039;woocommerce&#039; ),
						),
					),
					&#039;CA&#039; =&gt; array(
						&#039;sortcode&#039; =&gt; array(
							&#039;label&#039; =&gt; __( &#039;Bank transit number&#039;, &#039;woocommerce&#039; ),
						),
					),
					&#039;IN&#039; =&gt; array(
						&#039;sortcode&#039; =&gt; array(
							&#039;label&#039; =&gt; __( &#039;IFSC&#039;, &#039;woocommerce&#039; ),
						),
					),
					&#039;IT&#039; =&gt; array(
						&#039;sortcode&#039; =&gt; array(
							&#039;label&#039; =&gt; __( &#039;Branch sort&#039;, &#039;woocommerce&#039; ),
						),
					),
					&#039;NZ&#039; =&gt; array(
						&#039;sortcode&#039; =&gt; array(
							&#039;label&#039; =&gt; __( &#039;Bank code&#039;, &#039;woocommerce&#039; ),
						),
					),
					&#039;SE&#039; =&gt; array(
						&#039;sortcode&#039; =&gt; array(
							&#039;label&#039; =&gt; __( &#039;Bank code&#039;, &#039;woocommerce&#039; ),
						),
					),
					&#039;US&#039; =&gt; array(
						&#039;sortcode&#039; =&gt; array(
							&#039;label&#039; =&gt; __( &#039;Routing number&#039;, &#039;woocommerce&#039; ),
						),
					),
					&#039;ZA&#039; =&gt; array(
						&#039;sortcode&#039; =&gt; array(
							&#039;label&#039; =&gt; __( &#039;Branch code&#039;, &#039;woocommerce&#039; ),
						),
					),
				)
			);

		}

		return $this-&gt;locale;

	}
}
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>WooCommerce Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on July 12th, 2021 at 10:33 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1626085995"></script>
    <script src="../js/search.js?updated=1626085995"></script>
</body>
</html>
