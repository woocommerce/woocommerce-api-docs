<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>WooCommerce Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1626085993">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1626085993">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.svg" alt="WooCommerce" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">WooCommerce Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/automattic.html"><abbr title="\Automattic">Automattic</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/automattic-woocommerce.html"><abbr title="\Automattic\WooCommerce">WooCommerce</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WooCommerce.html"><abbr title="\WooCommerce">WooCommerce</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WooCommerce-Classes.html"><abbr title="\WooCommerce\Classes">Classes</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Abstracts.html"><abbr title="\WooCommerce\Abstracts">Abstracts</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Admin.html"><abbr title="\WooCommerce\Admin">Admin</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Views.html"><abbr title="\WooCommerce\Views">Views</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Helper.html"><abbr title="\WooCommerce\Helper">Helper</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Templates.html"><abbr title="\WooCommerce\Templates">Templates</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Reports.html"><abbr title="\WooCommerce\Reports">Reports</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Blocks.html"><abbr title="\WooCommerce\Blocks">Blocks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-RestApi.html"><abbr title="\WooCommerce\RestApi">RestApi</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-CLI.html"><abbr title="\WooCommerce\CLI">CLI</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-l10n.html"><abbr title="\WooCommerce\l10n">l10n</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Webhooks.html"><abbr title="\WooCommerce\Webhooks">Webhooks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-DataStores.html"><abbr title="\WooCommerce\DataStores">DataStores</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Emails.html"><abbr title="\WooCommerce\Emails">Emails</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Export.html"><abbr title="\WooCommerce\Export">Export</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Gateways.html"><abbr title="\WooCommerce\Gateways">Gateways</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-PayPal.html"><abbr title="\WooCommerce\PayPal">PayPal</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Import.html"><abbr title="\WooCommerce\Import">Import</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Integrations.html"><abbr title="\WooCommerce\Integrations">Integrations</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Interfaces.html"><abbr title="\WooCommerce\Interfaces">Interfaces</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Interface.html"><abbr title="\WooCommerce\Interface">Interface</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-LogHandlers.html"><abbr title="\WooCommerce\LogHandlers">LogHandlers</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-PaymentTokens.html"><abbr title="\WooCommerce\PaymentTokens">PaymentTokens</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Utilities.html"><abbr title="\WooCommerce\Utilities">Utilities</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Shipping.html"><abbr title="\WooCommerce\Shipping">Shipping</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Shortcodes.html"><abbr title="\WooCommerce\Shortcodes">Shortcodes</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Tracks.html"><abbr title="\WooCommerce\Tracks">Tracks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Traits.html"><abbr title="\WooCommerce\Traits">Traits</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Functions.html"><abbr title="\WooCommerce\Functions">Functions</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-WCCom.html"><abbr title="\WooCommerce\WCCom">WCCom</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Widgets.html"><abbr title="\WooCommerce\Widgets">Widgets</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Uninstaller.html"><abbr title="\WooCommerce\Uninstaller">Uninstaller</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WoocommerceAdmin.html"><abbr title="\WoocommerceAdmin">WoocommerceAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WoocommerceNavigation.html"><abbr title="\WoocommerceNavigation">WoocommerceNavigation</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Automattic.html"><abbr title="\Automattic">Automattic</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/Automattic-WooCommerce.html"><abbr title="\Automattic\WooCommerce">WooCommerce</abbr></a></li>
                            </ul>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">abstract-wc-shipping-method.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * Abstract shipping method
 *
 * @class WC_Shipping_Method
 * @package WooCommerce\Abstracts
 */

if ( ! defined( &#039;ABSPATH&#039; ) ) {
	exit;
}

/**
 * WooCommerce Shipping Method Class.
 *
 * Extended by shipping methods to handle shipping calculations etc.
 *
 * @class       WC_Shipping_Method
 * @version     3.0.0
 * @package     WooCommerce\Abstracts
 */
abstract class WC_Shipping_Method extends WC_Settings_API {

	/**
	 * Features this method supports. Possible features used by core:
	 * - shipping-zones Shipping zone functionality + instances
	 * - instance-settings Instance settings screens.
	 * - settings Non-instance settings screens. Enabled by default for BW compatibility with methods before instances existed.
	 * - instance-settings-modal Allows the instance settings to be loaded within a modal in the zones UI.
	 *
	 * @var array
	 */
	public $supports = array( &#039;settings&#039; );

	/**
	 * Unique ID for the shipping method - must be set.
	 *
	 * @var string
	 */
	public $id = &#039;&#039;;

	/**
	 * Method title.
	 *
	 * @var string
	 */
	public $method_title = &#039;&#039;;

	/**
	 * Method description.
	 *
	 * @var string
	 */
	public $method_description = &#039;&#039;;

	/**
	 * Yes or no based on whether the method is enabled.
	 *
	 * @var string
	 */
	public $enabled = &#039;yes&#039;;

	/**
	 * Shipping method title for the frontend.
	 *
	 * @var string
	 */
	public $title;

	/**
	 * This is an array of rates - methods must populate this array to register shipping costs.
	 *
	 * @var array
	 */
	public $rates = array();

	/**
	 * If &#039;taxable&#039; tax will be charged for this method (if applicable).
	 *
	 * @var string
	 */
	public $tax_status = &#039;taxable&#039;;

	/**
	 * Fee for the method (if applicable).
	 *
	 * @var string
	 */
	public $fee = null;

	/**
	 * Minimum fee for the method (if applicable).
	 *
	 * @var string
	 */
	public $minimum_fee = null;

	/**
	 * Instance ID if used.
	 *
	 * @var int
	 */
	public $instance_id = 0;

	/**
	 * Instance form fields.
	 *
	 * @var array
	 */
	public $instance_form_fields = array();

	/**
	 * Instance settings.
	 *
	 * @var array
	 */
	public $instance_settings = array();

	/**
	 * Availability - legacy. Used for method Availability.
	 * No longer useful for instance based shipping methods.
	 *
	 * @deprecated 2.6.0
	 * @var string
	 */
	public $availability;

	/**
	 * Availability countries - legacy. Used for method Availability.
	 * No longer useful for instance based shipping methods.
	 *
	 * @deprecated 2.6.0
	 * @var array
	 */
	public $countries = array();

	/**
	 * Constructor.
	 *
	 * @param int $instance_id Instance ID.
	 */
	public function __construct( $instance_id = 0 ) {
		$this-&gt;instance_id = absint( $instance_id );
	}

	/**
	 * Check if a shipping method supports a given feature.
	 *
	 * Methods should override this to declare support (or lack of support) for a feature.
	 *
	 * @param string $feature The name of a feature to test support for.
	 * @return bool True if the shipping method supports the feature, false otherwise.
	 */
	public function supports( $feature ) {
		return apply_filters( &#039;woocommerce_shipping_method_supports&#039;, in_array( $feature, $this-&gt;supports ), $feature, $this );
	}

	/**
	 * Called to calculate shipping rates for this method. Rates can be added using the add_rate() method.
	 *
	 * @param array $package Package array.
	 */
	public function calculate_shipping( $package = array() ) {}

	/**
	 * Whether or not we need to calculate tax on top of the shipping rate.
	 *
	 * @return boolean
	 */
	public function is_taxable() {
		return wc_tax_enabled() &amp;&amp; &#039;taxable&#039; === $this-&gt;tax_status &amp;&amp; ( WC()-&gt;customer &amp;&amp; ! WC()-&gt;customer-&gt;get_is_vat_exempt() );
	}

	/**
	 * Whether or not this method is enabled in settings.
	 *
	 * @since 2.6.0
	 * @return boolean
	 */
	public function is_enabled() {
		return &#039;yes&#039; === $this-&gt;enabled;
	}

	/**
	 * Return the shipping method instance ID.
	 *
	 * @since 2.6.0
	 * @return int
	 */
	public function get_instance_id() {
		return $this-&gt;instance_id;
	}

	/**
	 * Return the shipping method title.
	 *
	 * @since 2.6.0
	 * @return string
	 */
	public function get_method_title() {
		return apply_filters( &#039;woocommerce_shipping_method_title&#039;, $this-&gt;method_title, $this );
	}

	/**
	 * Return the shipping method description.
	 *
	 * @since 2.6.0
	 * @return string
	 */
	public function get_method_description() {
		return apply_filters( &#039;woocommerce_shipping_method_description&#039;, $this-&gt;method_description, $this );
	}

	/**
	 * Return the shipping title which is user set.
	 *
	 * @return string
	 */
	public function get_title() {
		return apply_filters( &#039;woocommerce_shipping_method_title&#039;, $this-&gt;title, $this-&gt;id );
	}

	/**
	 * Return calculated rates for a package.
	 *
	 * @since 2.6.0
	 * @param array $package Package array.
	 * @return array
	 */
	public function get_rates_for_package( $package ) {
		$this-&gt;rates = array();
		if ( $this-&gt;is_available( $package ) &amp;&amp; ( empty( $package[&#039;ship_via&#039;] ) || in_array( $this-&gt;id, $package[&#039;ship_via&#039;] ) ) ) {
			$this-&gt;calculate_shipping( $package );
		}
		return $this-&gt;rates;
	}

	/**
	 * Returns a rate ID based on this methods ID and instance, with an optional
	 * suffix if distinguishing between multiple rates.
	 *
	 * @since 2.6.0
	 * @param string $suffix Suffix.
	 * @return string
	 */
	public function get_rate_id( $suffix = &#039;&#039; ) {
		$rate_id = array( $this-&gt;id );

		if ( $this-&gt;instance_id ) {
			$rate_id[] = $this-&gt;instance_id;
		}

		if ( $suffix ) {
			$rate_id[] = $suffix;
		}

		return implode( &#039;:&#039;, $rate_id );
	}

	/**
	 * Add a shipping rate. If taxes are not set they will be calculated based on cost.
	 *
	 * @param array $args Arguments (default: array()).
	 */
	public function add_rate( $args = array() ) {
		$args = apply_filters(
			&#039;woocommerce_shipping_method_add_rate_args&#039;,
			wp_parse_args(
				$args,
				array(
					&#039;id&#039;             =&gt; $this-&gt;get_rate_id(), // ID for the rate. If not passed, this id:instance default will be used.
					&#039;label&#039;          =&gt; &#039;&#039;, // Label for the rate.
					&#039;cost&#039;           =&gt; &#039;0&#039;, // Amount or array of costs (per item shipping).
					&#039;taxes&#039;          =&gt; &#039;&#039;, // Pass taxes, or leave empty to have it calculated for you, or &#039;false&#039; to disable calculations.
					&#039;calc_tax&#039;       =&gt; &#039;per_order&#039;, // Calc tax per_order or per_item. Per item needs an array of costs.
					&#039;meta_data&#039;      =&gt; array(), // Array of misc meta data to store along with this rate - key value pairs.
					&#039;package&#039;        =&gt; false, // Package array this rate was generated for @since 2.6.0.
					&#039;price_decimals&#039; =&gt; wc_get_price_decimals(),
				)
			),
			$this
		);

		// ID and label are required.
		if ( ! $args[&#039;id&#039;] || ! $args[&#039;label&#039;] ) {
			return;
		}

		// Total up the cost.
		$total_cost = is_array( $args[&#039;cost&#039;] ) ? array_sum( $args[&#039;cost&#039;] ) : $args[&#039;cost&#039;];
		$taxes      = $args[&#039;taxes&#039;];

		// Taxes - if not an array and not set to false, calc tax based on cost and passed calc_tax variable. This saves shipping methods having to do complex tax calculations.
		if ( ! is_array( $taxes ) &amp;&amp; false !== $taxes &amp;&amp; $total_cost &gt; 0 &amp;&amp; $this-&gt;is_taxable() ) {
			$taxes = &#039;per_item&#039; === $args[&#039;calc_tax&#039;] ? $this-&gt;get_taxes_per_item( $args[&#039;cost&#039;] ) : WC_Tax::calc_shipping_tax( $total_cost, WC_Tax::get_shipping_tax_rates() );
		}

		// Round the total cost after taxes have been calculated.
		$total_cost = wc_format_decimal( $total_cost, $args[&#039;price_decimals&#039;] );

		// Create rate object.
		$rate = new WC_Shipping_Rate();
		$rate-&gt;set_id( $args[&#039;id&#039;] );
		$rate-&gt;set_method_id( $this-&gt;id );
		$rate-&gt;set_instance_id( $this-&gt;instance_id );
		$rate-&gt;set_label( $args[&#039;label&#039;] );
		$rate-&gt;set_cost( $total_cost );
		$rate-&gt;set_taxes( $taxes );

		if ( ! empty( $args[&#039;meta_data&#039;] ) ) {
			foreach ( $args[&#039;meta_data&#039;] as $key =&gt; $value ) {
				$rate-&gt;add_meta_data( $key, $value );
			}
		}

		// Store package data.
		if ( $args[&#039;package&#039;] ) {
			$items_in_package = array();
			foreach ( $args[&#039;package&#039;][&#039;contents&#039;] as $item ) {
				$product            = $item[&#039;data&#039;];
				$items_in_package[] = $product-&gt;get_name() . &#039; &amp;times; &#039; . $item[&#039;quantity&#039;];
			}
			$rate-&gt;add_meta_data( __( &#039;Items&#039;, &#039;woocommerce&#039; ), implode( &#039;, &#039;, $items_in_package ) );
		}

		$this-&gt;rates[ $args[&#039;id&#039;] ] = apply_filters( &#039;woocommerce_shipping_method_add_rate&#039;, $rate, $args, $this );
	}

	/**
	 * Calc taxes per item being shipping in costs array.
	 *
	 * @since 2.6.0
	 * @param  array $costs Costs.
	 * @return array of taxes
	 */
	protected function get_taxes_per_item( $costs ) {
		$taxes = array();

		// If we have an array of costs we can look up each items tax class and add tax accordingly.
		if ( is_array( $costs ) ) {

			$cart = WC()-&gt;cart-&gt;get_cart();

			foreach ( $costs as $cost_key =&gt; $amount ) {
				if ( ! isset( $cart[ $cost_key ] ) ) {
					continue;
				}

				$item_taxes = WC_Tax::calc_shipping_tax( $amount, WC_Tax::get_shipping_tax_rates( $cart[ $cost_key ][&#039;data&#039;]-&gt;get_tax_class() ) );

				// Sum the item taxes.
				foreach ( array_keys( $taxes + $item_taxes ) as $key ) {
					$taxes[ $key ] = ( isset( $item_taxes[ $key ] ) ? $item_taxes[ $key ] : 0 ) + ( isset( $taxes[ $key ] ) ? $taxes[ $key ] : 0 );
				}
			}

			// Add any cost for the order - order costs are in the key &#039;order&#039;.
			if ( isset( $costs[&#039;order&#039;] ) ) {
				$item_taxes = WC_Tax::calc_shipping_tax( $costs[&#039;order&#039;], WC_Tax::get_shipping_tax_rates() );

				// Sum the item taxes.
				foreach ( array_keys( $taxes + $item_taxes ) as $key ) {
					$taxes[ $key ] = ( isset( $item_taxes[ $key ] ) ? $item_taxes[ $key ] : 0 ) + ( isset( $taxes[ $key ] ) ? $taxes[ $key ] : 0 );
				}
			}
		}

		return $taxes;
	}

	/**
	 * Is this method available?
	 *
	 * @param array $package Package.
	 * @return bool
	 */
	public function is_available( $package ) {
		$available = $this-&gt;is_enabled();

		// Country availability (legacy, for non-zone based methods).
		if ( ! $this-&gt;instance_id &amp;&amp; $available ) {
			$countries = is_array( $this-&gt;countries ) ? $this-&gt;countries : array();

			switch ( $this-&gt;availability ) {
				case &#039;specific&#039;:
				case &#039;including&#039;:
					$available = in_array( $package[&#039;destination&#039;][&#039;country&#039;], array_intersect( $countries, array_keys( WC()-&gt;countries-&gt;get_shipping_countries() ) ) );
					break;
				case &#039;excluding&#039;:
					$available = in_array( $package[&#039;destination&#039;][&#039;country&#039;], array_diff( array_keys( WC()-&gt;countries-&gt;get_shipping_countries() ), $countries ) );
					break;
				default:
					$available = in_array( $package[&#039;destination&#039;][&#039;country&#039;], array_keys( WC()-&gt;countries-&gt;get_shipping_countries() ) );
					break;
			}
		}

		return apply_filters( &#039;woocommerce_shipping_&#039; . $this-&gt;id . &#039;_is_available&#039;, $available, $package, $this );
	}

	/**
	 * Get fee to add to shipping cost.
	 *
	 * @param string|float $fee Fee.
	 * @param float        $total Total.
	 * @return float
	 */
	public function get_fee( $fee, $total ) {
		if ( strstr( $fee, &#039;%&#039; ) ) {
			$fee = ( $total / 100 ) * str_replace( &#039;%&#039;, &#039;&#039;, $fee );
		}
		if ( ! empty( $this-&gt;minimum_fee ) &amp;&amp; $this-&gt;minimum_fee &gt; $fee ) {
			$fee = $this-&gt;minimum_fee;
		}
		return $fee;
	}

	/**
	 * Does this method have a settings page?
	 *
	 * @return bool
	 */
	public function has_settings() {
		return $this-&gt;instance_id ? $this-&gt;supports( &#039;instance-settings&#039; ) : $this-&gt;supports( &#039;settings&#039; );
	}

	/**
	 * Return admin options as a html string.
	 *
	 * @return string
	 */
	public function get_admin_options_html() {
		if ( $this-&gt;instance_id ) {
			$settings_html = $this-&gt;generate_settings_html( $this-&gt;get_instance_form_fields(), false );
		} else {
			$settings_html = $this-&gt;generate_settings_html( $this-&gt;get_form_fields(), false );
		}

		return &#039;&lt;table class=&quot;form-table&quot;&gt;&#039; . $settings_html . &#039;&lt;/table&gt;&#039;;
	}

	/**
	 * Output the shipping settings screen.
	 */
	public function admin_options() {
		if ( ! $this-&gt;instance_id ) {
			echo &#039;&lt;h2&gt;&#039; . esc_html( $this-&gt;get_method_title() ) . &#039;&lt;/h2&gt;&#039;;
		}
		echo wp_kses_post( wpautop( $this-&gt;get_method_description() ) );
		echo $this-&gt;get_admin_options_html(); // phpcs:ignore WordPress.XSS.EscapeOutput.OutputNotEscaped
	}

	/**
	 * Get_option function.
	 *
	 * Gets and option from the settings API, using defaults if necessary to prevent undefined notices.
	 *
	 * @param  string $key Key.
	 * @param  mixed  $empty_value Empty value.
	 * @return mixed  The value specified for the option or a default value for the option.
	 */
	public function get_option( $key, $empty_value = null ) {
		// Instance options take priority over global options.
		if ( $this-&gt;instance_id &amp;&amp; array_key_exists( $key, $this-&gt;get_instance_form_fields() ) ) {
			return $this-&gt;get_instance_option( $key, $empty_value );
		}

		// Return global option.
		$option = apply_filters( &#039;woocommerce_shipping_&#039; . $this-&gt;id . &#039;_option&#039;, parent::get_option( $key, $empty_value ), $key, $this );
		return $option;
	}

	/**
	 * Gets an option from the settings API, using defaults if necessary to prevent undefined notices.
	 *
	 * @param  string $key Key.
	 * @param  mixed  $empty_value Empty value.
	 * @return mixed  The value specified for the option or a default value for the option.
	 */
	public function get_instance_option( $key, $empty_value = null ) {
		if ( empty( $this-&gt;instance_settings ) ) {
			$this-&gt;init_instance_settings();
		}

		// Get option default if unset.
		if ( ! isset( $this-&gt;instance_settings[ $key ] ) ) {
			$form_fields                     = $this-&gt;get_instance_form_fields();
			$this-&gt;instance_settings[ $key ] = $this-&gt;get_field_default( $form_fields[ $key ] );
		}

		if ( ! is_null( $empty_value ) &amp;&amp; &#039;&#039; === $this-&gt;instance_settings[ $key ] ) {
			$this-&gt;instance_settings[ $key ] = $empty_value;
		}

		$instance_option = apply_filters( &#039;woocommerce_shipping_&#039; . $this-&gt;id . &#039;_instance_option&#039;, $this-&gt;instance_settings[ $key ], $key, $this );
		return $instance_option;
	}

	/**
	 * Get settings fields for instances of this shipping method (within zones).
	 * Should be overridden by shipping methods to add options.
	 *
	 * @since 2.6.0
	 * @return array
	 */
	public function get_instance_form_fields() {
		return apply_filters( &#039;woocommerce_shipping_instance_form_fields_&#039; . $this-&gt;id, array_map( array( $this, &#039;set_defaults&#039; ), $this-&gt;instance_form_fields ) );
	}

	/**
	 * Return the name of the option in the WP DB.
	 *
	 * @since 2.6.0
	 * @return string
	 */
	public function get_instance_option_key() {
		return $this-&gt;instance_id ? $this-&gt;plugin_id . $this-&gt;id . &#039;_&#039; . $this-&gt;instance_id . &#039;_settings&#039; : &#039;&#039;;
	}

	/**
	 * Initialise Settings for instances.
	 *
	 * @since 2.6.0
	 */
	public function init_instance_settings() {
		$this-&gt;instance_settings = get_option( $this-&gt;get_instance_option_key(), null );

		// If there are no settings defined, use defaults.
		if ( ! is_array( $this-&gt;instance_settings ) ) {
			$form_fields             = $this-&gt;get_instance_form_fields();
			$this-&gt;instance_settings = array_merge( array_fill_keys( array_keys( $form_fields ), &#039;&#039; ), wp_list_pluck( $form_fields, &#039;default&#039; ) );
		}
	}

	/**
	 * Processes and saves global shipping method options in the admin area.
	 *
	 * This method is usually attached to woocommerce_update_options_x hooks.
	 *
	 * @since 2.6.0
	 * @return bool was anything saved?
	 */
	public function process_admin_options() {
		if ( ! $this-&gt;instance_id ) {
			return parent::process_admin_options();
		}

		// Check we are processing the correct form for this instance.
		if ( ! isset( $_REQUEST[&#039;instance_id&#039;] ) || absint( $_REQUEST[&#039;instance_id&#039;] ) !== $this-&gt;instance_id ) { // WPCS: input var ok, CSRF ok.
			return false;
		}

		$this-&gt;init_instance_settings();

		$post_data = $this-&gt;get_post_data();

		foreach ( $this-&gt;get_instance_form_fields() as $key =&gt; $field ) {
			if ( &#039;title&#039; !== $this-&gt;get_field_type( $field ) ) {
				try {
					$this-&gt;instance_settings[ $key ] = $this-&gt;get_field_value( $key, $field, $post_data );
				} catch ( Exception $e ) {
					$this-&gt;add_error( $e-&gt;getMessage() );
				}
			}
		}

		return update_option( $this-&gt;get_instance_option_key(), apply_filters( &#039;woocommerce_shipping_&#039; . $this-&gt;id . &#039;_instance_settings_values&#039;, $this-&gt;instance_settings, $this ), &#039;yes&#039; );
	}
}
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>WooCommerce Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on July 12th, 2021 at 10:33 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1626085993"></script>
    <script src="../js/search.js?updated=1626085993"></script>
</body>
</html>
