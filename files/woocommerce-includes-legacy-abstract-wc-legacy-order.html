<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>WooCommerce Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1626085995">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1626085995">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.svg" alt="WooCommerce" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">WooCommerce Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/automattic.html"><abbr title="\Automattic">Automattic</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/automattic-woocommerce.html"><abbr title="\Automattic\WooCommerce">WooCommerce</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WooCommerce.html"><abbr title="\WooCommerce">WooCommerce</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WooCommerce-Classes.html"><abbr title="\WooCommerce\Classes">Classes</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Abstracts.html"><abbr title="\WooCommerce\Abstracts">Abstracts</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Admin.html"><abbr title="\WooCommerce\Admin">Admin</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Views.html"><abbr title="\WooCommerce\Views">Views</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Helper.html"><abbr title="\WooCommerce\Helper">Helper</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Templates.html"><abbr title="\WooCommerce\Templates">Templates</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Reports.html"><abbr title="\WooCommerce\Reports">Reports</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Blocks.html"><abbr title="\WooCommerce\Blocks">Blocks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-RestApi.html"><abbr title="\WooCommerce\RestApi">RestApi</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-CLI.html"><abbr title="\WooCommerce\CLI">CLI</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-l10n.html"><abbr title="\WooCommerce\l10n">l10n</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Webhooks.html"><abbr title="\WooCommerce\Webhooks">Webhooks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-DataStores.html"><abbr title="\WooCommerce\DataStores">DataStores</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Emails.html"><abbr title="\WooCommerce\Emails">Emails</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Export.html"><abbr title="\WooCommerce\Export">Export</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Gateways.html"><abbr title="\WooCommerce\Gateways">Gateways</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-PayPal.html"><abbr title="\WooCommerce\PayPal">PayPal</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Import.html"><abbr title="\WooCommerce\Import">Import</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Integrations.html"><abbr title="\WooCommerce\Integrations">Integrations</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Interfaces.html"><abbr title="\WooCommerce\Interfaces">Interfaces</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Interface.html"><abbr title="\WooCommerce\Interface">Interface</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-LogHandlers.html"><abbr title="\WooCommerce\LogHandlers">LogHandlers</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-PaymentTokens.html"><abbr title="\WooCommerce\PaymentTokens">PaymentTokens</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Utilities.html"><abbr title="\WooCommerce\Utilities">Utilities</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Shipping.html"><abbr title="\WooCommerce\Shipping">Shipping</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Shortcodes.html"><abbr title="\WooCommerce\Shortcodes">Shortcodes</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Tracks.html"><abbr title="\WooCommerce\Tracks">Tracks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Traits.html"><abbr title="\WooCommerce\Traits">Traits</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Functions.html"><abbr title="\WooCommerce\Functions">Functions</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-WCCom.html"><abbr title="\WooCommerce\WCCom">WCCom</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Widgets.html"><abbr title="\WooCommerce\Widgets">Widgets</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Uninstaller.html"><abbr title="\WooCommerce\Uninstaller">Uninstaller</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WoocommerceAdmin.html"><abbr title="\WoocommerceAdmin">WoocommerceAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WoocommerceNavigation.html"><abbr title="\WoocommerceNavigation">WoocommerceNavigation</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Automattic.html"><abbr title="\Automattic">Automattic</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/Automattic-WooCommerce.html"><abbr title="\Automattic\WooCommerce">WooCommerce</abbr></a></li>
                            </ul>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">abstract-wc-legacy-order.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
if ( ! defined( &#039;ABSPATH&#039; ) ) {
	exit;
}

/**
 * Legacy Abstract Order
 *
 * Legacy and deprecated functions are here to keep the WC_Abstract_Order clean.
 * This class will be removed in future versions.
 *
 * @version	 3.0.0
 * @package	 WooCommerce\Abstracts
 * @category	Abstract Class
 * @author	  WooThemes
 */
abstract class WC_Abstract_Legacy_Order extends WC_Data {

	/**
	 * Add coupon code to the order.
	 * @param string|array $code
	 * @param int $discount tax amount.
	 * @param int $discount_tax amount.
	 * @return int order item ID
	 * @throws WC_Data_Exception
	 */
	public function add_coupon( $code = array(), $discount = 0, $discount_tax = 0 ) {
		wc_deprecated_function( &#039;WC_Order::add_coupon&#039;, &#039;3.0&#039;, &#039;a new WC_Order_Item_Coupon object and add to order with WC_Order::add_item()&#039; );

		$item = new WC_Order_Item_Coupon();
		$item-&gt;set_props( array(
			&#039;code&#039;         =&gt; $code,
			&#039;discount&#039;     =&gt; $discount,
			&#039;discount_tax&#039; =&gt; $discount_tax,
			&#039;order_id&#039;     =&gt; $this-&gt;get_id(),
		) );
		$item-&gt;save();
		$this-&gt;add_item( $item );
		wc_do_deprecated_action( &#039;woocommerce_order_add_coupon&#039;, array( $this-&gt;get_id(), $item-&gt;get_id(), $code, $discount, $discount_tax ), &#039;3.0&#039;, &#039;woocommerce_new_order_item action instead.&#039; );
		return $item-&gt;get_id();
	}

	/**
	 * Add a tax row to the order.
	 * @param int $tax_rate_id
	 * @param int $tax_amount amount of tax.
	 * @param int $shipping_tax_amount shipping amount.
	 * @return int order item ID
	 * @throws WC_Data_Exception
	 */
	public function add_tax( $tax_rate_id, $tax_amount = 0, $shipping_tax_amount = 0 ) {
		wc_deprecated_function( &#039;WC_Order::add_tax&#039;, &#039;3.0&#039;, &#039;a new WC_Order_Item_Tax object and add to order with WC_Order::add_item()&#039; );

		$item = new WC_Order_Item_Tax();
		$item-&gt;set_props( array(
			&#039;rate_id&#039;            =&gt; $tax_rate_id,
			&#039;tax_total&#039;          =&gt; $tax_amount,
			&#039;shipping_tax_total&#039; =&gt; $shipping_tax_amount,
		) );
		$item-&gt;set_rate( $tax_rate_id );
		$item-&gt;set_order_id( $this-&gt;get_id() );
		$item-&gt;save();
		$this-&gt;add_item( $item );
		wc_do_deprecated_action( &#039;woocommerce_order_add_tax&#039;, array( $this-&gt;get_id(), $item-&gt;get_id(), $tax_rate_id, $tax_amount, $shipping_tax_amount ), &#039;3.0&#039;, &#039;woocommerce_new_order_item action instead.&#039; );
		return $item-&gt;get_id();
	}

	/**
	 * Add a shipping row to the order.
	 * @param WC_Shipping_Rate shipping_rate
	 * @return int order item ID
	 * @throws WC_Data_Exception
	 */
	public function add_shipping( $shipping_rate ) {
		wc_deprecated_function( &#039;WC_Order::add_shipping&#039;, &#039;3.0&#039;, &#039;a new WC_Order_Item_Shipping object and add to order with WC_Order::add_item()&#039; );

		$item = new WC_Order_Item_Shipping();
		$item-&gt;set_props( array(
			&#039;method_title&#039; =&gt; $shipping_rate-&gt;label,
			&#039;method_id&#039;    =&gt; $shipping_rate-&gt;id,
			&#039;total&#039;        =&gt; wc_format_decimal( $shipping_rate-&gt;cost ),
			&#039;taxes&#039;        =&gt; $shipping_rate-&gt;taxes,
			&#039;order_id&#039;     =&gt; $this-&gt;get_id(),
		) );
		foreach ( $shipping_rate-&gt;get_meta_data() as $key =&gt; $value ) {
			$item-&gt;add_meta_data( $key, $value, true );
		}
		$item-&gt;save();
		$this-&gt;add_item( $item );
		wc_do_deprecated_action( &#039;woocommerce_order_add_shipping&#039;, array( $this-&gt;get_id(), $item-&gt;get_id(), $shipping_rate ), &#039;3.0&#039;, &#039;woocommerce_new_order_item action instead.&#039; );
		return $item-&gt;get_id();
	}

	/**
	 * Add a fee to the order.
	 * Order must be saved prior to adding items.
	 *
	 * Fee is an amount of money charged for a particular piece of work
	 * or for a particular right or service, and not supposed to be negative.
	 *
	 * @throws WC_Data_Exception
	 * @param  object $fee Fee data.
	 * @return int         Updated order item ID.
	 */
	public function add_fee( $fee ) {
		wc_deprecated_function( &#039;WC_Order::add_fee&#039;, &#039;3.0&#039;, &#039;a new WC_Order_Item_Fee object and add to order with WC_Order::add_item()&#039; );

		$item = new WC_Order_Item_Fee();
		$item-&gt;set_props( array(
			&#039;name&#039;      =&gt; $fee-&gt;name,
			&#039;tax_class&#039; =&gt; $fee-&gt;taxable ? $fee-&gt;tax_class : 0,
			&#039;total&#039;     =&gt; $fee-&gt;amount,
			&#039;total_tax&#039; =&gt; $fee-&gt;tax,
			&#039;taxes&#039;     =&gt; array(
				&#039;total&#039; =&gt; $fee-&gt;tax_data,
			),
			&#039;order_id&#039;  =&gt; $this-&gt;get_id(),
		) );
		$item-&gt;save();
		$this-&gt;add_item( $item );
		wc_do_deprecated_action( &#039;woocommerce_order_add_fee&#039;, array( $this-&gt;get_id(), $item-&gt;get_id(), $fee ), &#039;3.0&#039;, &#039;woocommerce_new_order_item action instead.&#039; );
		return $item-&gt;get_id();
	}

	/**
	 * Update a line item for the order.
	 *
	 * Note this does not update order totals.
	 *
	 * @param object|int $item order item ID or item object.
	 * @param WC_Product $product
	 * @param array $args data to update.
	 * @return int updated order item ID
	 * @throws WC_Data_Exception
	 */
	public function update_product( $item, $product, $args ) {
		wc_deprecated_function( &#039;WC_Order::update_product&#039;, &#039;3.0&#039;, &#039;an interaction with the WC_Order_Item_Product class&#039; );
		if ( is_numeric( $item ) ) {
			$item = $this-&gt;get_item( $item );
		}
		if ( ! is_object( $item ) || ! $item-&gt;is_type( &#039;line_item&#039; ) ) {
			return false;
		}
		if ( ! $this-&gt;get_id() ) {
			$this-&gt;save(); // Order must exist
		}

		// BW compatibility with old args
		if ( isset( $args[&#039;totals&#039;] ) ) {
			foreach ( $args[&#039;totals&#039;] as $key =&gt; $value ) {
				if ( &#039;tax&#039; === $key ) {
					$args[&#039;total_tax&#039;] = $value;
				} elseif ( &#039;tax_data&#039; === $key ) {
					$args[&#039;taxes&#039;] = $value;
				} else {
					$args[ $key ] = $value;
				}
			}
		}

		// Handle qty if set.
		if ( isset( $args[&#039;qty&#039;] ) ) {
			if ( $product-&gt;backorders_require_notification() &amp;&amp; $product-&gt;is_on_backorder( $args[&#039;qty&#039;] ) ) {
				$item-&gt;add_meta_data( apply_filters( &#039;woocommerce_backordered_item_meta_name&#039;, __( &#039;Backordered&#039;, &#039;woocommerce&#039; ), $item ), $args[&#039;qty&#039;] - max( 0, $product-&gt;get_stock_quantity() ), true );
			}
			$args[&#039;subtotal&#039;] = $args[&#039;subtotal&#039;] ? $args[&#039;subtotal&#039;] : wc_get_price_excluding_tax( $product, array( &#039;qty&#039; =&gt; $args[&#039;qty&#039;] ) );
			$args[&#039;total&#039;]	= $args[&#039;total&#039;] ? $args[&#039;total&#039;] : wc_get_price_excluding_tax( $product, array( &#039;qty&#039; =&gt; $args[&#039;qty&#039;] ) );
		}

		$item-&gt;set_order_id( $this-&gt;get_id() );
		$item-&gt;set_props( $args );
		$item-&gt;save();
		do_action( &#039;woocommerce_order_edit_product&#039;, $this-&gt;get_id(), $item-&gt;get_id(), $args, $product );

		return $item-&gt;get_id();
	}

	/**
	 * Update coupon for order. Note this does not update order totals.
	 * @param object|int $item
	 * @param array $args
	 * @return int updated order item ID
	 * @throws WC_Data_Exception
	 */
	public function update_coupon( $item, $args ) {
		wc_deprecated_function( &#039;WC_Order::update_coupon&#039;, &#039;3.0&#039;, &#039;an interaction with the WC_Order_Item_Coupon class&#039; );
		if ( is_numeric( $item ) ) {
			$item = $this-&gt;get_item( $item );
		}
		if ( ! is_object( $item ) || ! $item-&gt;is_type( &#039;coupon&#039; ) ) {
			return false;
		}
		if ( ! $this-&gt;get_id() ) {
			$this-&gt;save(); // Order must exist
		}

		// BW compatibility for old args
		if ( isset( $args[&#039;discount_amount&#039;] ) ) {
			$args[&#039;discount&#039;] = $args[&#039;discount_amount&#039;];
		}
		if ( isset( $args[&#039;discount_amount_tax&#039;] ) ) {
			$args[&#039;discount_tax&#039;] = $args[&#039;discount_amount_tax&#039;];
		}

		$item-&gt;set_order_id( $this-&gt;get_id() );
		$item-&gt;set_props( $args );
		$item-&gt;save();

		do_action( &#039;woocommerce_order_update_coupon&#039;, $this-&gt;get_id(), $item-&gt;get_id(), $args );

		return $item-&gt;get_id();
	}

	/**
	 * Update shipping method for order.
	 *
	 * Note this does not update the order total.
	 *
	 * @param object|int $item
	 * @param array $args
	 * @return int updated order item ID
	 * @throws WC_Data_Exception
	 */
	public function update_shipping( $item, $args ) {
		wc_deprecated_function( &#039;WC_Order::update_shipping&#039;, &#039;3.0&#039;, &#039;an interaction with the WC_Order_Item_Shipping class&#039; );
		if ( is_numeric( $item ) ) {
			$item = $this-&gt;get_item( $item );
		}
		if ( ! is_object( $item ) || ! $item-&gt;is_type( &#039;shipping&#039; ) ) {
			return false;
		}
		if ( ! $this-&gt;get_id() ) {
			$this-&gt;save(); // Order must exist
		}

		// BW compatibility for old args
		if ( isset( $args[&#039;cost&#039;] ) ) {
			$args[&#039;total&#039;] = $args[&#039;cost&#039;];
		}

		$item-&gt;set_order_id( $this-&gt;get_id() );
		$item-&gt;set_props( $args );
		$item-&gt;save();
		$this-&gt;calculate_shipping();

		do_action( &#039;woocommerce_order_update_shipping&#039;, $this-&gt;get_id(), $item-&gt;get_id(), $args );

		return $item-&gt;get_id();
	}

	/**
	 * Update fee for order.
	 *
	 * Note this does not update order totals.
	 *
	 * @param object|int $item
	 * @param array $args
	 * @return int updated order item ID
	 * @throws WC_Data_Exception
	 */
	public function update_fee( $item, $args ) {
		wc_deprecated_function( &#039;WC_Order::update_fee&#039;, &#039;3.0&#039;, &#039;an interaction with the WC_Order_Item_Fee class&#039; );
		if ( is_numeric( $item ) ) {
			$item = $this-&gt;get_item( $item );
		}
		if ( ! is_object( $item ) || ! $item-&gt;is_type( &#039;fee&#039; ) ) {
			return false;
		}
		if ( ! $this-&gt;get_id() ) {
			$this-&gt;save(); // Order must exist
		}

		$item-&gt;set_order_id( $this-&gt;get_id() );
		$item-&gt;set_props( $args );
		$item-&gt;save();

		do_action( &#039;woocommerce_order_update_fee&#039;, $this-&gt;get_id(), $item-&gt;get_id(), $args );

		return $item-&gt;get_id();
	}

	/**
	 * Update tax line on order.
	 * Note this does not update order totals.
	 *
	 * @since 3.0
	 * @param object|int $item
	 * @param array $args
	 * @return int updated order item ID
	 * @throws WC_Data_Exception
	 */
	public function update_tax( $item, $args ) {
		wc_deprecated_function( &#039;WC_Order::update_tax&#039;, &#039;3.0&#039;, &#039;an interaction with the WC_Order_Item_Tax class&#039; );
		if ( is_numeric( $item ) ) {
			$item = $this-&gt;get_item( $item );
		}
		if ( ! is_object( $item ) || ! $item-&gt;is_type( &#039;tax&#039; ) ) {
			return false;
		}
		if ( ! $this-&gt;get_id() ) {
			$this-&gt;save(); // Order must exist
		}

		$item-&gt;set_order_id( $this-&gt;get_id() );
		$item-&gt;set_props( $args );
		$item-&gt;save();

		do_action( &#039;woocommerce_order_update_tax&#039;, $this-&gt;get_id(), $item-&gt;get_id(), $args );

		return $item-&gt;get_id();
	}

	/**
	 * Get a product (either product or variation).
	 * @deprecated 4.4.0
	 * @param object $item
	 * @return WC_Product|bool
	 */
	public function get_product_from_item( $item ) {
		wc_deprecated_function( &#039;WC_Abstract_Legacy_Order::get_product_from_item&#039;, &#039;4.4.0&#039;, &#039;$item-&gt;get_product()&#039; );
		if ( is_callable( array( $item, &#039;get_product&#039; ) ) ) {
			$product = $item-&gt;get_product();
		} else {
			$product = false;
		}
		return apply_filters( &#039;woocommerce_get_product_from_item&#039;, $product, $item, $this );
	}

	/**
	 * Set the customer address.
	 * @param array $address Address data.
	 * @param string $type billing or shipping.
	 */
	public function set_address( $address, $type = &#039;billing&#039; ) {
		foreach ( $address as $key =&gt; $value ) {
			update_post_meta( $this-&gt;get_id(), &quot;_{$type}_&quot; . $key, $value );
			if ( is_callable( array( $this, &quot;set_{$type}_{$key}&quot; ) ) ) {
				$this-&gt;{&quot;set_{$type}_{$key}&quot;}( $value );
			}
		}
	}

	/**
	 * Set an order total.
	 * @param float $amount
	 * @param string $total_type
	 * @return bool
	 */
	public function legacy_set_total( $amount, $total_type = &#039;total&#039; ) {
		if ( ! in_array( $total_type, array( &#039;shipping&#039;, &#039;tax&#039;, &#039;shipping_tax&#039;, &#039;total&#039;, &#039;cart_discount&#039;, &#039;cart_discount_tax&#039; ) ) ) {
			return false;
		}

		switch ( $total_type ) {
			case &#039;total&#039; :
				$amount = wc_format_decimal( $amount, wc_get_price_decimals() );
				$this-&gt;set_total( $amount );
				update_post_meta( $this-&gt;get_id(), &#039;_order_total&#039;, $amount );
				break;
			case &#039;cart_discount&#039; :
				$amount = wc_format_decimal( $amount );
				$this-&gt;set_discount_total( $amount );
				update_post_meta( $this-&gt;get_id(), &#039;_cart_discount&#039;, $amount );
				break;
			case &#039;cart_discount_tax&#039; :
				$amount = wc_format_decimal( $amount );
				$this-&gt;set_discount_tax( $amount );
				update_post_meta( $this-&gt;get_id(), &#039;_cart_discount_tax&#039;, $amount );
				break;
			case &#039;shipping&#039; :
				$amount = wc_format_decimal( $amount );
				$this-&gt;set_shipping_total( $amount );
				update_post_meta( $this-&gt;get_id(), &#039;_order_shipping&#039;, $amount );
				break;
			case &#039;shipping_tax&#039; :
				$amount = wc_format_decimal( $amount );
				$this-&gt;set_shipping_tax( $amount );
				update_post_meta( $this-&gt;get_id(), &#039;_order_shipping_tax&#039;, $amount );
				break;
			case &#039;tax&#039; :
				$amount = wc_format_decimal( $amount );
				$this-&gt;set_cart_tax( $amount );
				update_post_meta( $this-&gt;get_id(), &#039;_order_tax&#039;, $amount );
				break;
		}

		return true;
	}

	/**
	 * Magic __isset method for backwards compatibility. Handles legacy properties which could be accessed directly in the past.
	 *
	 * @param string $key
	 * @return bool
	 */
	public function __isset( $key ) {
		$legacy_props = array( &#039;completed_date&#039;, &#039;id&#039;, &#039;order_type&#039;, &#039;post&#039;, &#039;status&#039;, &#039;post_status&#039;, &#039;customer_note&#039;, &#039;customer_message&#039;, &#039;user_id&#039;, &#039;customer_user&#039;, &#039;prices_include_tax&#039;, &#039;tax_display_cart&#039;, &#039;display_totals_ex_tax&#039;, &#039;display_cart_ex_tax&#039;, &#039;order_date&#039;, &#039;modified_date&#039;, &#039;cart_discount&#039;, &#039;cart_discount_tax&#039;, &#039;order_shipping&#039;, &#039;order_shipping_tax&#039;, &#039;order_total&#039;, &#039;order_tax&#039;, &#039;billing_first_name&#039;, &#039;billing_last_name&#039;, &#039;billing_company&#039;, &#039;billing_address_1&#039;, &#039;billing_address_2&#039;, &#039;billing_city&#039;, &#039;billing_state&#039;, &#039;billing_postcode&#039;, &#039;billing_country&#039;, &#039;billing_phone&#039;, &#039;billing_email&#039;, &#039;shipping_first_name&#039;, &#039;shipping_last_name&#039;, &#039;shipping_company&#039;, &#039;shipping_address_1&#039;, &#039;shipping_address_2&#039;, &#039;shipping_city&#039;, &#039;shipping_state&#039;, &#039;shipping_postcode&#039;, &#039;shipping_country&#039;, &#039;customer_ip_address&#039;, &#039;customer_user_agent&#039;, &#039;payment_method_title&#039;, &#039;payment_method&#039;, &#039;order_currency&#039; );
		return $this-&gt;get_id() ? ( in_array( $key, $legacy_props ) || metadata_exists( &#039;post&#039;, $this-&gt;get_id(), &#039;_&#039; . $key ) ) : false;
	}

	/**
	 * Magic __get method for backwards compatibility.
	 *
	 * @param string $key
	 * @return mixed
	 */
	public function __get( $key ) {
		wc_doing_it_wrong( $key, &#039;Order properties should not be accessed directly.&#039;, &#039;3.0&#039; );

		if ( &#039;completed_date&#039; === $key ) {
			return $this-&gt;get_date_completed() ? gmdate( &#039;Y-m-d H:i:s&#039;, $this-&gt;get_date_completed()-&gt;getOffsetTimestamp() ) : &#039;&#039;;
		} elseif ( &#039;paid_date&#039; === $key ) {
			return $this-&gt;get_date_paid() ? gmdate( &#039;Y-m-d H:i:s&#039;, $this-&gt;get_date_paid()-&gt;getOffsetTimestamp() ) : &#039;&#039;;
		} elseif ( &#039;modified_date&#039; === $key ) {
			return $this-&gt;get_date_modified() ? gmdate( &#039;Y-m-d H:i:s&#039;, $this-&gt;get_date_modified()-&gt;getOffsetTimestamp() ) : &#039;&#039;;
		} elseif ( &#039;order_date&#039; === $key ) {
			return $this-&gt;get_date_created() ? gmdate( &#039;Y-m-d H:i:s&#039;, $this-&gt;get_date_created()-&gt;getOffsetTimestamp() ) : &#039;&#039;;
		} elseif ( &#039;id&#039; === $key ) {
			return $this-&gt;get_id();
		} elseif ( &#039;post&#039; === $key ) {
			return get_post( $this-&gt;get_id() );
		} elseif ( &#039;status&#039; === $key ) {
			return $this-&gt;get_status();
		} elseif ( &#039;post_status&#039; === $key ) {
			return get_post_status( $this-&gt;get_id() );
		} elseif ( &#039;customer_message&#039; === $key || &#039;customer_note&#039; === $key ) {
			return $this-&gt;get_customer_note();
		} elseif ( in_array( $key, array( &#039;user_id&#039;, &#039;customer_user&#039; ) ) ) {
			return $this-&gt;get_customer_id();
		} elseif ( &#039;tax_display_cart&#039; === $key ) {
			return get_option( &#039;woocommerce_tax_display_cart&#039; );
		} elseif ( &#039;display_totals_ex_tax&#039; === $key ) {
			return &#039;excl&#039; === get_option( &#039;woocommerce_tax_display_cart&#039; );
		} elseif ( &#039;display_cart_ex_tax&#039; === $key ) {
			return &#039;excl&#039; === get_option( &#039;woocommerce_tax_display_cart&#039; );
		} elseif ( &#039;cart_discount&#039; === $key ) {
			return $this-&gt;get_total_discount();
		} elseif ( &#039;cart_discount_tax&#039; === $key ) {
			return $this-&gt;get_discount_tax();
		} elseif ( &#039;order_tax&#039; === $key ) {
			return $this-&gt;get_cart_tax();
		} elseif ( &#039;order_shipping_tax&#039; === $key ) {
			return $this-&gt;get_shipping_tax();
		} elseif ( &#039;order_shipping&#039; === $key ) {
			return $this-&gt;get_shipping_total();
		} elseif ( &#039;order_total&#039; === $key ) {
			return $this-&gt;get_total();
		} elseif ( &#039;order_type&#039; === $key ) {
			return $this-&gt;get_type();
		} elseif ( &#039;order_currency&#039; === $key ) {
			return $this-&gt;get_currency();
		} elseif ( &#039;order_version&#039; === $key ) {
			return $this-&gt;get_version();
	 	} elseif ( is_callable( array( $this, &quot;get_{$key}&quot; ) ) ) {
			return $this-&gt;{&quot;get_{$key}&quot;}();
		} else {
			return get_post_meta( $this-&gt;get_id(), &#039;_&#039; . $key, true );
		}
	}

	/**
	 * has_meta function for order items. This is different to the WC_Data
	 * version and should be removed in future versions.
	 *
	 * @deprecated 3.0
	 *
	 * @param int $order_item_id
	 *
	 * @return array of meta data.
	 */
	public function has_meta( $order_item_id ) {
		global $wpdb;

		wc_deprecated_function( &#039;WC_Order::has_meta( $order_item_id )&#039;, &#039;3.0&#039;, &#039;WC_Order_item::get_meta_data&#039; );

		return $wpdb-&gt;get_results( $wpdb-&gt;prepare( &quot;SELECT meta_key, meta_value, meta_id, order_item_id
			FROM {$wpdb-&gt;prefix}woocommerce_order_itemmeta WHERE order_item_id = %d
			ORDER BY meta_id&quot;, absint( $order_item_id ) ), ARRAY_A );
	}

	/**
	 * Display meta data belonging to an item.
	 * @param  array $item
	 */
	public function display_item_meta( $item ) {
		wc_deprecated_function( &#039;WC_Order::display_item_meta&#039;, &#039;3.0&#039;, &#039;wc_display_item_meta&#039; );
		$product   = $item-&gt;get_product();
		$item_meta = new WC_Order_Item_Meta( $item, $product );
		$item_meta-&gt;display();
	}

	/**
	 * Display download links for an order item.
	 * @param  array $item
	 */
	public function display_item_downloads( $item ) {
		wc_deprecated_function( &#039;WC_Order::display_item_downloads&#039;, &#039;3.0&#039;, &#039;wc_display_item_downloads&#039; );
		$product   = $item-&gt;get_product();

		if ( $product &amp;&amp; $product-&gt;exists() &amp;&amp; $product-&gt;is_downloadable() &amp;&amp; $this-&gt;is_download_permitted() ) {
			$download_files = $this-&gt;get_item_downloads( $item );
			$i			  = 0;
			$links		  = array();

			foreach ( $download_files as $download_id =&gt; $file ) {
				$i++;
				/* translators: 1: current item count */
				$prefix  = count( $download_files ) &gt; 1 ? sprintf( __( &#039;Download %d&#039;, &#039;woocommerce&#039; ), $i ) : __( &#039;Download&#039;, &#039;woocommerce&#039; );
				$links[] = &#039;&lt;small class=&quot;download-url&quot;&gt;&#039; . esc_html( $prefix ) . &#039;: &lt;a href=&quot;&#039; . esc_url( $file[&#039;download_url&#039;] ) . &#039;&quot; target=&quot;_blank&quot;&gt;&#039; . esc_html( $file[&#039;name&#039;] ) . &#039;&lt;/a&gt;&lt;/small&gt;&#039; . &quot;\n&quot;;
			}

			echo &#039;&lt;br/&gt;&#039; . implode( &#039;&lt;br/&gt;&#039;, $links );
		}
	}

	/**
	 * Get the Download URL.
	 *
	 * @param  int $product_id
	 * @param  int $download_id
	 * @return string
	 */
	public function get_download_url( $product_id, $download_id ) {
		wc_deprecated_function( &#039;WC_Order::get_download_url&#039;, &#039;3.0&#039;, &#039;WC_Order_Item_Product::get_item_download_url&#039; );
		return add_query_arg( array(
			&#039;download_file&#039; =&gt; $product_id,
			&#039;order&#039;         =&gt; $this-&gt;get_order_key(),
			&#039;email&#039;         =&gt; urlencode( $this-&gt;get_billing_email() ),
			&#039;key&#039;           =&gt; $download_id,
		), trailingslashit( home_url() ) );
	}

	/**
	 * Get the downloadable files for an item in this order.
	 *
	 * @param  array $item
	 * @return array
	 */
	public function get_item_downloads( $item ) {
		wc_deprecated_function( &#039;WC_Order::get_item_downloads&#039;, &#039;3.0&#039;, &#039;WC_Order_Item_Product::get_item_downloads&#039; );

		if ( ! $item instanceof WC_Order_Item ) {
			if ( ! empty( $item[&#039;variation_id&#039;] ) ) {
				$product_id = $item[&#039;variation_id&#039;];
			} elseif ( ! empty( $item[&#039;product_id&#039;] ) ) {
				$product_id = $item[&#039;product_id&#039;];
			} else {
				return array();
			}

			// Create a &#039;virtual&#039; order item to allow retrieving item downloads when
			// an array of product_id is passed instead of actual order item.
			$item = new WC_Order_Item_Product();
			$item-&gt;set_product( wc_get_product( $product_id ) );
			$item-&gt;set_order_id( $this-&gt;get_id() );
		}

		return $item-&gt;get_item_downloads();
	}

	/**
	 * Gets shipping total. Alias of WC_Order::get_shipping_total().
	 * @deprecated 3.0.0 since this is an alias only.
	 * @return float
	 */
	public function get_total_shipping() {
		return $this-&gt;get_shipping_total();
	}

	/**
	 * Get order item meta.
	 * @deprecated 3.0.0
	 * @param mixed $order_item_id
	 * @param string $key (default: &#039;&#039;)
	 * @param bool $single (default: false)
	 * @return array|string
	 */
	public function get_item_meta( $order_item_id, $key = &#039;&#039;, $single = false ) {
		wc_deprecated_function( &#039;WC_Order::get_item_meta&#039;, &#039;3.0&#039;, &#039;wc_get_order_item_meta&#039; );
		return get_metadata( &#039;order_item&#039;, $order_item_id, $key, $single );
	}

	/**
	 * Get all item meta data in array format in the order it was saved. Does not group meta by key like get_item_meta().
	 *
	 * @param mixed $order_item_id
	 * @return array of objects
	 */
	public function get_item_meta_array( $order_item_id ) {
		wc_deprecated_function( &#039;WC_Order::get_item_meta_array&#039;, &#039;3.0&#039;, &#039;WC_Order_Item::get_meta_data() (note the format has changed)&#039; );
		$item            = $this-&gt;get_item( $order_item_id );
		$meta_data       = $item-&gt;get_meta_data();
		$item_meta_array = array();

		foreach ( $meta_data as $meta ) {
			$item_meta_array[ $meta-&gt;id ] = $meta;
		}

		return $item_meta_array;
	}

	/**
	 * Get coupon codes only.
	 *
	 * @deprecated 3.7.0 - Replaced with better named method to reflect the actual data being returned.
	 * @return array
	 */
	public function get_used_coupons() {
		wc_deprecated_function( &#039;get_used_coupons&#039;, &#039;3.7&#039;, &#039;WC_Abstract_Order::get_coupon_codes&#039; );
		return $this-&gt;get_coupon_codes();
	}

	/**
	 * Expand item meta into the $item array.
	 * @deprecated 3.0.0 Item meta no longer expanded due to new order item
	 *		classes. This function now does nothing to avoid data breakage.
	 * @param array $item before expansion.
	 * @return array
	 */
	public function expand_item_meta( $item ) {
		wc_deprecated_function( &#039;WC_Order::expand_item_meta&#039;, &#039;3.0&#039; );
		return $item;
	}

	/**
	 * Load the order object. Called from the constructor.
	 * @deprecated 3.0.0 Logic moved to constructor
	 * @param int|object|WC_Order $order Order to init.
	 */
	protected function init( $order ) {
		wc_deprecated_function( &#039;WC_Order::init&#039;, &#039;3.0&#039;, &#039;Logic moved to constructor&#039; );
		if ( is_numeric( $order ) ) {
			$this-&gt;set_id( $order );
		} elseif ( $order instanceof WC_Order ) {
			$this-&gt;set_id( absint( $order-&gt;get_id() ) );
		} elseif ( isset( $order-&gt;ID ) ) {
			$this-&gt;set_id( absint( $order-&gt;ID ) );
		}
		$this-&gt;set_object_read( false );
		$this-&gt;data_store-&gt;read( $this );
	}

	/**
	 * Gets an order from the database.
	 * @deprecated 3.0
	 * @param int $id (default: 0).
	 * @return bool
	 */
	public function get_order( $id = 0 ) {
		wc_deprecated_function( &#039;WC_Order::get_order&#039;, &#039;3.0&#039; );

		if ( ! $id ) {
			return false;
		}

		$result = get_post( $id );

		if ( $result ) {
			$this-&gt;populate( $result );
			return true;
		}

		return false;
	}

	/**
	 * Populates an order from the loaded post data.
	 * @deprecated 3.0
	 * @param mixed $result
	 */
	public function populate( $result ) {
		wc_deprecated_function( &#039;WC_Order::populate&#039;, &#039;3.0&#039; );
		$this-&gt;set_id( $result-&gt;ID );
		$this-&gt;set_object_read( false );
		$this-&gt;data_store-&gt;read( $this );
	}

	/**
	 * Cancel the order and restore the cart (before payment).
	 * @deprecated 3.0.0 Moved to event handler.
	 * @param string $note (default: &#039;&#039;) Optional note to add.
	 */
	public function cancel_order( $note = &#039;&#039; ) {
		wc_deprecated_function( &#039;WC_Order::cancel_order&#039;, &#039;3.0&#039;, &#039;WC_Order::update_status&#039; );
		WC()-&gt;session-&gt;set( &#039;order_awaiting_payment&#039;, false );
		$this-&gt;update_status( &#039;cancelled&#039;, $note );
	}

	/**
	 * Record sales.
	 * @deprecated 3.0.0
	 */
	public function record_product_sales() {
		wc_deprecated_function( &#039;WC_Order::record_product_sales&#039;, &#039;3.0&#039;, &#039;wc_update_total_sales_counts&#039; );
		wc_update_total_sales_counts( $this-&gt;get_id() );
	}

	/**
	 * Increase applied coupon counts.
	 * @deprecated 3.0.0
	 */
	public function increase_coupon_usage_counts() {
		wc_deprecated_function( &#039;WC_Order::increase_coupon_usage_counts&#039;, &#039;3.0&#039;, &#039;wc_update_coupon_usage_counts&#039; );
		wc_update_coupon_usage_counts( $this-&gt;get_id() );
	}

	/**
	 * Decrease applied coupon counts.
	 * @deprecated 3.0.0
	 */
	public function decrease_coupon_usage_counts() {
		wc_deprecated_function( &#039;WC_Order::decrease_coupon_usage_counts&#039;, &#039;3.0&#039;, &#039;wc_update_coupon_usage_counts&#039; );
		wc_update_coupon_usage_counts( $this-&gt;get_id() );
	}

	/**
	 * Reduce stock levels for all line items in the order.
	 * @deprecated 3.0.0
	 */
	public function reduce_order_stock() {
		wc_deprecated_function( &#039;WC_Order::reduce_order_stock&#039;, &#039;3.0&#039;, &#039;wc_reduce_stock_levels&#039; );
		wc_reduce_stock_levels( $this-&gt;get_id() );
	}

	/**
	 * Send the stock notifications.
	 * @deprecated 3.0.0 No longer needs to be called directly.
	 *
	 * @param $product
	 * @param $new_stock
	 * @param $qty_ordered
	 */
	public function send_stock_notifications( $product, $new_stock, $qty_ordered ) {
		wc_deprecated_function( &#039;WC_Order::send_stock_notifications&#039;, &#039;3.0&#039; );
	}

	/**
	 * Output items for display in html emails.
	 * @deprecated 3.0.0 Moved to template functions.
	 * @param array $args Items args.
	 * @return string
	 */
	public function email_order_items_table( $args = array() ) {
		wc_deprecated_function( &#039;WC_Order::email_order_items_table&#039;, &#039;3.0&#039;, &#039;wc_get_email_order_items&#039; );
		return wc_get_email_order_items( $this, $args );
	}

	/**
	 * Get currency.
	 * @deprecated 3.0.0
	 */
	public function get_order_currency() {
		wc_deprecated_function( &#039;WC_Order::get_order_currency&#039;, &#039;3.0&#039;, &#039;WC_Order::get_currency&#039; );
		return apply_filters( &#039;woocommerce_get_order_currency&#039;, $this-&gt;get_currency(), $this );
	}
}
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>WooCommerce Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on July 12th, 2021 at 10:33 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1626085995"></script>
    <script src="../js/search.js?updated=1626085995"></script>
</body>
</html>
