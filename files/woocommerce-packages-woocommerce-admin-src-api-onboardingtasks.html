<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>WooCommerce Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1626085998">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1626085998">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.svg" alt="WooCommerce" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">WooCommerce Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/automattic.html"><abbr title="\Automattic">Automattic</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/automattic-woocommerce.html"><abbr title="\Automattic\WooCommerce">WooCommerce</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WooCommerce.html"><abbr title="\WooCommerce">WooCommerce</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WooCommerce-Classes.html"><abbr title="\WooCommerce\Classes">Classes</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Abstracts.html"><abbr title="\WooCommerce\Abstracts">Abstracts</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Admin.html"><abbr title="\WooCommerce\Admin">Admin</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Views.html"><abbr title="\WooCommerce\Views">Views</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Helper.html"><abbr title="\WooCommerce\Helper">Helper</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Templates.html"><abbr title="\WooCommerce\Templates">Templates</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Reports.html"><abbr title="\WooCommerce\Reports">Reports</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Blocks.html"><abbr title="\WooCommerce\Blocks">Blocks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-RestApi.html"><abbr title="\WooCommerce\RestApi">RestApi</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-CLI.html"><abbr title="\WooCommerce\CLI">CLI</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-l10n.html"><abbr title="\WooCommerce\l10n">l10n</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Webhooks.html"><abbr title="\WooCommerce\Webhooks">Webhooks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-DataStores.html"><abbr title="\WooCommerce\DataStores">DataStores</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Emails.html"><abbr title="\WooCommerce\Emails">Emails</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Export.html"><abbr title="\WooCommerce\Export">Export</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Gateways.html"><abbr title="\WooCommerce\Gateways">Gateways</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-PayPal.html"><abbr title="\WooCommerce\PayPal">PayPal</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Import.html"><abbr title="\WooCommerce\Import">Import</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Integrations.html"><abbr title="\WooCommerce\Integrations">Integrations</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Interfaces.html"><abbr title="\WooCommerce\Interfaces">Interfaces</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Interface.html"><abbr title="\WooCommerce\Interface">Interface</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-LogHandlers.html"><abbr title="\WooCommerce\LogHandlers">LogHandlers</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-PaymentTokens.html"><abbr title="\WooCommerce\PaymentTokens">PaymentTokens</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Utilities.html"><abbr title="\WooCommerce\Utilities">Utilities</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Shipping.html"><abbr title="\WooCommerce\Shipping">Shipping</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Shortcodes.html"><abbr title="\WooCommerce\Shortcodes">Shortcodes</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Tracks.html"><abbr title="\WooCommerce\Tracks">Tracks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Traits.html"><abbr title="\WooCommerce\Traits">Traits</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Functions.html"><abbr title="\WooCommerce\Functions">Functions</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-WCCom.html"><abbr title="\WooCommerce\WCCom">WCCom</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Widgets.html"><abbr title="\WooCommerce\Widgets">Widgets</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Uninstaller.html"><abbr title="\WooCommerce\Uninstaller">Uninstaller</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WoocommerceAdmin.html"><abbr title="\WoocommerceAdmin">WoocommerceAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WoocommerceNavigation.html"><abbr title="\WoocommerceNavigation">WoocommerceNavigation</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Automattic.html"><abbr title="\Automattic">Automattic</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/Automattic-WooCommerce.html"><abbr title="\Automattic\WooCommerce">WooCommerce</abbr></a></li>
                            </ul>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">OnboardingTasks.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * REST API Onboarding Tasks Controller
 *
 * Handles requests to complete various onboarding tasks.
 */

namespace Automattic\WooCommerce\Admin\API;

use Automattic\WooCommerce\Admin\Features\Onboarding;
use Automattic\WooCommerce\Admin\Features\OnboardingTasks as OnboardingTasksFeature;

defined( &#039;ABSPATH&#039; ) || exit;

/**
 * Onboarding Tasks Controller.
 *
 * @extends WC_REST_Data_Controller
 */
class OnboardingTasks extends \WC_REST_Data_Controller {
	/**
	 * Endpoint namespace.
	 *
	 * @var string
	 */
	protected $namespace = &#039;wc-admin&#039;;

	/**
	 * Route base.
	 *
	 * @var string
	 */
	protected $rest_base = &#039;onboarding/tasks&#039;;

	/**
	 * Register routes.
	 */
	public function register_routes() {
		register_rest_route(
			$this-&gt;namespace,
			&#039;/&#039; . $this-&gt;rest_base . &#039;/import_sample_products&#039;,
			array(
				array(
					&#039;methods&#039;             =&gt; \WP_REST_Server::CREATABLE,
					&#039;callback&#039;            =&gt; array( $this, &#039;import_sample_products&#039; ),
					&#039;permission_callback&#039; =&gt; array( $this, &#039;create_products_permission_check&#039; ),
				),
				&#039;schema&#039; =&gt; array( $this, &#039;get_public_item_schema&#039; ),
			)
		);

		register_rest_route(
			$this-&gt;namespace,
			&#039;/&#039; . $this-&gt;rest_base . &#039;/create_homepage&#039;,
			array(
				array(
					&#039;methods&#039;             =&gt; \WP_REST_Server::CREATABLE,
					&#039;callback&#039;            =&gt; array( $this, &#039;create_homepage&#039; ),
					&#039;permission_callback&#039; =&gt; array( $this, &#039;create_pages_permission_check&#039; ),
				),
				&#039;schema&#039; =&gt; array( $this, &#039;get_public_item_schema&#039; ),
			)
		);

		register_rest_route(
			$this-&gt;namespace,
			&#039;/&#039; . $this-&gt;rest_base . &#039;/status&#039;,
			array(
				array(
					&#039;methods&#039;             =&gt; \WP_REST_Server::READABLE,
					&#039;callback&#039;            =&gt; array( $this, &#039;get_status&#039; ),
					&#039;permission_callback&#039; =&gt; array( $this, &#039;get_status_permission_check&#039; ),
				),
				&#039;schema&#039; =&gt; array( $this, &#039;get_status_item_schema&#039; ),
			)
		);

		register_rest_route(
			$this-&gt;namespace,
			&#039;/&#039; . $this-&gt;rest_base . &#039;/create_product_from_template&#039;,
			array(
				array(
					&#039;methods&#039;             =&gt; \WP_REST_Server::CREATABLE,
					&#039;callback&#039;            =&gt; array( $this, &#039;create_product_from_template&#039; ),
					&#039;permission_callback&#039; =&gt; array( $this, &#039;create_products_permission_check&#039; ),
					&#039;args&#039;                =&gt; array_merge(
						$this-&gt;get_endpoint_args_for_item_schema( \WP_REST_Server::CREATABLE ),
						array(
							&#039;template_name&#039; =&gt; array(
								&#039;required&#039;    =&gt; true,
								&#039;type&#039;        =&gt; &#039;string&#039;,
								&#039;description&#039; =&gt; __( &#039;Product template name.&#039;, &#039;woocommerce&#039; ),
							),
						)
					),
				),
				&#039;schema&#039; =&gt; array( $this, &#039;get_public_item_schema&#039; ),
			)
		);
	}

	/**
	 * Check if a given request has access to create a product.
	 *
	 * @param  WP_REST_Request $request Full details about the request.
	 * @return WP_Error|boolean
	 */
	public function create_products_permission_check( $request ) {
		if ( ! wc_rest_check_post_permissions( &#039;product&#039;, &#039;create&#039; ) ) {
			return new \WP_Error( &#039;woocommerce_rest_cannot_create&#039;, __( &#039;Sorry, you are not allowed to create resources.&#039;, &#039;woocommerce&#039; ), array( &#039;status&#039; =&gt; rest_authorization_required_code() ) );
		}

		return true;
	}

	/**
	 * Check if a given request has access to create a product.
	 *
	 * @param  WP_REST_Request $request Full details about the request.
	 * @return WP_Error|boolean
	 */
	public function create_pages_permission_check( $request ) {
		if ( ! wc_rest_check_post_permissions( &#039;page&#039;, &#039;create&#039; ) || ! current_user_can( &#039;manage_options&#039; ) ) {
			return new \WP_Error( &#039;woocommerce_rest_cannot_create&#039;, __( &#039;Sorry, you are not allowed to create new pages.&#039;, &#039;woocommerce&#039; ), array( &#039;status&#039; =&gt; rest_authorization_required_code() ) );
		}

		return true;
	}

	/**
	 * Check if a given request has access to get onboarding tasks status.
	 *
	 * @param  WP_REST_Request $request Full details about the request.
	 * @return WP_Error|boolean
	 */
	public function get_status_permission_check( $request ) {
		if ( ! current_user_can( &#039;manage_options&#039; ) ) {
			return new \WP_Error( &#039;woocommerce_rest_cannot_create&#039;, __( &#039;Sorry, you are not allowed to retrieve onboarding status.&#039;, &#039;woocommerce&#039; ), array( &#039;status&#039; =&gt; rest_authorization_required_code() ) );
		}

		return true;
	}

	/**
	 * Import sample products from given CSV path.
	 *
	 * @param  string $csv_file CSV file path.
	 * @return WP_Error|WP_REST_Response
	 */
	public static function import_sample_products_from_csv( $csv_file ) {
		include_once WC_ABSPATH . &#039;includes/import/class-wc-product-csv-importer.php&#039;;

		if ( file_exists( $csv_file ) &amp;&amp; class_exists( &#039;WC_Product_CSV_Importer&#039; ) ) {
			// Override locale so we can return mappings from WooCommerce in English language stores.
			add_filter( &#039;locale&#039;, &#039;__return_false&#039;, 9999 );
			$importer_class = apply_filters( &#039;woocommerce_product_csv_importer_class&#039;, &#039;WC_Product_CSV_Importer&#039; );
			$args           = array(
				&#039;parse&#039;   =&gt; true,
				&#039;mapping&#039; =&gt; self::get_header_mappings( $csv_file ),
			);
			$args           = apply_filters( &#039;woocommerce_product_csv_importer_args&#039;, $args, $importer_class );

			$importer = new $importer_class( $csv_file, $args );
			$import   = $importer-&gt;import();
			return $import;
		} else {
			return new \WP_Error( &#039;woocommerce_rest_import_error&#039;, __( &#039;Sorry, the sample products data file was not found.&#039;, &#039;woocommerce&#039; ) );
		}
	}

	/**
	 * Import sample products from WooCommerce sample CSV.
	 *
	 * @return WP_Error|WP_REST_Response
	 */
	public static function import_sample_products() {
		$sample_csv_file = WC_ABSPATH . &#039;sample-data/sample_products.csv&#039;;

		$import = self::import_sample_products_from_csv( $sample_csv_file );
		return rest_ensure_response( $import );
	}


	/**
	 * Creates a product from a template name passed in through the template_name param.
	 *
	 * @param WP_REST_Request $request Request data.
	 * @return WP_REST_Response|WP_Error
	 */
	public static function create_product_from_template( $request ) {
		$template_name = $request-&gt;get_param( &#039;template_name&#039; );
		$template_path = __DIR__ . &#039;/Templates/&#039; . $template_name . &#039;_product.csv&#039;;
		$template_path = apply_filters( &#039;woocommerce_product_template_csv_file_path&#039;, $template_path, $template_name );

		$import = self::import_sample_products_from_csv( $template_path );

		if ( is_wp_error( $import ) || 0 === count( $import[&#039;imported&#039;] ) ) {
			return new \WP_Error(
				&#039;woocommerce_rest_product_creation_error&#039;,
				/* translators: %s is template name */
				__( &#039;Sorry, creating the product with template failed.&#039;, &#039;woocommerce&#039; ),
				array( &#039;status&#039; =&gt; 500 )
			);
		}
		$product = wc_get_product( $import[&#039;imported&#039;][0] );
		$product-&gt;set_status( &#039;auto-draft&#039; );
		$product-&gt;save();

		return rest_ensure_response(
			array(
				&#039;id&#039; =&gt; $product-&gt;get_id(),
			)
		);
	}


	/**
	 * Get header mappings from CSV columns.
	 *
	 * @param string $file File path.
	 * @return array Mapped headers.
	 */
	public static function get_header_mappings( $file ) {
		include_once WC_ABSPATH . &#039;includes/admin/importers/mappings/mappings.php&#039;;

		$importer_class  = apply_filters( &#039;woocommerce_product_csv_importer_class&#039;, &#039;WC_Product_CSV_Importer&#039; );
		$importer        = new $importer_class( $file, array() );
		$raw_headers     = $importer-&gt;get_raw_keys();
		$default_columns = wc_importer_default_english_mappings( array() );
		$special_columns = wc_importer_default_special_english_mappings( array() );

		$headers = array();
		foreach ( $raw_headers as $key =&gt; $field ) {
			$index             = $field;
			$headers[ $index ] = $field;

			if ( isset( $default_columns[ $field ] ) ) {
				$headers[ $index ] = $default_columns[ $field ];
			} else {
				foreach ( $special_columns as $regex =&gt; $special_key ) {
					if ( preg_match( self::sanitize_special_column_name_regex( $regex ), $field, $matches ) ) {
						$headers[ $index ] = $special_key . $matches[1];
						break;
					}
				}
			}
		}

		return $headers;
	}

	/**
	 * Sanitize special column name regex.
	 *
	 * @param  string $value Raw special column name.
	 * @return string
	 */
	public static function sanitize_special_column_name_regex( $value ) {
		return &#039;/&#039; . str_replace( array( &#039;%d&#039;, &#039;%s&#039; ), &#039;(.*)&#039;, trim( quotemeta( $value ) ) ) . &#039;/&#039;;
	}

	/**
	 * Returns a valid cover block with an image, if one exists, or background as a fallback.
	 *
	 * @param  array $image Image to use for the cover block. Should contain a media ID and image URL.
	 * @return string Block content.
	 */
	private static function get_homepage_cover_block( $image ) {
		$shop_url = get_permalink( wc_get_page_id( &#039;shop&#039; ) );
		if ( ! empty( $image[&#039;url&#039;] ) &amp;&amp; ! empty( $image[&#039;id&#039;] ) ) {
			return &#039;&lt;!-- wp:cover {&quot;url&quot;:&quot;&#039; . esc_url( $image[&#039;url&#039;] ) . &#039;&quot;,&quot;id&quot;:&#039; . intval( $image[&#039;id&#039;] ) . &#039;,&quot;dimRatio&quot;:0} --&gt;
			&lt;div class=&quot;wp-block-cover&quot; style=&quot;background-image:url(&#039; . esc_url( $image[&#039;url&#039;] ) . &#039;)&quot;&gt;&lt;div class=&quot;wp-block-cover__inner-container&quot;&gt;&lt;!-- wp:paragraph {&quot;align&quot;:&quot;center&quot;,&quot;placeholder&quot;:&quot;&#039; . __( &#039;Write title…&#039;, &#039;woocommerce&#039; ) . &#039;&quot;,&quot;textColor&quot;:&quot;white&quot;,&quot;fontSize&quot;:&quot;large&quot;} --&gt;
			&lt;p class=&quot;has-text-align-center has-large-font-size&quot;&gt;&#039; . __( &#039;Welcome to the store&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/p&gt;
			&lt;!-- /wp:paragraph --&gt;

			&lt;!-- wp:paragraph {&quot;align&quot;:&quot;center&quot;,&quot;textColor&quot;:&quot;white&quot;} --&gt;
			&lt;p class=&quot;has-text-color has-text-align-center&quot;&gt;&#039; . __( &#039;Write a short welcome message here&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/p&gt;
			&lt;!-- /wp:paragraph --&gt;

			&lt;!-- wp:button {&quot;align&quot;:&quot;center&quot;} --&gt;
			&lt;div class=&quot;wp-block-button aligncenter&quot;&gt;&lt;a href=&quot;&#039; . esc_url( $shop_url ) . &#039;&quot; class=&quot;wp-block-button__link&quot;&gt;&#039; . __( &#039;Go shopping&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/a&gt;&lt;/div&gt;
			&lt;!-- /wp:button --&gt;&lt;/div&gt;&lt;/div&gt;
			&lt;!-- /wp:cover --&gt;&#039;;
		}

		return &#039;&lt;!-- wp:cover {&quot;dimRatio&quot;:0} --&gt;
		&lt;div class=&quot;wp-block-cover&quot;&gt;&lt;div class=&quot;wp-block-cover__inner-container&quot;&gt;&lt;!-- wp:paragraph {&quot;align&quot;:&quot;center&quot;,&quot;placeholder&quot;:&quot;&#039; . __( &#039;Write title…&#039;, &#039;woocommerce&#039; ) . &#039;&quot;,&quot;textColor&quot;:&quot;white&quot;,&quot;fontSize&quot;:&quot;large&quot;} --&gt;
		&lt;p class=&quot;has-text-color has-text-align-center has-large-font-size&quot;&gt;&#039; . __( &#039;Welcome to the store&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/p&gt;
		&lt;!-- /wp:paragraph --&gt;

		&lt;!-- wp:paragraph {&quot;align&quot;:&quot;center&quot;,&quot;textColor&quot;:&quot;white&quot;} --&gt;
		&lt;p class=&quot;has-text-color has-text-align-center&quot;&gt;&#039; . __( &#039;Write a short welcome message here&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/p&gt;
		&lt;!-- /wp:paragraph --&gt;

		&lt;!-- wp:button {&quot;align&quot;:&quot;center&quot;} --&gt;
		&lt;div class=&quot;wp-block-button aligncenter&quot;&gt;&lt;a href=&quot;&#039; . esc_url( $shop_url ) . &#039;&quot; class=&quot;wp-block-button__link&quot;&gt;&#039; . __( &#039;Go shopping&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/a&gt;&lt;/div&gt;
		&lt;!-- /wp:button --&gt;&lt;/div&gt;&lt;/div&gt;
		&lt;!-- /wp:cover --&gt;&#039;;
	}

	/**
	 * Returns a valid media block with an image, if one exists, or a uninitialized media block the user can set.
	 *
	 * @param  array  $image Image to use for the cover block. Should contain a media ID and image URL.
	 * @param  string $align If the image should be aligned to the left or right.
	 * @return string Block content.
	 */
	private static function get_homepage_media_block( $image, $align = &#039;left&#039; ) {
		$media_position = &#039;right&#039; === $align ? &#039;&quot;mediaPosition&quot;:&quot;right&quot;,&#039; : &#039;&#039;;
		$css_class      = &#039;right&#039; === $align ? &#039; has-media-on-the-right&#039; : &#039;&#039;;

		if ( ! empty( $image[&#039;url&#039;] ) &amp;&amp; ! empty( $image[&#039;id&#039;] ) ) {
			return &#039;&lt;!-- wp:media-text {&#039; . $media_position . &#039;&quot;mediaId&quot;:&#039; . intval( $image[&#039;id&#039;] ) . &#039;,&quot;mediaType&quot;:&quot;image&quot;} --&gt;
			&lt;div class=&quot;wp-block-media-text alignwide&#039; . $css_class . &#039;&quot;&quot;&gt;&lt;figure class=&quot;wp-block-media-text__media&quot;&gt;&lt;img src=&quot;&#039; . esc_url( $image[&#039;url&#039;] ) . &#039;&quot; alt=&quot;&quot; class=&quot;wp-image-&#039; . intval( $image[&#039;id&#039;] ) . &#039;&quot;/&gt;&lt;/figure&gt;&lt;div class=&quot;wp-block-media-text__content&quot;&gt;&lt;!-- wp:paragraph {&quot;placeholder&quot;:&quot;&#039; . __( &#039;Content…&#039;, &#039;woocommerce&#039; ) . &#039;&quot;,&quot;fontSize&quot;:&quot;large&quot;} --&gt;
			&lt;p class=&quot;has-large-font-size&quot;&gt;&lt;/p&gt;
			&lt;!-- /wp:paragraph --&gt;&lt;/div&gt;&lt;/div&gt;
			&lt;!-- /wp:media-text --&gt;&#039;;
		}

		return &#039;&lt;!-- wp:media-text {&#039; . $media_position . &#039;} --&gt;
		&lt;div class=&quot;wp-block-media-text alignwide&#039; . $css_class . &#039;&quot;&gt;&lt;figure class=&quot;wp-block-media-text__media&quot;&gt;&lt;/figure&gt;&lt;div class=&quot;wp-block-media-text__content&quot;&gt;&lt;!-- wp:paragraph {&quot;placeholder&quot;:&quot;&#039; . __( &#039;Content…&#039;, &#039;woocommerce&#039; ) . &#039;&quot;,&quot;fontSize&quot;:&quot;large&quot;} --&gt;
		&lt;p class=&quot;has-large-font-size&quot;&gt;&lt;/p&gt;
		&lt;!-- /wp:paragraph --&gt;&lt;/div&gt;&lt;/div&gt;
		&lt;!-- /wp:media-text --&gt;&#039;;
	}

	/**
	 * Returns a homepage template to be inserted into a post. A different template will be used depending on the number of products.
	 *
	 * @param int $post_id ID of the homepage template.
	 * @return string Template contents.
	 */
	private static function get_homepage_template( $post_id ) {
		$products = wp_count_posts( &#039;product&#039; );
		if ( $products-&gt;publish &gt;= 4 ) {
			$images   = self::sideload_homepage_images( $post_id, 1 );
			$image_1  = ! empty( $images[0] ) ? $images[0] : &#039;&#039;;
			$template = self::get_homepage_cover_block( $image_1 ) . &#039;
				&lt;!-- wp:heading {&quot;align&quot;:&quot;center&quot;} --&gt;
				&lt;h2 style=&quot;text-align:center&quot;&gt;&#039; . __( &#039;Shop by Category&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/h2&gt;
				&lt;!-- /wp:heading --&gt;
				&lt;!-- wp:shortcode --&gt;
				[product_categories number=&quot;0&quot; parent=&quot;0&quot;]
				&lt;!-- /wp:shortcode --&gt;
				&lt;!-- wp:heading {&quot;align&quot;:&quot;center&quot;} --&gt;
				&lt;h2 style=&quot;text-align:center&quot;&gt;&#039; . __( &#039;New In&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/h2&gt;
				&lt;!-- /wp:heading --&gt;
				&lt;!-- wp:woocommerce/product-new {&quot;columns&quot;:4} /--&gt;
				&lt;!-- wp:heading {&quot;align&quot;:&quot;center&quot;} --&gt;
				&lt;h2 style=&quot;text-align:center&quot;&gt;&#039; . __( &#039;Fan Favorites&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/h2&gt;
				&lt;!-- /wp:heading --&gt;
				&lt;!-- wp:woocommerce/product-top-rated {&quot;columns&quot;:4} /--&gt;
				&lt;!-- wp:heading {&quot;align&quot;:&quot;center&quot;} --&gt;
				&lt;h2 style=&quot;text-align:center&quot;&gt;&#039; . __( &#039;On Sale&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/h2&gt;
				&lt;!-- /wp:heading --&gt;
				&lt;!-- wp:woocommerce/product-on-sale {&quot;columns&quot;:4} /--&gt;
				&lt;!-- wp:heading {&quot;align&quot;:&quot;center&quot;} --&gt;
				&lt;h2 style=&quot;text-align:center&quot;&gt;&#039; . __( &#039;Best Sellers&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/h2&gt;
				&lt;!-- /wp:heading --&gt;
				&lt;!-- wp:woocommerce/product-best-sellers {&quot;columns&quot;:4} /--&gt;
			&#039;;

			/**
			 * Modify the template/content of the default homepage.
			 *
			 * @param string $template The default homepage template.
			 */
			return apply_filters( &#039;woocommerce_admin_onboarding_homepage_template&#039;, $template );
		}

		$images   = self::sideload_homepage_images( $post_id, 3 );
		$image_1  = ! empty( $images[0] ) ? $images[0] : &#039;&#039;;
		$image_2  = ! empty( $images[1] ) ? $images[1] : &#039;&#039;;
		$image_3  = ! empty( $images[2] ) ? $images[2] : &#039;&#039;;
		$template = self::get_homepage_cover_block( $image_1 ) . &#039;
		&lt;!-- wp:heading {&quot;align&quot;:&quot;center&quot;} --&gt;
		&lt;h2 style=&quot;text-align:center&quot;&gt;&#039; . __( &#039;New Products&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/h2&gt;
		&lt;!-- /wp:heading --&gt;

		&lt;!-- wp:woocommerce/product-new /--&gt; &#039; .

		self::get_homepage_media_block( $image_1, &#039;right&#039; ) .
		self::get_homepage_media_block( $image_2, &#039;left&#039; ) .
		self::get_homepage_media_block( $image_3, &#039;right&#039; ) . &#039;

		&lt;!-- wp:woocommerce/featured-product /--&gt;&#039;;

		/** This filter is documented in src/API/OnboardingTasks.php. */
		return apply_filters( &#039;woocommerce_admin_onboarding_homepage_template&#039;, $template );
	}

	/**
	 * Gets the possible industry images from the plugin folder for sideloading. If an image doesn&#039;t exist, other.jpg is used a fallback.
	 *
	 * @return array An array of images by industry.
	 */
	private static function get_available_homepage_images() {
		$industry_images = array();
		$industries      = Onboarding::get_allowed_industries();
		foreach ( $industries as $industry_slug =&gt; $label ) {
			$industry_images[ $industry_slug ] = apply_filters( &#039;woocommerce_admin_onboarding_industry_image&#039;, plugins_url( &#039;images/onboarding/other-small.jpg&#039;, WC_ADMIN_PLUGIN_FILE ), $industry_slug );
		}
		return $industry_images;
	}

	/**
	 * Uploads a number of images to a homepage template, depending on the selected industry from the profile wizard.
	 *
	 * @param  int $post_id ID of the homepage template.
	 * @param  int $number_of_images The number of images that should be sideloaded (depending on how many media slots are in the template).
	 * @return array An array of images that have been attached to the post.
	 */
	private static function sideload_homepage_images( $post_id, $number_of_images ) {
		$profile            = get_option( Onboarding::PROFILE_DATA_OPTION, array() );
		$images_to_sideload = array();
		$available_images   = self::get_available_homepage_images();

		require_once ABSPATH . &#039;wp-admin/includes/image.php&#039;;
		require_once ABSPATH . &#039;wp-admin/includes/file.php&#039;;
		require_once ABSPATH . &#039;wp-admin/includes/media.php&#039;;

		if ( ! empty( $profile[&#039;industry&#039;] ) ) {
			foreach ( $profile[&#039;industry&#039;] as $selected_industry ) {
				if ( is_string( $selected_industry ) ) {
					$industry_slug = $selected_industry;
				} elseif ( is_array( $selected_industry ) &amp;&amp; ! empty( $selected_industry[&#039;slug&#039;] ) ) {
					$industry_slug = $selected_industry[&#039;slug&#039;];
				} else {
					continue;
				}
				// Capture the first industry for use in our minimum images logic.
				$first_industry       = isset( $first_industry ) ? $first_industry : $industry_slug;
				$images_to_sideload[] = ! empty( $available_images[ $industry_slug ] ) ? $available_images[ $industry_slug ] : $available_images[&#039;other&#039;];
			}
		}

		// Make sure we have at least {$number_of_images} images.
		if ( count( $images_to_sideload ) &lt; $number_of_images ) {
			for ( $i = count( $images_to_sideload ); $i &lt; $number_of_images; $i++ ) {
				// Fill up missing image slots with the first selected industry, or other.
				$industry             = isset( $first_industry ) ? $first_industry : &#039;other&#039;;
				$images_to_sideload[] = empty( $available_images[ $industry ] ) ? $available_images[&#039;other&#039;] : $available_images[ $industry ];
			}
		}

		$already_sideloaded = array();
		$images_for_post    = array();
		foreach ( $images_to_sideload as $image ) {
			// Avoid uploading two of the same image, if an image is repeated.
			if ( ! empty( $already_sideloaded[ $image ] ) ) {
				$images_for_post[] = $already_sideloaded[ $image ];
				continue;
			}

			$sideload_id = \media_sideload_image( $image, $post_id, null, &#039;id&#039; );
			if ( ! is_wp_error( $sideload_id ) ) {
				$sideload_url                 = wp_get_attachment_url( $sideload_id );
				$already_sideloaded[ $image ] = array(
					&#039;id&#039;  =&gt; $sideload_id,
					&#039;url&#039; =&gt; $sideload_url,
				);
				$images_for_post[]            = $already_sideloaded[ $image ];
			}
		}

		return $images_for_post;
	}

	/**
	 * Create a homepage from a template.
	 *
	 * @return WP_Error|array
	 */
	public static function create_homepage() {
		$post_id = wp_insert_post(
			array(
				&#039;post_title&#039;   =&gt; __( &#039;Homepage&#039;, &#039;woocommerce&#039; ),
				&#039;post_type&#039;    =&gt; &#039;page&#039;,
				&#039;post_status&#039;  =&gt; &#039;publish&#039;,
				&#039;post_content&#039; =&gt; &#039;&#039;, // Template content is updated below, so images can be attached to the post.
			)
		);

		if ( ! is_wp_error( $post_id ) &amp;&amp; 0 &lt; $post_id ) {

			$template = self::get_homepage_template( $post_id );
			wp_update_post(
				array(
					&#039;ID&#039;           =&gt; $post_id,
					&#039;post_content&#039; =&gt; $template,
				)
			);

			update_option( &#039;show_on_front&#039;, &#039;page&#039; );
			update_option( &#039;page_on_front&#039;, $post_id );
			update_option( &#039;woocommerce_onboarding_homepage_post_id&#039;, $post_id );

			// Use the full width template on stores using Storefront.
			if ( &#039;storefront&#039; === get_stylesheet() ) {
				update_post_meta( $post_id, &#039;_wp_page_template&#039;, &#039;template-fullwidth.php&#039; );
			}

			return array(
				&#039;status&#039;         =&gt; &#039;success&#039;,
				&#039;message&#039;        =&gt; __( &#039;Homepage created&#039;, &#039;woocommerce&#039; ),
				&#039;post_id&#039;        =&gt; $post_id,
				&#039;edit_post_link&#039; =&gt; htmlspecialchars_decode( get_edit_post_link( $post_id ) ),
			);
		} else {
			return $post_id;
		}
	}

	/**
	 * Get the status endpoint schema, conforming to JSON Schema.
	 *
	 * @return array
	 */
	public function get_status_item_schema() {
		$schema = array(
			&#039;$schema&#039;    =&gt; &#039;http://json-schema.org/draft-04/schema#&#039;,
			&#039;title&#039;      =&gt; &#039;Onboarding Task Status&#039;,
			&#039;type&#039;       =&gt; &#039;object&#039;,
			&#039;properties&#039; =&gt; array(
				&#039;automatedTaxSupportedCountries&#039; =&gt; array(
					&#039;type&#039;        =&gt; &#039;array&#039;,
					&#039;description&#039; =&gt; __( &#039;Country codes that support Automated Taxes.&#039;, &#039;woocommerce&#039; ),
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
					&#039;readonly&#039;    =&gt; true,
					&#039;items&#039;       =&gt; array(
						&#039;type&#039; =&gt; &#039;string&#039;,
					),
				),
				&#039;hasHomepage&#039;                    =&gt; array(
					&#039;type&#039;        =&gt; &#039;boolean&#039;,
					&#039;description&#039; =&gt; __( &#039;If the store has a homepage created.&#039;, &#039;woocommerce&#039; ),
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
					&#039;readonly&#039;    =&gt; true,
				),
				&#039;hasPaymentGateway&#039;              =&gt; array(
					&#039;type&#039;        =&gt; &#039;boolean&#039;,
					&#039;description&#039; =&gt; __( &#039;If the store has an enabled payment gateway.&#039;, &#039;woocommerce&#039; ),
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
					&#039;readonly&#039;    =&gt; true,
				),
				&#039;hasPhysicalProducts&#039;            =&gt; array(
					&#039;type&#039;        =&gt; &#039;boolean&#039;,
					&#039;description&#039; =&gt; __( &#039;If the store has any physical (non-virtual) products.&#039;, &#039;woocommerce&#039; ),
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
					&#039;readonly&#039;    =&gt; true,
				),
				&#039;hasProducts&#039;                    =&gt; array(
					&#039;type&#039;        =&gt; &#039;boolean&#039;,
					&#039;description&#039; =&gt; __( &#039;If the store has any products.&#039;, &#039;woocommerce&#039; ),
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
					&#039;readonly&#039;    =&gt; true,
				),
				&#039;isTaxComplete&#039;                  =&gt; array(
					&#039;type&#039;        =&gt; &#039;boolean&#039;,
					&#039;description&#039; =&gt; __( &#039;If the tax step has been completed.&#039;, &#039;woocommerce&#039; ),
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
					&#039;readonly&#039;    =&gt; true,
				),
				&#039;shippingZonesCount&#039;             =&gt; array(
					&#039;type&#039;        =&gt; &#039;number&#039;,
					&#039;description&#039; =&gt; __( &#039;The number of shipping zones configured for the store.&#039;, &#039;woocommerce&#039; ),
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
					&#039;readonly&#039;    =&gt; true,
				),
				&#039;stripeSupportedCountries&#039;       =&gt; array(
					&#039;type&#039;        =&gt; &#039;array&#039;,
					&#039;description&#039; =&gt; __( &#039;Country codes that are supported by Stripe.&#039;, &#039;woocommerce&#039; ),
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
					&#039;readonly&#039;    =&gt; true,
					&#039;items&#039;       =&gt; array(
						&#039;type&#039; =&gt; &#039;string&#039;,
					),
				),
				&#039;taxJarActivated&#039;                =&gt; array(
					&#039;type&#039;        =&gt; &#039;boolean&#039;,
					&#039;description&#039; =&gt; __( &#039;If the store has the TaxJar extension active.&#039;, &#039;woocommerce&#039; ),
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
					&#039;readonly&#039;    =&gt; true,
				),
				&#039;themeMods&#039;                      =&gt; array(
					&#039;type&#039;        =&gt; &#039;object&#039;,
					&#039;description&#039; =&gt; __( &#039;Active theme modifications.&#039;, &#039;woocommerce&#039; ),
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
					&#039;readonly&#039;    =&gt; true,
				),
				&#039;wcPayIsConnected&#039;               =&gt; array(
					&#039;type&#039;        =&gt; &#039;boolean&#039;,
					&#039;description&#039; =&gt; __( &#039;If the store is using WooCommerce Payments.&#039;, &#039;woocommerce&#039; ),
					&#039;context&#039;     =&gt; array( &#039;view&#039; ),
					&#039;readonly&#039;    =&gt; true,
				),
			),
		);

		return $this-&gt;add_additional_fields_schema( $schema );
	}

	/**
	 * Get various onboarding task statuses.
	 *
	 * @return WP_Error|array
	 */
	public function get_status() {
		$status = OnboardingTasksFeature::get_settings();

		return rest_ensure_response( $status );
	}
}
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>WooCommerce Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on July 12th, 2021 at 10:33 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1626085998"></script>
    <script src="../js/search.js?updated=1626085998"></script>
</body>
</html>
