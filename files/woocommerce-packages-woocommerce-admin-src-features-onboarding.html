<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>WooCommerce Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1626085999">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1626085999">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.svg" alt="WooCommerce" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">WooCommerce Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/automattic.html"><abbr title="\Automattic">Automattic</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/automattic-woocommerce.html"><abbr title="\Automattic\WooCommerce">WooCommerce</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WooCommerce.html"><abbr title="\WooCommerce">WooCommerce</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WooCommerce-Classes.html"><abbr title="\WooCommerce\Classes">Classes</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Abstracts.html"><abbr title="\WooCommerce\Abstracts">Abstracts</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Admin.html"><abbr title="\WooCommerce\Admin">Admin</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Views.html"><abbr title="\WooCommerce\Views">Views</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Helper.html"><abbr title="\WooCommerce\Helper">Helper</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Templates.html"><abbr title="\WooCommerce\Templates">Templates</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Reports.html"><abbr title="\WooCommerce\Reports">Reports</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Blocks.html"><abbr title="\WooCommerce\Blocks">Blocks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-RestApi.html"><abbr title="\WooCommerce\RestApi">RestApi</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-CLI.html"><abbr title="\WooCommerce\CLI">CLI</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-l10n.html"><abbr title="\WooCommerce\l10n">l10n</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Webhooks.html"><abbr title="\WooCommerce\Webhooks">Webhooks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-DataStores.html"><abbr title="\WooCommerce\DataStores">DataStores</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Emails.html"><abbr title="\WooCommerce\Emails">Emails</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Export.html"><abbr title="\WooCommerce\Export">Export</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Gateways.html"><abbr title="\WooCommerce\Gateways">Gateways</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-PayPal.html"><abbr title="\WooCommerce\PayPal">PayPal</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Import.html"><abbr title="\WooCommerce\Import">Import</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Integrations.html"><abbr title="\WooCommerce\Integrations">Integrations</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Interfaces.html"><abbr title="\WooCommerce\Interfaces">Interfaces</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Interface.html"><abbr title="\WooCommerce\Interface">Interface</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-LogHandlers.html"><abbr title="\WooCommerce\LogHandlers">LogHandlers</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-PaymentTokens.html"><abbr title="\WooCommerce\PaymentTokens">PaymentTokens</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Utilities.html"><abbr title="\WooCommerce\Utilities">Utilities</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Shipping.html"><abbr title="\WooCommerce\Shipping">Shipping</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Shortcodes.html"><abbr title="\WooCommerce\Shortcodes">Shortcodes</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Tracks.html"><abbr title="\WooCommerce\Tracks">Tracks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Traits.html"><abbr title="\WooCommerce\Traits">Traits</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Functions.html"><abbr title="\WooCommerce\Functions">Functions</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-WCCom.html"><abbr title="\WooCommerce\WCCom">WCCom</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Widgets.html"><abbr title="\WooCommerce\Widgets">Widgets</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Uninstaller.html"><abbr title="\WooCommerce\Uninstaller">Uninstaller</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WoocommerceAdmin.html"><abbr title="\WoocommerceAdmin">WoocommerceAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WoocommerceNavigation.html"><abbr title="\WoocommerceNavigation">WoocommerceNavigation</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Automattic.html"><abbr title="\Automattic">Automattic</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/Automattic-WooCommerce.html"><abbr title="\Automattic\WooCommerce">WooCommerce</abbr></a></li>
                            </ul>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">Onboarding.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * WooCommerce Onboarding
 * NOTE: DO NOT edit this file in WooCommerce core, this is generated from woocommerce-admin.
 */

namespace Automattic\WooCommerce\Admin\Features;

use \Automattic\WooCommerce\Admin\Loader;
use Automattic\WooCommerce\Admin\PageController;
use Automattic\WooCommerce\Admin\WCAdminHelper;

/**
 * Contains backend logic for the onboarding profile and checklist feature.
 */
class Onboarding {
	/**
	 * Class instance.
	 *
	 * @var Onboarding instance
	 */
	protected static $instance = null;

	/**
	 * Name of themes transient.
	 *
	 * @var string
	 */
	const THEMES_TRANSIENT = &#039;wc_onboarding_themes&#039;;

	/**
	 * Name of product data transient.
	 *
	 * @var string
	 */
	const PRODUCT_DATA_TRANSIENT = &#039;wc_onboarding_product_data&#039;;

	/**
	 * Profile data option name.
	 */
	const PROFILE_DATA_OPTION = &#039;woocommerce_onboarding_profile&#039;;

	/**
	 * Get class instance.
	 */
	public static function get_instance() {
		if ( ! self::$instance ) {
			self::$instance = new self();
		}
		return self::$instance;
	}

	/**
	 * Hook into WooCommerce.
	 */
	public function __construct() {
		$this-&gt;add_toggle_actions();

		// Include WC Admin Onboarding classes.
		if ( self::should_show_tasks() ) {
			OnboardingTasks::get_instance();
		}

		// Add actions and filters.
		$this-&gt;add_actions();
		$this-&gt;add_filters();
	}

	/**
	 * Adds the ability to toggle the new onboarding experience on or off.
	 */
	private function add_toggle_actions() {
		add_action( &#039;woocommerce_updated&#039;, array( $this, &#039;maybe_mark_complete&#039; ) );
		add_action( &#039;update_option_&#039; . self::PROFILE_DATA_OPTION, array( $this, &#039;send_profile_data_on_update&#039; ), 10, 2 );
		add_action( &#039;woocommerce_helper_connected&#039;, array( $this, &#039;send_profile_data_on_connect&#039; ) );
	}

	/**
	 * Add onboarding actions.
	 */
	private function add_actions() {
		// Rest API hooks need to run before is_admin() checks.
		add_action( &#039;woocommerce_theme_installed&#039;, array( $this, &#039;delete_themes_transient&#039; ) );
		add_action( &#039;after_switch_theme&#039;, array( $this, &#039;delete_themes_transient&#039; ) );
		add_action(
			&#039;update_option_&#039; . self::PROFILE_DATA_OPTION,
			array(
				$this,
				&#039;trigger_profile_completed_action&#039;,
			),
			10,
			2
		);
		add_action( &#039;woocommerce_admin_plugins_pre_activate&#039;, array( $this, &#039;activate_and_install_jetpack_ahead_of_wcpay&#039; ) );
		add_action( &#039;woocommerce_admin_plugins_pre_install&#039;, array( $this, &#039;activate_and_install_jetpack_ahead_of_wcpay&#039; ) );

		// Always hook into Jetpack connection even if outside of admin.
		add_action( &#039;jetpack_site_registered&#039;, array( $this, &#039;set_woocommerce_setup_jetpack_opted_in&#039; ) );

		if ( ! is_admin() ) {
			return;
		}

		add_action( &#039;admin_init&#039;, array( $this, &#039;admin_redirects&#039; ) );
		add_action( &#039;current_screen&#039;, array( $this, &#039;finish_paypal_connect&#039; ) );
		add_action( &#039;current_screen&#039;, array( $this, &#039;finish_square_connect&#039; ) );
		add_action( &#039;current_screen&#039;, array( $this, &#039;add_help_tab&#039; ), 60 );
		add_action( &#039;current_screen&#039;, array( $this, &#039;reset_profiler&#039; ) );
		add_action( &#039;current_screen&#039;, array( $this, &#039;reset_task_list&#039; ) );
		add_action( &#039;current_screen&#039;, array( $this, &#039;reset_extended_task_list&#039; ) );
		add_action( &#039;current_screen&#039;, array( $this, &#039;redirect_wccom_install&#039; ) );
		add_action( &#039;current_screen&#039;, array( $this, &#039;redirect_old_onboarding&#039; ) );
	}

	/**
	 * Test whether the context of execution comes from async action scheduler.
	 * Note: this is a polyfill for wc_is_running_from_async_action_scheduler()
	 *       which was introduced in WC 4.0.
	 *
	 * @return bool
	 */
	public static function is_running_from_async_action_scheduler() {
		if ( function_exists( &#039;\wc_is_running_from_async_action_scheduler&#039; ) ) {
			return \wc_is_running_from_async_action_scheduler();
		}

		// phpcs:ignore WordPress.Security.NonceVerification.Recommended
		return isset( $_REQUEST[&#039;action&#039;] ) &amp;&amp; &#039;as_async_request_queue_runner&#039; === $_REQUEST[&#039;action&#039;];
	}

	/**
	 * Handle redirects to setup/welcome page after install and updates.
	 *
	 * For setup wizard, transient must be present, the user must have access rights, and we must ignore the network/bulk plugin updaters.
	 */
	public function admin_redirects() {
		// Don&#039;t run this fn from Action Scheduler requests, as it would clear _wc_activation_redirect transient.
		// That means OBW would never be shown.
		if ( self::is_running_from_async_action_scheduler() ) {
			return;
		}

		// Setup wizard redirect.
		if ( get_transient( &#039;_wc_activation_redirect&#039; ) &amp;&amp; apply_filters( &#039;woocommerce_enable_setup_wizard&#039;, true ) ) {
			$do_redirect        = true;
			$current_page       = isset( $_GET[&#039;page&#039;] ) ? wc_clean( wp_unslash( $_GET[&#039;page&#039;] ) ) : false; // phpcs:ignore WordPress.Security.NonceVerification
			$is_onboarding_path = ! isset( $_GET[&#039;path&#039;] ) || &#039;/setup-wizard&#039; === wc_clean( wp_unslash( $_GET[&#039;page&#039;] ) ); // phpcs:ignore WordPress.Security.NonceVerification

			// On these pages, or during these events, postpone the redirect.
			if ( wp_doing_ajax() || is_network_admin() || ! current_user_can( &#039;manage_woocommerce&#039; ) ) {
				$do_redirect = false;
			}

			// On these pages, or during these events, disable the redirect.
			if (
				( &#039;wc-admin&#039; === $current_page &amp;&amp; $is_onboarding_path ) ||
				apply_filters( &#039;woocommerce_prevent_automatic_wizard_redirect&#039;, false ) ||
				isset( $_GET[&#039;activate-multi&#039;] ) // phpcs:ignore WordPress.Security.NonceVerification
			) {
				delete_transient( &#039;_wc_activation_redirect&#039; );
				$do_redirect = false;
			}

			if ( $do_redirect ) {
				delete_transient( &#039;_wc_activation_redirect&#039; );
				wp_safe_redirect( wc_admin_url() );
				exit;
			}
		}
	}

	/**
	 * Sets the woocommerce_setup_jetpack_opted_in to true when Jetpack connects to WPCOM.
	 */
	public function set_woocommerce_setup_jetpack_opted_in() {
		update_option( &#039;woocommerce_setup_jetpack_opted_in&#039;, true );
	}

	/**
	 * Trigger the woocommerce_onboarding_profile_completed action
	 *
	 * @param array $old_value Previous value.
	 * @param array $value Current value.
	 */
	public function trigger_profile_completed_action( $old_value, $value ) {
		if ( isset( $old_value[&#039;completed&#039;] ) &amp;&amp; $old_value[&#039;completed&#039;] ) {
			return;
		}

		if ( ! isset( $value[&#039;completed&#039;] ) || ! $value[&#039;completed&#039;] ) {
			return;
		}

		/**
		 * Action hook fired when the onboarding profile (or onboarding wizard,
		 * or profiler) is completed.
		 *
		 * @since 1.5.0
		 */
		do_action( &#039;woocommerce_onboarding_profile_completed&#039; );
	}

	/**
	 * Add onboarding filters.
	 */
	private function add_filters() {
		// Rest API hooks need to run before is_admin() checks.
		add_filter( &#039;woocommerce_rest_prepare_themes&#039;, array( $this, &#039;add_uploaded_theme_data&#039; ) );

		if ( ! is_admin() ) {
			return;
		}

		// Old settings injection.
		// Run after Automattic\WooCommerce\Admin\Loader.
		add_filter( &#039;woocommerce_components_settings&#039;, array( $this, &#039;component_settings&#039; ), 20 );
		// New settings injection.
		add_filter( &#039;woocommerce_shared_settings&#039;, array( $this, &#039;component_settings&#039; ), 20 );
		add_filter( &#039;woocommerce_admin_preload_options&#039;, array( $this, &#039;preload_options&#039; ) );
		add_filter( &#039;woocommerce_admin_preload_settings&#039;, array( $this, &#039;preload_settings&#039; ) );
		add_filter( &#039;woocommerce_admin_is_loading&#039;, array( $this, &#039;is_loading&#039; ) );
		add_filter( &#039;woocommerce_show_admin_notice&#039;, array( $this, &#039;remove_install_notice&#039; ), 10, 2 );
	}

	/**
	 * Send profile data to WooCommerce.com.
	 */
	public static function send_profile_data() {
		if ( &#039;yes&#039; !== get_option( &#039;woocommerce_allow_tracking&#039;, &#039;no&#039; ) ) {
			return;
		}

		if ( ! class_exists( &#039;\WC_Helper_API&#039; ) || ! method_exists( &#039;\WC_Helper_API&#039;, &#039;put&#039; ) ) {
			return;
		}

		if ( ! class_exists( &#039;\WC_Helper_Options&#039; ) ) {
			return;
		}

		$auth = \WC_Helper_Options::get( &#039;auth&#039; );
		if ( empty( $auth[&#039;access_token&#039;] ) || empty( $auth[&#039;access_token_secret&#039;] ) ) {
			return false;
		}

		$profile       = get_option( self::PROFILE_DATA_OPTION, array() );
		$base_location = wc_get_base_location();
		$defaults      = array(
			&#039;plugins&#039;             =&gt; &#039;skipped&#039;,
			&#039;industry&#039;            =&gt; array(),
			&#039;product_types&#039;       =&gt; array(),
			&#039;product_count&#039;       =&gt; &#039;0&#039;,
			&#039;selling_venues&#039;      =&gt; &#039;no&#039;,
			&#039;revenue&#039;             =&gt; &#039;none&#039;,
			&#039;other_platform&#039;      =&gt; &#039;none&#039;,
			&#039;business_extensions&#039; =&gt; array(),
			&#039;theme&#039;               =&gt; get_stylesheet(),
			&#039;setup_client&#039;        =&gt; false,
			&#039;store_location&#039;      =&gt; $base_location[&#039;country&#039;],
			&#039;default_currency&#039;    =&gt; get_woocommerce_currency(),
		);

		// Prepare industries as an array of slugs if they are in array format.
		if ( isset( $profile[&#039;industry&#039;] ) &amp;&amp; is_array( $profile[&#039;industry&#039;] ) ) {
			$industry_slugs = array();
			foreach ( $profile[&#039;industry&#039;] as $industry ) {
				$industry_slugs[] = is_array( $industry ) ? $industry[&#039;slug&#039;] : $industry;
			}
			$profile[&#039;industry&#039;] = $industry_slugs;
		}
		$body = wp_parse_args( $profile, $defaults );

		\WC_Helper_API::put(
			&#039;profile&#039;,
			array(
				&#039;authenticated&#039; =&gt; true,
				&#039;body&#039;          =&gt; wp_json_encode( $body ),
				&#039;headers&#039;       =&gt; array(
					&#039;Content-Type&#039; =&gt; &#039;application/json&#039;,
				),
			)
		);
	}

	/**
	 * Send profiler data on profiler change to completion.
	 *
	 * @param array $old_value Previous value.
	 * @param array $value Current value.
	 */
	public static function send_profile_data_on_update( $old_value, $value ) {
		if ( ! isset( $value[&#039;completed&#039;] ) || ! $value[&#039;completed&#039;] ) {
			return;
		}

		self::send_profile_data();
	}

	/**
	 * Send profiler data after a site is connected.
	 */
	public static function send_profile_data_on_connect() {
		$profile = get_option( self::PROFILE_DATA_OPTION, array() );
		if ( ! isset( $profile[&#039;completed&#039;] ) || ! $profile[&#039;completed&#039;] ) {
			return;
		}

		self::send_profile_data();
	}

	/**
	 * Redirect the old onboarding wizard to the profiler.
	 */
	public static function redirect_old_onboarding() {
		$current_page = isset( $_GET[&#039;page&#039;] ) ? wc_clean( wp_unslash( $_GET[&#039;page&#039;] ) ) : false; // phpcs:ignore csrf okay.

		if ( &#039;wc-setup&#039; === $current_page ) {
			delete_transient( &#039;_wc_activation_redirect&#039; );
			wp_safe_redirect( wc_admin_url( &#039;&amp;reset_profiler=1&#039; ) );
		}
	}

	/**
	 * Returns true if the profiler should be displayed (not completed and not skipped).
	 *
	 * @return bool
	 */
	public static function should_show_profiler() {
		/* phpcs:disable WordPress.Security.NonceVerification */
		$is_current_page = isset( $_GET[&#039;page&#039;] ) &amp;&amp;
			&#039;wc-admin&#039; === $_GET[&#039;page&#039;] &amp;&amp;
			isset( $_GET[&#039;path&#039;] ) &amp;&amp;
			&#039;/setup-wizard&#039; === $_GET[&#039;path&#039;];
		/* phpcs: enable */

		if ( $is_current_page ) {
			return true;
		}

		$onboarding_data = get_option( self::PROFILE_DATA_OPTION, array() );

		$is_completed = isset( $onboarding_data[&#039;completed&#039;] ) &amp;&amp; true === $onboarding_data[&#039;completed&#039;];
		$is_skipped   = isset( $onboarding_data[&#039;skipped&#039;] ) &amp;&amp; true === $onboarding_data[&#039;skipped&#039;];

		// @todo When merging to WooCommerce Core, we should set the `completed` flag to true during the upgrade progress.
		// https://github.com/woocommerce/woocommerce-admin/pull/2300#discussion_r287237498.
		return ! $is_completed &amp;&amp; ! $is_skipped;
	}

	/**
	 * Returns true if the task list should be displayed (not completed or hidden off the dashboard).
	 *
	 * @return bool
	 */
	public static function should_show_tasks() {
		return &#039;no&#039; === get_option( &#039;woocommerce_task_list_hidden&#039;, &#039;no&#039; ) || &#039;no&#039; === get_option( &#039;woocommerce_extended_task_list_hidden&#039;, &#039;no&#039; );
	}

	/**
	 * Get a list of allowed industries for the onboarding wizard.
	 *
	 * @return array
	 */
	public static function get_allowed_industries() {
		/* With &quot;use_description&quot; we turn the description input on. With &quot;description_label&quot; we set the input label */
		return apply_filters(
			&#039;woocommerce_admin_onboarding_industries&#039;,
			array(
				&#039;fashion-apparel-accessories&#039;     =&gt; array(
					&#039;label&#039;             =&gt; __( &#039;Fashion, apparel, and accessories&#039;, &#039;woocommerce&#039; ),
					&#039;use_description&#039;   =&gt; false,
					&#039;description_label&#039; =&gt; &#039;&#039;,
				),
				&#039;health-beauty&#039;                   =&gt; array(
					&#039;label&#039;             =&gt; __( &#039;Health and beauty&#039;, &#039;woocommerce&#039; ),
					&#039;use_description&#039;   =&gt; false,
					&#039;description_label&#039; =&gt; &#039;&#039;,
				),
				&#039;electronics-computers&#039;           =&gt; array(
					&#039;label&#039;             =&gt; __( &#039;Electronics and computers&#039;, &#039;woocommerce&#039; ),
					&#039;use_description&#039;   =&gt; false,
					&#039;description_label&#039; =&gt; &#039;&#039;,
				),
				&#039;food-drink&#039;                      =&gt; array(
					&#039;label&#039;             =&gt; __( &#039;Food and drink&#039;, &#039;woocommerce&#039; ),
					&#039;use_description&#039;   =&gt; false,
					&#039;description_label&#039; =&gt; &#039;&#039;,
				),
				&#039;home-furniture-garden&#039;           =&gt; array(
					&#039;label&#039;             =&gt; __( &#039;Home, furniture, and garden&#039;, &#039;woocommerce&#039; ),
					&#039;use_description&#039;   =&gt; false,
					&#039;description_label&#039; =&gt; &#039;&#039;,
				),
				&#039;cbd-other-hemp-derived-products&#039; =&gt; array(
					&#039;label&#039;             =&gt; __( &#039;CBD and other hemp-derived products&#039;, &#039;woocommerce&#039; ),
					&#039;use_description&#039;   =&gt; false,
					&#039;description_label&#039; =&gt; &#039;&#039;,
				),
				&#039;education-and-learning&#039;          =&gt; array(
					&#039;label&#039;             =&gt; __( &#039;Education and learning&#039;, &#039;woocommerce&#039; ),
					&#039;use_description&#039;   =&gt; false,
					&#039;description_label&#039; =&gt; &#039;&#039;,
				),
				&#039;other&#039;                           =&gt; array(
					&#039;label&#039;             =&gt; __( &#039;Other&#039;, &#039;woocommerce&#039; ),
					&#039;use_description&#039;   =&gt; true,
					&#039;description_label&#039; =&gt; &#039;Description&#039;,
				),
			)
		);
	}

	/**
	 * Get a list of allowed product types for the onboarding wizard.
	 *
	 * @return array
	 */
	public static function get_allowed_product_types() {
		$product_types = self::append_product_data(
			array(
				&#039;physical&#039;        =&gt; array(
					&#039;label&#039;   =&gt; __( &#039;Physical products&#039;, &#039;woocommerce&#039; ),
					&#039;default&#039; =&gt; true,
				),
				&#039;downloads&#039;       =&gt; array(
					&#039;label&#039; =&gt; __( &#039;Downloads&#039;, &#039;woocommerce&#039; ),
				),
				&#039;subscriptions&#039;   =&gt; array(
					&#039;label&#039;   =&gt; __( &#039;Subscriptions&#039;, &#039;woocommerce&#039; ),
					&#039;product&#039; =&gt; 27147,
				),
				&#039;memberships&#039;     =&gt; array(
					&#039;label&#039;   =&gt; __( &#039;Memberships&#039;, &#039;woocommerce&#039; ),
					&#039;product&#039; =&gt; 958589,
				),
				&#039;bookings&#039;        =&gt; array(
					&#039;label&#039;   =&gt; __( &#039;Bookings&#039;, &#039;woocommerce&#039; ),
					&#039;product&#039; =&gt; 390890,
				),
				&#039;product-bundles&#039; =&gt; array(
					&#039;label&#039;   =&gt; __( &#039;Bundles&#039;, &#039;woocommerce&#039; ),
					&#039;product&#039; =&gt; 18716,
				),
				&#039;product-add-ons&#039; =&gt; array(
					&#039;label&#039;   =&gt; __( &#039;Customizable products&#039;, &#039;woocommerce&#039; ),
					&#039;product&#039; =&gt; 18618,
				),
			)
		);

		return apply_filters( &#039;woocommerce_admin_onboarding_product_types&#039;, $product_types );
	}

	/**
	 * Sort themes returned from WooCommerce.com
	 *
	 * @param  array $themes Array of themes from WooCommerce.com.
	 * @return array
	 */
	public static function sort_woocommerce_themes( $themes ) {
		usort(
			$themes,
			function ( $product_1, $product_2 ) {
				if ( ! property_exists( $product_1, &#039;id&#039; ) || ! property_exists( $product_1, &#039;slug&#039; ) ) {
					return 1;
				}
				if ( ! property_exists( $product_2, &#039;id&#039; ) || ! property_exists( $product_2, &#039;slug&#039; ) ) {
					return 1;
				}
				if ( in_array( &#039;Storefront&#039;, array( $product_1-&gt;slug, $product_2-&gt;slug ), true ) ) {
					return &#039;Storefront&#039; === $product_1-&gt;slug ? -1 : 1;
				}
				return $product_1-&gt;id &lt; $product_2-&gt;id ? 1 : -1;
			}
		);
		return $themes;
	}

	/**
	 * Get a list of themes for the onboarding wizard.
	 *
	 * @return array
	 */
	public static function get_themes() {
		$themes = get_transient( self::THEMES_TRANSIENT );
		if ( false === $themes ) {
			$theme_data = wp_remote_get( &#039;https://woocommerce.com/wp-json/wccom-extensions/1.0/search?category=themes&#039; );
			$themes     = array();

			if ( ! is_wp_error( $theme_data ) ) {
				$theme_data    = json_decode( $theme_data[&#039;body&#039;] );
				$woo_themes    = property_exists( $theme_data, &#039;products&#039; ) ? $theme_data-&gt;products : array();
				$sorted_themes = self::sort_woocommerce_themes( $woo_themes );

				foreach ( $sorted_themes as $theme ) {
					$slug                                       = sanitize_title_with_dashes( $theme-&gt;slug );
					$themes[ $slug ]                            = (array) $theme;
					$themes[ $slug ][&#039;is_installed&#039;]            = false;
					$themes[ $slug ][&#039;has_woocommerce_support&#039;] = true;
					$themes[ $slug ][&#039;slug&#039;]                    = $slug;
				}
			}

			$installed_themes = wp_get_themes();
			$active_theme     = get_option( &#039;stylesheet&#039; );

			foreach ( $installed_themes as $slug =&gt; $theme ) {
				$theme_data      = self::get_theme_data( $theme );
				$themes[ $slug ] = $theme_data;
			}

			// Add the WooCommerce support tag for default themes that don&#039;t explicitly declare support.
			if ( function_exists( &#039;wc_is_wp_default_theme_active&#039; ) &amp;&amp; wc_is_wp_default_theme_active() ) {
				$themes[ $active_theme ][&#039;has_woocommerce_support&#039;] = true;
			}

			$themes = array( $active_theme =&gt; $themes[ $active_theme ] ) + $themes;

			set_transient( self::THEMES_TRANSIENT, $themes, DAY_IN_SECONDS );
		}

		$themes = apply_filters( &#039;woocommerce_admin_onboarding_themes&#039;, $themes );
		return array_values( $themes );
	}

	/**
	 * Get theme data used in onboarding theme browser.
	 *
	 * @param WP_Theme $theme Theme to gather data from.
	 * @return array
	 */
	public static function get_theme_data( $theme ) {
		return array(
			&#039;slug&#039;                    =&gt; sanitize_text_field( $theme-&gt;stylesheet ),
			&#039;title&#039;                   =&gt; $theme-&gt;get( &#039;Name&#039; ),
			&#039;price&#039;                   =&gt; &#039;0.00&#039;,
			&#039;is_installed&#039;            =&gt; true,
			&#039;image&#039;                   =&gt; $theme-&gt;get_screenshot(),
			&#039;has_woocommerce_support&#039; =&gt; true,
		);
	}

	/**
	 * Add theme data to response from themes controller.
	 *
	 * @param WP_REST_Response $response Rest response.
	 * @return WP_REST_Response
	 */
	public static function add_uploaded_theme_data( $response ) {
		if ( ! isset( $response-&gt;data[&#039;theme&#039;] ) ) {
			return $response;
		}

		$theme                        = wp_get_theme( $response-&gt;data[&#039;theme&#039;] );
		$response-&gt;data[&#039;theme_data&#039;] = self::get_theme_data( $theme );

		return $response;
	}

	/**
	 * Check if theme has declared support for WooCommerce.
	 *
	 * @param WP_Theme $theme Theme to check.
	 * @link https://developer.woocommerce.com/2017/12/09/wc-3-3-will-look-great-on-all-the-themes/
	 * @deprecated 2.2.0
	 * @return bool
	 */
	public static function has_woocommerce_support( $theme ) {
		wc_deprecated_function( &#039;Onboarding::has_woocommerce_support&#039;, &#039;5.3&#039; ); // Deprecated since WooCommerce 5.3.
		return true; // All themes are supported since WooCommerce 3.3.
	}

	/**
	 * Append dynamic product data from API.
	 *
	 * @param array $product_types Array of product types.
	 * @return array
	 */
	public static function append_product_data( $product_types ) {
		$woocommerce_products = get_transient( self::PRODUCT_DATA_TRANSIENT );
		if ( false === $woocommerce_products ) {
			$woocommerce_products = wp_remote_get( &#039;https://woocommerce.com/wp-json/wccom-extensions/1.0/search&#039; );
			if ( is_wp_error( $woocommerce_products ) ) {
				return $product_types;
			}

			set_transient( self::PRODUCT_DATA_TRANSIENT, $woocommerce_products, DAY_IN_SECONDS );
		}

		$product_data = json_decode( $woocommerce_products[&#039;body&#039;] );
		$products     = array();

		// Map product data by ID.
		if ( isset( $product_data ) &amp;&amp; isset( $product_data-&gt;products ) ) {
			foreach ( $product_data-&gt;products as $product_datum ) {
				if ( isset( $product_datum-&gt;id ) ) {
					$products[ $product_datum-&gt;id ] = $product_datum;
				}
			}
		}

		// Loop over product types and append data.
		foreach ( $product_types as $key =&gt; $product_type ) {
			if ( isset( $product_type[&#039;product&#039;] ) &amp;&amp; isset( $products[ $product_type[&#039;product&#039;] ] ) ) {
				$price        = html_entity_decode( $products[ $product_type[&#039;product&#039;] ]-&gt;price );
				$yearly_price = (float) str_replace( &#039;$&#039;, &#039;&#039;, $price );

				$product_types[ $key ][&#039;yearly_price&#039;] = $yearly_price;
				$product_types[ $key ][&#039;description&#039;]  = $products[ $product_type[&#039;product&#039;] ]-&gt;excerpt;
				$product_types[ $key ][&#039;more_url&#039;]     = $products[ $product_type[&#039;product&#039;] ]-&gt;link;
				$product_types[ $key ][&#039;slug&#039;]         = strtolower( preg_replace( &#039;~[^\pL\d]+~u&#039;, &#039;-&#039;, $products[ $product_type[&#039;product&#039;] ]-&gt;slug ) );
			} elseif ( isset( $product_type[&#039;product&#039;] ) ) {
				/* translators: site currency symbol (used to show that the product costs money) */
				$product_types[ $key ][&#039;label&#039;] .= sprintf( __( &#039; â€” %s&#039;, &#039;woocommerce&#039; ), html_entity_decode( get_woocommerce_currency_symbol() ) );
			}
		}

		return $product_types;
	}

	/**
	 * Delete the stored themes transient.
	 */
	public static function delete_themes_transient() {
		delete_transient( self::THEMES_TRANSIENT );
	}

	/**
	 * Determine if the current page is one of the WC Admin pages.
	 *
	 * @return bool
	 */
	protected function is_wc_pages() {
		$current_page = PageController::get_instance()-&gt;get_current_page();
		if ( ! $current_page || ! isset( $current_page[&#039;path&#039;] ) ) {
			return false;
		}

		return 0 === strpos( $current_page[&#039;path&#039;], &#039;wc-admin&#039; );
	}

	/**
	 * Add profiler items to component settings.
	 *
	 * @param array $settings Component settings.
	 *
	 * @return array
	 */
	public function component_settings( $settings ) {
		$profile                = (array) get_option( self::PROFILE_DATA_OPTION, array() );
		$settings[&#039;onboarding&#039;] = array(
			&#039;profile&#039; =&gt; $profile,
		);

		// Only fetch if the onboarding wizard OR the task list is incomplete or currently shown
		// or the current page is one of the WooCommerce Admin pages.
		if (
			( ! self::should_show_profiler() &amp;&amp; ! self::should_show_tasks()
			||
			! $this-&gt;is_wc_pages()
		)
		) {
			return $settings;
		}

		include_once WC_ABSPATH . &#039;includes/admin/helper/class-wc-helper-options.php&#039;;
		$wccom_auth                 = \WC_Helper_Options::get( &#039;auth&#039; );
		$profile[&#039;wccom_connected&#039;] = empty( $wccom_auth[&#039;access_token&#039;] ) ? false : true;

		$settings[&#039;onboarding&#039;][&#039;activeTheme&#039;]     = get_option( &#039;stylesheet&#039; );
		$settings[&#039;onboarding&#039;][&#039;currencySymbols&#039;] = get_woocommerce_currency_symbols();
		$settings[&#039;onboarding&#039;][&#039;euCountries&#039;]     = WC()-&gt;countries-&gt;get_european_union_countries();
		$settings[&#039;onboarding&#039;][&#039;industries&#039;]      = self::get_allowed_industries();
		$settings[&#039;onboarding&#039;][&#039;localeInfo&#039;]      = include WC()-&gt;plugin_path() . &#039;/i18n/locale-info.php&#039;;
		$settings[&#039;onboarding&#039;][&#039;productTypes&#039;]    = self::get_allowed_product_types();
		$settings[&#039;onboarding&#039;][&#039;profile&#039;]         = $profile;
		$settings[&#039;onboarding&#039;][&#039;themes&#039;]          = self::get_themes();

		return $settings;
	}

	/**
	 * Preload options to prime state of the application.
	 *
	 * @param array $options Array of options to preload.
	 * @return array
	 */
	public function preload_options( $options ) {
		$options[] = &#039;woocommerce_task_list_complete&#039;;
		$options[] = &#039;woocommerce_task_list_do_this_later&#039;;
		$options[] = &#039;woocommerce_task_list_hidden&#039;;
		$options[] = &#039;woocommerce_extended_task_list_complete&#039;;
		$options[] = &#039;woocommerce_extended_task_list_hidden&#039;;
		$options[] = &#039;woocommerce_task_list_remind_me_later_tasks&#039;;

		if ( ! self::should_show_tasks() &amp;&amp; ! self::should_show_profiler() ) {
			return $options;
		}

		$options[] = &#039;wc_connect_options&#039;;
		$options[] = &#039;woocommerce_task_list_welcome_modal_dismissed&#039;;
		$options[] = &#039;woocommerce_welcome_from_calypso_modal_dismissed&#039;;
		$options[] = &#039;woocommerce_task_list_prompt_shown&#039;;
		$options[] = &#039;woocommerce_task_list_tracked_completed_tasks&#039;;
		$options[] = &#039;woocommerce_task_list_dismissed_tasks&#039;;
		$options[] = &#039;woocommerce_allow_tracking&#039;;
		$options[] = &#039;woocommerce_woo-mercado-pago-basic_settings&#039;;
		$options[] = &#039;woocommerce_stripe_settings&#039;;
		$options[] = &#039;woocommerce-ppcp-settings&#039;;
		$options[] = &#039;woocommerce_ppcp-gateway_settings&#039;;
		$options[] = &#039;wc_square_refresh_tokens&#039;;
		$options[] = &#039;woocommerce_square_credit_card_settings&#039;;
		$options[] = &#039;woocommerce_payfast_settings&#039;;
		$options[] = &#039;woocommerce_paystack_settings&#039;;
		$options[] = &#039;woocommerce_kco_settings&#039;;
		$options[] = &#039;woocommerce_klarna_payments_settings&#039;;
		$options[] = &#039;woocommerce_cod_settings&#039;;
		$options[] = &#039;woocommerce_bacs_settings&#039;;
		$options[] = &#039;woocommerce_bacs_accounts&#039;;
		$options[] = &#039;woocommerce_woocommerce_payments_settings&#039;;
		$options[] = &#039;woocommerce_eway_settings&#039;;
		$options[] = &#039;woocommerce_razorpay_settings&#039;;
		$options[] = &#039;woocommerce_payubiz_settings&#039;;
		$options[] = &#039;woocommerce_mollie_payments_settings&#039;;

		return $options;
	}

	/**
	 * Preload WC setting options to prime state of the application.
	 *
	 * @param array $options Array of options to preload.
	 * @return array
	 */
	public function preload_settings( $options ) {
		$options[] = &#039;general&#039;;

		return $options;
	}

	/**
	 * Gets an array of themes that can be installed &amp; activated via the onboarding wizard.
	 *
	 * @return array
	 */
	public static function get_allowed_themes() {
		$allowed_themes = array();
		$themes         = self::get_themes();

		foreach ( $themes as $theme ) {
			$price = preg_replace( &#039;/&amp;#?[a-z0-9]+;/i&#039;, &#039;&#039;, $theme[&#039;price&#039;] );

			if ( $theme[&#039;is_installed&#039;] || &#039;0.00&#039; === $price ) {
				$allowed_themes[] = $theme[&#039;slug&#039;];
			}
		}

		return apply_filters( &#039;woocommerce_admin_onboarding_themes_whitelist&#039;, $allowed_themes );
	}

	/**
	 * Let the app know that we will be showing the onboarding route, so wp-admin elements should be hidden while loading.
	 *
	 * @param bool $is_loading Indicates if the `woocommerce-admin-is-loading` should be appended or not.
	 * @return bool
	 */
	public function is_loading( $is_loading ) {
		$show_profiler = self::should_show_profiler();

		if ( $show_profiler ) {
			return true;
		}

		return $is_loading;
	}

	/**
	 * Instead of redirecting back to the payment settings page, we will redirect back to the payments task list with our status.
	 *
	 * @param string $location URL of redirect.
	 * @param int    $status HTTP response status code.
	 * @return string URL of redirect.
	 */
	public function overwrite_paypal_redirect( $location, $status ) {
		$settings_page = &#039;tab=checkout&amp;section=ppec_paypal&#039;;
		if ( substr( $location, -strlen( $settings_page ) ) === $settings_page ) {
			$settings_array = (array) get_option( &#039;woocommerce_ppec_paypal_settings&#039;, array() );
			$connected      = isset( $settings_array[&#039;api_username&#039;] ) &amp;&amp; isset( $settings_array[&#039;api_password&#039;] ) ? true : false;
			return wc_admin_url( &#039;&amp;task=payments&amp;method=paypal&amp;paypal-connect=&#039; . $connected );
		}
		return $location;
	}

	/**
	 * Finishes the PayPal connection process by saving the correct settings.
	 */
	public function finish_paypal_connect() {
		if (
			! Loader::is_admin_page() ||
			! isset( $_GET[&#039;paypal-connect-finish&#039;] ) // phpcs:ignore CSRF ok.
		) {
			return;
		}

		if ( ! function_exists( &#039;wc_gateway_ppec&#039; ) ) {
			return false;
		}

		// @todo This is a bit hacky but works. Ideally, woocommerce-gateway-paypal-express-checkout would contain a filter for us.
		add_filter( &#039;wp_redirect&#039;, array( $this, &#039;overwrite_paypal_redirect&#039; ), 10, 2 );
		wc_gateway_ppec()-&gt;ips-&gt;maybe_received_credentials();
		remove_filter( &#039;wp_redirect&#039;, array( $this, &#039;overwrite_paypal_redirect&#039; ) );
	}

	/**
	 * Instead of redirecting back to the payment settings page, we will redirect back to the payments task list with our status.
	 *
	 * @param string $location URL of redirect.
	 * @param int    $status HTTP response status code.
	 * @return string URL of redirect.
	 */
	public function overwrite_square_redirect( $location, $status ) {
		$settings_page = &#039;page=wc-settings&amp;tab=square&#039;;
		if ( substr( $location, -strlen( $settings_page ) ) === $settings_page ) {
			return wc_admin_url( &#039;&amp;task=payments&amp;method=square&amp;square-connect=1&#039; );
		}
		return $location;
	}

	/**
	 * Finishes the Square connection process by saving the correct settings.
	 */
	public function finish_square_connect() {
		if (
			! Loader::is_admin_page() ||
			! isset( $_GET[&#039;square-connect-finish&#039;] ) // phpcs:ignore CSRF ok.
		) {
			return;
		}

		if ( ! class_exists( &#039;\WooCommerce\Square\Plugin&#039; ) ) {
			return false;
		}

		$square = \WooCommerce\Square\Plugin::instance();

		// @todo This is a bit hacky but works. Ideally, woocommerce-square would contain a filter for us.
		add_filter( &#039;wp_redirect&#039;, array( $this, &#039;overwrite_square_redirect&#039; ), 10, 2 );
		$square-&gt;get_connection_handler()-&gt;handle_connected();
		remove_filter( &#039;wp_redirect&#039;, array( $this, &#039;overwrite_square_redirect&#039; ) );
	}

	/**
	 * Track changes to the onboarding option.
	 *
	 * @param mixed  $mixed Option name or previous value if option previously existed.
	 * @param string $value Value of the updated option.
	 */
	public static function track_onboarding_toggle( $mixed, $value ) {
		if ( defined( &#039;WC_ADMIN_MIGRATING_OPTIONS&#039; ) &amp;&amp; WC_ADMIN_MIGRATING_OPTIONS ) {
			return;
		};

		wc_admin_record_tracks_event(
			&#039;onboarding_toggled&#039;,
			array(
				&#039;previous_value&#039; =&gt; ! $value,
				&#039;new_value&#039;      =&gt; $value,
			)
		);
	}

	/**
	 * Update the help tab setup link to reset the onboarding profiler.
	 */
	public static function add_help_tab() {
		if ( ! function_exists( &#039;wc_get_screen_ids&#039; ) ) {
			return;
		}

		$screen = get_current_screen();

		if ( ! $screen || ! in_array( $screen-&gt;id, wc_get_screen_ids(), true ) ) {
			return;
		}

		// Remove the old help tab if it exists.
		$help_tabs = $screen-&gt;get_help_tabs();
		foreach ( $help_tabs as $help_tab ) {
			if ( &#039;woocommerce_onboard_tab&#039; !== $help_tab[&#039;id&#039;] ) {
				continue;
			}

			$screen-&gt;remove_help_tab( &#039;woocommerce_onboard_tab&#039; );
		}

		// Add the new help tab.
		$help_tab = array(
			&#039;title&#039; =&gt; __( &#039;Setup wizard&#039;, &#039;woocommerce&#039; ),
			&#039;id&#039;    =&gt; &#039;woocommerce_onboard_tab&#039;,
		);

		$task_list_hidden = ( &#039;yes&#039; === get_option( &#039;woocommerce_task_list_hidden&#039;, &#039;no&#039; ) );

		$extended_task_list_hidden = ( &#039;yes&#039; === get_option( &#039;woocommerce_extended_task_list_hidden&#039;, &#039;no&#039; ) );

		$help_tab[&#039;content&#039;] = &#039;&lt;h2&gt;&#039; . __( &#039;WooCommerce Onboarding&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/h2&gt;&#039;;

		$help_tab[&#039;content&#039;] .= &#039;&lt;h3&gt;&#039; . __( &#039;Profile Setup Wizard&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/h3&gt;&#039;;
		$help_tab[&#039;content&#039;] .= &#039;&lt;p&gt;&#039; . __( &#039;If you need to access the setup wizard again, please click on the button below.&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/p&gt;&#039; .
			&#039;&lt;p&gt;&lt;a href=&quot;&#039; . wc_admin_url( &#039;&amp;path=/setup-wizard&#039; ) . &#039;&quot; class=&quot;button button-primary&quot;&gt;&#039; . __( &#039;Setup wizard&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/a&gt;&lt;/p&gt;&#039;;

		$help_tab[&#039;content&#039;] .= &#039;&lt;h3&gt;&#039; . __( &#039;Task List&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/h3&gt;&#039;;
		$help_tab[&#039;content&#039;] .= &#039;&lt;p&gt;&#039; . __( &#039;If you need to enable or disable the task lists, please click on the button below.&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/p&gt;&#039; .
		( $task_list_hidden
			? &#039;&lt;p&gt;&lt;a href=&quot;&#039; . wc_admin_url( &#039;&amp;reset_task_list=1&#039; ) . &#039;&quot; class=&quot;button button-primary&quot;&gt;&#039; . __( &#039;Enable&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/a&gt;&lt;/p&gt;&#039;
			: &#039;&lt;p&gt;&lt;a href=&quot;&#039; . wc_admin_url( &#039;&amp;reset_task_list=0&#039; ) . &#039;&quot; class=&quot;button button-primary&quot;&gt;&#039; . __( &#039;Disable&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/a&gt;&lt;/p&gt;&#039;
		);

		$help_tab[&#039;content&#039;] .= &#039;&lt;h3&gt;&#039; . __( &#039;Extended task List&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/h3&gt;&#039;;
		$help_tab[&#039;content&#039;] .= &#039;&lt;p&gt;&#039; . __( &#039;If you need to enable or disable the extended task lists, please click on the button below.&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/p&gt;&#039; .
		( $extended_task_list_hidden
			? &#039;&lt;p&gt;&lt;a href=&quot;&#039; . wc_admin_url( &#039;&amp;reset_extended_task_list=1&#039; ) . &#039;&quot; class=&quot;button button-primary&quot;&gt;&#039; . __( &#039;Enable&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/a&gt;&lt;/p&gt;&#039;
			: &#039;&lt;p&gt;&lt;a href=&quot;&#039; . wc_admin_url( &#039;&amp;reset_extended_task_list=0&#039; ) . &#039;&quot; class=&quot;button button-primary&quot;&gt;&#039; . __( &#039;Disable&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/a&gt;&lt;/p&gt;&#039;
		);

		$screen-&gt;add_help_tab( $help_tab );
	}

	/**
	 * Reset the onboarding profiler and redirect to the profiler.
	 */
	public static function reset_profiler() {
		if (
			! Loader::is_admin_page() ||
			! isset( $_GET[&#039;reset_profiler&#039;] ) // phpcs:ignore CSRF ok.
		) {
			return;
		}

		$previous  = 1 === absint( $_GET[&#039;reset_profiler&#039;] ); // phpcs:ignore CSRF ok.
		$new_value = ! $previous;

		wc_admin_record_tracks_event(
			&#039;storeprofiler_toggled&#039;,
			array(
				&#039;previous&#039;  =&gt; $previous,
				&#039;new_value&#039; =&gt; $new_value,
			)
		);

		$request = new \WP_REST_Request( &#039;POST&#039;, &#039;/wc-admin/onboarding/profile&#039; );
		$request-&gt;set_headers( array( &#039;content-type&#039; =&gt; &#039;application/json&#039; ) );
		$request-&gt;set_body(
			wp_json_encode(
				array(
					&#039;completed&#039; =&gt; $new_value,
					&#039;skipped&#039;   =&gt; $new_value,
				)
			)
		);
		$response = rest_do_request( $request );
		wp_safe_redirect( wc_admin_url() );
		exit;
	}

	/**
	 * Reset the onboarding task list and redirect to the dashboard.
	 */
	public static function reset_task_list() {
		if (
			! Loader::is_admin_page() ||
			! isset( $_GET[&#039;reset_task_list&#039;] ) // phpcs:ignore CSRF ok.
		) {
			return;
		}

		$task_list_hidden = 1 === absint( $_GET[&#039;reset_task_list&#039;] ) ? &#039;no&#039; : &#039;yes&#039;; // phpcs:ignore CSRF ok.
		update_option( &#039;woocommerce_task_list_hidden&#039;, $task_list_hidden );

		wc_admin_record_tracks_event(
			&#039;tasklist_toggled&#039;,
			array(
				&#039;status&#039; =&gt; &#039;yes&#039; === $task_list_hidden ? &#039;disabled&#039; : &#039;enabled&#039;,
			)
		);
		wp_safe_redirect( wc_admin_url() );
		exit;
	}

	/**
	 * Reset the extended task list and redirect to the dashboard.
	 */
	public static function reset_extended_task_list() {
		if (
			! Loader::is_admin_page() ||
			! isset( $_GET[&#039;reset_extended_task_list&#039;] ) // phpcs:ignore CSRF ok.
		) {
			return;
		}

		$extended_task_list_hidden = 1 === absint( $_GET[&#039;reset_extended_task_list&#039;] ) ? &#039;no&#039; : &#039;yes&#039;; // phpcs:ignore CSRF ok.
		update_option( &#039;woocommerce_extended_task_list_hidden&#039;, $extended_task_list_hidden );

		wc_admin_record_tracks_event(
			&#039;extended_tasklist_toggled&#039;,
			array(
				&#039;status&#039; =&gt; &#039;yes&#039; === $extended_task_list_hidden ? &#039;disabled&#039; : &#039;enabled&#039;,
			)
		);
		wp_safe_redirect( wc_admin_url() );
		exit;
	}

	/**
	 * Remove the install notice that prompts the user to visit the old onboarding setup wizard.
	 *
	 * @param bool   $show Show or hide the notice.
	 * @param string $notice The slug of the notice.
	 * @return bool
	 */
	public static function remove_install_notice( $show, $notice ) {
		if ( &#039;install&#039; === $notice ) {
			return false;
		}

		return $show;
	}

	/**
	 * Redirects the user to the task list if the task list is enabled and finishing a wccom checkout.
	 *
	 * @todo Once URL params are added to the redirect, we can check those instead of the referer.
	 */
	public static function redirect_wccom_install() {
		if (
			! self::should_show_tasks() ||
			! isset( $_SERVER[&#039;HTTP_REFERER&#039;] ) ||
			0 !== strpos( $_SERVER[&#039;HTTP_REFERER&#039;], &#039;https://woocommerce.com/checkout&#039; ) // phpcs:ignore sanitization ok.
		) {
			return;
		}

		wp_safe_redirect( wc_admin_url() );
	}

	/**
	 * When updating WooCommerce, mark the profiler and task list complete.
	 *
	 * @todo The `maybe_enable_setup_wizard()` method should be revamped on onboarding enable in core.
	 * See https://github.com/woocommerce/woocommerce/blob/1ca791f8f2325fe2ee0947b9c47e6a4627366374/includes/class-wc-install.php#L341
	 */
	public static function maybe_mark_complete() {
		// The install notice still exists so don&#039;t complete the profiler.
		if ( ! class_exists( &#039;WC_Admin_Notices&#039; ) || \WC_Admin_Notices::has_notice( &#039;install&#039; ) ) {
			return;
		}

		$onboarding_data = get_option( self::PROFILE_DATA_OPTION, array() );
		// Don&#039;t make updates if the profiler is completed or skipped, but task list is potentially incomplete.
		if (
			( isset( $onboarding_data[&#039;completed&#039;] ) &amp;&amp; $onboarding_data[&#039;completed&#039;] ) ||
			( isset( $onboarding_data[&#039;skipped&#039;] ) &amp;&amp; $onboarding_data[&#039;skipped&#039;] )
		) {
			return;
		}

		$onboarding_data[&#039;completed&#039;] = true;
		update_option( self::PROFILE_DATA_OPTION, $onboarding_data );

		if ( ! WCAdminHelper::is_wc_admin_active_for( DAY_IN_SECONDS ) ) {
			update_option( &#039;woocommerce_task_list_hidden&#039;, &#039;yes&#039; );
		}
	}

	/**
	 * Ensure that Jetpack gets installed and activated ahead of WooCommerce Payments
	 * if both are being installed/activated at the same time.
	 *
	 * See: https://github.com/Automattic/woocommerce-payments/issues/1663
	 * See: https://github.com/Automattic/jetpack/issues/19624
	 *
	 * @param array $plugins A list of plugins to install or activate.
	 *
	 * @return array
	 */
	public static function activate_and_install_jetpack_ahead_of_wcpay( $plugins ) {
		if ( in_array( &#039;jetpack&#039;, $plugins, true ) &amp;&amp; in_array( &#039;woocommerce-payments&#039;, $plugins, true ) ) {
			array_unshift( $plugins, &#039;jetpack&#039; );
			$plugins = array_unique( $plugins );
		}
		return $plugins;
	}
}
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>WooCommerce Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on July 12th, 2021 at 10:33 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1626085999"></script>
    <script src="../js/search.js?updated=1626085999"></script>
</body>
</html>
