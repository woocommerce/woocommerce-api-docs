<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>WooCommerce Code Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/favicon.png" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"/>
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1626085993">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/template.css?updated=1626085993">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8KCYZ2CYMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'WooCommerce Core Code Reference',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img width="180" src="../images/logo.svg" alt="WooCommerce" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.woocommerce.com/">Documentation</a></li>
                <li><a href="https://woocommerce.github.io/woocommerce-rest-api-docs/">REST API Docs</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title">WooCommerce Code Reference</h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/automattic.html"><abbr title="\Automattic">Automattic</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/automattic-woocommerce.html"><abbr title="\Automattic\WooCommerce">WooCommerce</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WooCommerce.html"><abbr title="\WooCommerce">WooCommerce</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WooCommerce-Classes.html"><abbr title="\WooCommerce\Classes">Classes</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Abstracts.html"><abbr title="\WooCommerce\Abstracts">Abstracts</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Admin.html"><abbr title="\WooCommerce\Admin">Admin</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Views.html"><abbr title="\WooCommerce\Views">Views</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Helper.html"><abbr title="\WooCommerce\Helper">Helper</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Templates.html"><abbr title="\WooCommerce\Templates">Templates</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Reports.html"><abbr title="\WooCommerce\Reports">Reports</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Blocks.html"><abbr title="\WooCommerce\Blocks">Blocks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-RestApi.html"><abbr title="\WooCommerce\RestApi">RestApi</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-CLI.html"><abbr title="\WooCommerce\CLI">CLI</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-l10n.html"><abbr title="\WooCommerce\l10n">l10n</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Webhooks.html"><abbr title="\WooCommerce\Webhooks">Webhooks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-DataStores.html"><abbr title="\WooCommerce\DataStores">DataStores</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Emails.html"><abbr title="\WooCommerce\Emails">Emails</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Export.html"><abbr title="\WooCommerce\Export">Export</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Gateways.html"><abbr title="\WooCommerce\Gateways">Gateways</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-PayPal.html"><abbr title="\WooCommerce\PayPal">PayPal</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Import.html"><abbr title="\WooCommerce\Import">Import</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Integrations.html"><abbr title="\WooCommerce\Integrations">Integrations</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Interfaces.html"><abbr title="\WooCommerce\Interfaces">Interfaces</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Interface.html"><abbr title="\WooCommerce\Interface">Interface</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-LogHandlers.html"><abbr title="\WooCommerce\LogHandlers">LogHandlers</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-PaymentTokens.html"><abbr title="\WooCommerce\PaymentTokens">PaymentTokens</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Utilities.html"><abbr title="\WooCommerce\Utilities">Utilities</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Shipping.html"><abbr title="\WooCommerce\Shipping">Shipping</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Shortcodes.html"><abbr title="\WooCommerce\Shortcodes">Shortcodes</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Tracks.html"><abbr title="\WooCommerce\Tracks">Tracks</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Traits.html"><abbr title="\WooCommerce\Traits">Traits</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Functions.html"><abbr title="\WooCommerce\Functions">Functions</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-WCCom.html"><abbr title="\WooCommerce\WCCom">WCCom</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Widgets.html"><abbr title="\WooCommerce\Widgets">Widgets</abbr></a></li>
                                    <li><a href="../packages/WooCommerce-Uninstaller.html"><abbr title="\WooCommerce\Uninstaller">Uninstaller</abbr></a></li>
                            </ul>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WoocommerceAdmin.html"><abbr title="\WoocommerceAdmin">WoocommerceAdmin</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WoocommerceNavigation.html"><abbr title="\WoocommerceNavigation">WoocommerceNavigation</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/Automattic.html"><abbr title="\Automattic">Automattic</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/Automattic-WooCommerce.html"><abbr title="\Automattic\WooCommerce">WooCommerce</abbr></a></li>
                            </ul>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">class-wc-admin-dashboard.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * Admin Dashboard
 *
 * @package     WooCommerce\Admin
 * @version     2.1.0
 */

use Automattic\Jetpack\Constants;

if ( ! defined( &#039;ABSPATH&#039; ) ) {
	exit; // Exit if accessed directly.
}

if ( ! class_exists( &#039;WC_Admin_Dashboard&#039;, false ) ) :

	/**
	 * WC_Admin_Dashboard Class.
	 */
	class WC_Admin_Dashboard {

		/**
		 * Hook in tabs.
		 */
		public function __construct() {
			// Only hook in admin parts if the user has admin access.
			if ( $this-&gt;should_display_widget() ) {
				// If on network admin, only load the widget that works in that context and skip the rest.
				if ( is_multisite() &amp;&amp; is_network_admin() ) {
					add_action( &#039;wp_network_dashboard_setup&#039;, array( $this, &#039;register_network_order_widget&#039; ) );
				} else {
					add_action( &#039;wp_dashboard_setup&#039;, array( $this, &#039;init&#039; ) );
				}
			}
		}

		/**
		 * Init dashboard widgets.
		 */
		public function init() {
			// Reviews Widget.
			if ( current_user_can( &#039;publish_shop_orders&#039; ) &amp;&amp; post_type_supports( &#039;product&#039;, &#039;comments&#039; ) ) {
				wp_add_dashboard_widget( &#039;woocommerce_dashboard_recent_reviews&#039;, __( &#039;WooCommerce Recent Reviews&#039;, &#039;woocommerce&#039; ), array( $this, &#039;recent_reviews&#039; ) );
			}
			wp_add_dashboard_widget( &#039;woocommerce_dashboard_status&#039;, __( &#039;WooCommerce Status&#039;, &#039;woocommerce&#039; ), array( $this, &#039;status_widget&#039; ) );

			// Network Order Widget.
			if ( is_multisite() &amp;&amp; is_main_site() ) {
				$this-&gt;register_network_order_widget();
			}
		}

		/**
		 * Register the network order dashboard widget.
		 */
		public function register_network_order_widget() {
			wp_add_dashboard_widget( &#039;woocommerce_network_orders&#039;, __( &#039;WooCommerce Network Orders&#039;, &#039;woocommerce&#039; ), array( $this, &#039;network_orders&#039; ) );
		}

		/**
		 * Check to see if we should display the widget.
		 *
		 * @return bool
		 */
		private function should_display_widget() {
			if ( ! WC()-&gt;is_wc_admin_active() ) {
				return false;
			}

			$has_permission           = current_user_can( &#039;view_woocommerce_reports&#039; ) || current_user_can( &#039;manage_woocommerce&#039; ) || current_user_can( &#039;publish_shop_orders&#039; );
			$task_completed_or_hidden = &#039;yes&#039; === get_option( &#039;woocommerce_task_list_complete&#039; ) || &#039;yes&#039; === get_option( &#039;woocommerce_task_list_hidden&#039; );
			return $task_completed_or_hidden &amp;&amp; $has_permission;
		}

		/**
		 * Get top seller from DB.
		 *
		 * @return object
		 */
		private function get_top_seller() {
			global $wpdb;

			$query            = array();
			$query[&#039;fields&#039;]  = &quot;SELECT SUM( order_item_meta.meta_value ) as qty, order_item_meta_2.meta_value as product_id
			FROM {$wpdb-&gt;posts} as posts&quot;;
			$query[&#039;join&#039;]    = &quot;INNER JOIN {$wpdb-&gt;prefix}woocommerce_order_items AS order_items ON posts.ID = order_id &quot;;
			$query[&#039;join&#039;]   .= &quot;INNER JOIN {$wpdb-&gt;prefix}woocommerce_order_itemmeta AS order_item_meta ON order_items.order_item_id = order_item_meta.order_item_id &quot;;
			$query[&#039;join&#039;]   .= &quot;INNER JOIN {$wpdb-&gt;prefix}woocommerce_order_itemmeta AS order_item_meta_2 ON order_items.order_item_id = order_item_meta_2.order_item_id &quot;;
			$query[&#039;where&#039;]   = &quot;WHERE posts.post_type IN ( &#039;&quot; . implode( &quot;&#039;,&#039;&quot;, wc_get_order_types( &#039;order-count&#039; ) ) . &quot;&#039; ) &quot;;
			$query[&#039;where&#039;]  .= &quot;AND posts.post_status IN ( &#039;wc-&quot; . implode( &quot;&#039;,&#039;wc-&quot;, apply_filters( &#039;woocommerce_reports_order_statuses&#039;, array( &#039;completed&#039;, &#039;processing&#039;, &#039;on-hold&#039; ) ) ) . &quot;&#039; ) &quot;;
			$query[&#039;where&#039;]  .= &quot;AND order_item_meta.meta_key = &#039;_qty&#039; &quot;;
			$query[&#039;where&#039;]  .= &quot;AND order_item_meta_2.meta_key = &#039;_product_id&#039; &quot;;
			$query[&#039;where&#039;]  .= &quot;AND posts.post_date &gt;= &#039;&quot; . gmdate( &#039;Y-m-01&#039;, current_time( &#039;timestamp&#039; ) ) . &quot;&#039; &quot;;
			$query[&#039;where&#039;]  .= &quot;AND posts.post_date &lt;= &#039;&quot; . gmdate( &#039;Y-m-d H:i:s&#039;, current_time( &#039;timestamp&#039; ) ) . &quot;&#039; &quot;;
			$query[&#039;groupby&#039;] = &#039;GROUP BY product_id&#039;;
			$query[&#039;orderby&#039;] = &#039;ORDER BY qty DESC&#039;;
			$query[&#039;limits&#039;]  = &#039;LIMIT 1&#039;;

			return $wpdb-&gt;get_row( implode( &#039; &#039;, apply_filters( &#039;woocommerce_dashboard_status_widget_top_seller_query&#039;, $query ) ) ); //phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared
		}

		/**
		 * Get sales report data.
		 *
		 * @return object
		 */
		private function get_sales_report_data() {
			include_once dirname( __FILE__ ) . &#039;/reports/class-wc-report-sales-by-date.php&#039;;

			$sales_by_date                 = new WC_Report_Sales_By_Date();
			$sales_by_date-&gt;start_date     = strtotime( gmdate( &#039;Y-m-01&#039;, current_time( &#039;timestamp&#039; ) ) );
			$sales_by_date-&gt;end_date       = strtotime( gmdate( &#039;Y-m-d&#039;, current_time( &#039;timestamp&#039; ) ) );
			$sales_by_date-&gt;chart_groupby  = &#039;day&#039;;
			$sales_by_date-&gt;group_by_query = &#039;YEAR(posts.post_date), MONTH(posts.post_date), DAY(posts.post_date)&#039;;

			return $sales_by_date-&gt;get_report_data();
		}

		/**
		 * Show status widget.
		 */
		public function status_widget() {
			$suffix  = Constants::is_true( &#039;SCRIPT_DEBUG&#039; ) ? &#039;&#039; : &#039;.min&#039;;
			$version = Constants::get_constant( &#039;WC_VERSION&#039; );

			wp_enqueue_script( &#039;wc-status-widget&#039;, WC()-&gt;plugin_url() . &#039;/assets/js/admin/wc-status-widget&#039; . $suffix . &#039;.js&#039;, array( &#039;jquery&#039; ), $version, true );

			include_once dirname( __FILE__ ) . &#039;/reports/class-wc-admin-report.php&#039;;

			$is_wc_admin_disabled = apply_filters( &#039;woocommerce_admin_disabled&#039;, false );

			$reports = new WC_Admin_Report();

			$net_sales_link  = &#039;admin.php?page=wc-reports&amp;tab=orders&amp;range=month&#039;;
			$top_seller_link = &#039;admin.php?page=wc-reports&amp;tab=orders&amp;report=sales_by_product&amp;range=month&amp;product_ids=&#039;;
			$report_data     = $is_wc_admin_disabled ? $this-&gt;get_sales_report_data() : $this-&gt;get_wc_admin_performance_data();
			if ( ! $is_wc_admin_disabled ) {
				$net_sales_link  = &#039;admin.php?page=wc-admin&amp;path=%2Fanalytics%2Frevenue&amp;chart=net_revenue&amp;orderby=net_revenue&amp;period=month&amp;compare=previous_period&#039;;
				$top_seller_link = &#039;admin.php?page=wc-admin&amp;filter=single_product&amp;path=%2Fanalytics%2Fproducts&amp;products=&#039;;
			}

			echo &#039;&lt;ul class=&quot;wc_status_list&quot;&gt;&#039;;

			if ( current_user_can( &#039;view_woocommerce_reports&#039; ) ) {

				if ( $report_data ) {
					?&gt;
				&lt;li class=&quot;sales-this-month&quot;&gt;
				&lt;a href=&quot;&lt;?php echo esc_url( admin_url( $net_sales_link ) ); ?&gt;&quot;&gt;
					&lt;?php echo $this-&gt;sales_sparkline( $reports, $is_wc_admin_disabled, &#039;&#039; ); // phpcs:ignore WordPress.XSS.EscapeOutput.OutputNotEscaped ?&gt;
					&lt;?php
						printf(
							/* translators: %s: net sales */
							esc_html__( &#039;%s net sales this month&#039;, &#039;woocommerce&#039; ),
							&#039;&lt;strong&gt;&#039; . wc_price( $report_data-&gt;net_sales ) . &#039;&lt;/strong&gt;&#039;
						); // phpcs:ignore WordPress.XSS.EscapeOutput.OutputNotEscaped
					?&gt;
					&lt;/a&gt;
				&lt;/li&gt;
					&lt;?php
				}

				$top_seller = $this-&gt;get_top_seller();
				if ( $top_seller &amp;&amp; $top_seller-&gt;qty ) {
					?&gt;
				&lt;li class=&quot;best-seller-this-month&quot;&gt;
				&lt;a href=&quot;&lt;?php echo esc_url( admin_url( $top_seller_link . $top_seller-&gt;product_id ) ); ?&gt;&quot;&gt;
					&lt;?php echo $this-&gt;sales_sparkline( $reports, $is_wc_admin_disabled, $top_seller-&gt;product_id, &#039;count&#039; ); // phpcs:ignore WordPress.XSS.EscapeOutput.OutputNotEscaped ?&gt;
					&lt;?php
						printf(
							/* translators: 1: top seller product title 2: top seller quantity */
							esc_html__( &#039;%1$s top seller this month (sold %2$d)&#039;, &#039;woocommerce&#039; ),
							&#039;&lt;strong&gt;&#039; . get_the_title( $top_seller-&gt;product_id ) . &#039;&lt;/strong&gt;&#039;,
							$top_seller-&gt;qty
						); // phpcs:ignore WordPress.XSS.EscapeOutput.OutputNotEscaped
					?&gt;
					&lt;/a&gt;
				&lt;/li&gt;
					&lt;?php
				}
			}

			$this-&gt;status_widget_order_rows();
			$this-&gt;status_widget_stock_rows( $is_wc_admin_disabled );

			do_action( &#039;woocommerce_after_dashboard_status_widget&#039;, $reports );
			echo &#039;&lt;/ul&gt;&#039;;
		}

		/**
		 * Show order data is status widget.
		 */
		private function status_widget_order_rows() {
			if ( ! current_user_can( &#039;edit_shop_orders&#039; ) ) {
				return;
			}
			$on_hold_count    = 0;
			$processing_count = 0;

			foreach ( wc_get_order_types( &#039;order-count&#039; ) as $type ) {
				$counts            = (array) wp_count_posts( $type );
				$on_hold_count    += isset( $counts[&#039;wc-on-hold&#039;] ) ? $counts[&#039;wc-on-hold&#039;] : 0;
				$processing_count += isset( $counts[&#039;wc-processing&#039;] ) ? $counts[&#039;wc-processing&#039;] : 0;
			}
			?&gt;
			&lt;li class=&quot;processing-orders&quot;&gt;
			&lt;a href=&quot;&lt;?php echo esc_url( admin_url( &#039;edit.php?post_status=wc-processing&amp;post_type=shop_order&#039; ) ); ?&gt;&quot;&gt;
				&lt;?php
					printf(
						/* translators: %s: order count */
						_n( &#039;&lt;strong&gt;%s order&lt;/strong&gt; awaiting processing&#039;, &#039;&lt;strong&gt;%s orders&lt;/strong&gt; awaiting processing&#039;, $processing_count, &#039;woocommerce&#039; ),
						$processing_count
					); // phpcs:ignore WordPress.XSS.EscapeOutput.OutputNotEscaped
				?&gt;
				&lt;/a&gt;
			&lt;/li&gt;
			&lt;li class=&quot;on-hold-orders&quot;&gt;
				&lt;a href=&quot;&lt;?php echo esc_url( admin_url( &#039;edit.php?post_status=wc-on-hold&amp;post_type=shop_order&#039; ) ); ?&gt;&quot;&gt;
				&lt;?php
					printf(
						/* translators: %s: order count */
						_n( &#039;&lt;strong&gt;%s order&lt;/strong&gt; on-hold&#039;, &#039;&lt;strong&gt;%s orders&lt;/strong&gt; on-hold&#039;, $on_hold_count, &#039;woocommerce&#039; ),
						$on_hold_count
					); // phpcs:ignore WordPress.XSS.EscapeOutput.OutputNotEscaped
				?&gt;
				&lt;/a&gt;
			&lt;/li&gt;
			&lt;?php
		}

		/**
		 * Show stock data is status widget.
		 *
		 * @param bool $is_wc_admin_disabled if woocommerce admin is disabled.
		 */
		private function status_widget_stock_rows( $is_wc_admin_disabled ) {
			global $wpdb;

			// Requires lookup table added in 3.6.
			if ( version_compare( get_option( &#039;woocommerce_db_version&#039;, null ), &#039;3.6&#039;, &#039;&lt;&#039; ) ) {
				return;
			}

			$stock   = absint( max( get_option( &#039;woocommerce_notify_low_stock_amount&#039; ), 1 ) );
			$nostock = absint( max( get_option( &#039;woocommerce_notify_no_stock_amount&#039; ), 0 ) );

			$transient_name   = &#039;wc_low_stock_count&#039;;
			$lowinstock_count = get_transient( $transient_name );

			if ( false === $lowinstock_count ) {
				/**
				 * Status widget low in stock count pre query.
				 *
				 * @since 4.3.0
				 * @param null|string $low_in_stock_count Low in stock count, by default null.
				 * @param int         $stock              Low stock amount.
				 * @param int         $nostock            No stock amount
				 */
				$lowinstock_count = apply_filters( &#039;woocommerce_status_widget_low_in_stock_count_pre_query&#039;, null, $stock, $nostock );

				if ( is_null( $lowinstock_count ) ) {
					$lowinstock_count = $wpdb-&gt;get_var(
						$wpdb-&gt;prepare(
							&quot;SELECT COUNT( product_id )
							FROM {$wpdb-&gt;wc_product_meta_lookup} AS lookup
							INNER JOIN {$wpdb-&gt;posts} as posts ON lookup.product_id = posts.ID
							WHERE stock_quantity &lt;= %d
							AND stock_quantity &gt; %d
							AND posts.post_status = &#039;publish&#039;&quot;,
							$stock,
							$nostock
						)
					);
				}

				set_transient( $transient_name, (int) $lowinstock_count, DAY_IN_SECONDS * 30 );
			}

			$transient_name   = &#039;wc_outofstock_count&#039;;
			$outofstock_count = get_transient( $transient_name );
			$lowstock_link    = &#039;admin.php?page=wc-reports&amp;tab=stock&amp;report=low_in_stock&#039;;
			$outofstock_link  = &#039;admin.php?page=wc-reports&amp;tab=stock&amp;report=out_of_stock&#039;;

			if ( false === $is_wc_admin_disabled ) {
				$lowstock_link   = &#039;admin.php?page=wc-admin&amp;type=lowstock&amp;path=%2Fanalytics%2Fstock&#039;;
				$outofstock_link = &#039;admin.php?page=wc-admin&amp;type=outofstock&amp;path=%2Fanalytics%2Fstock&#039;;
			}

			if ( false === $outofstock_count ) {
				/**
				 * Status widget out of stock count pre query.
				 *
				 * @since 4.3.0
				 * @param null|string $outofstock_count Out of stock count, by default null.
				 * @param int         $nostock          No stock amount
				 */
				$outofstock_count = apply_filters( &#039;woocommerce_status_widget_out_of_stock_count_pre_query&#039;, null, $nostock );

				if ( is_null( $outofstock_count ) ) {
					$outofstock_count = (int) $wpdb-&gt;get_var(
						$wpdb-&gt;prepare(
							&quot;SELECT COUNT( product_id )
							FROM {$wpdb-&gt;wc_product_meta_lookup} AS lookup
							INNER JOIN {$wpdb-&gt;posts} as posts ON lookup.product_id = posts.ID
							WHERE stock_quantity &lt;= %d
							AND posts.post_status = &#039;publish&#039;&quot;,
							$nostock
						)
					);
				}

				set_transient( $transient_name, (int) $outofstock_count, DAY_IN_SECONDS * 30 );
			}
			?&gt;
			&lt;li class=&quot;low-in-stock&quot;&gt;
			&lt;a href=&quot;&lt;?php echo esc_url( admin_url( $lowstock_link ) ); ?&gt;&quot;&gt;
				&lt;?php
					printf(
						/* translators: %s: order count */
						_n( &#039;&lt;strong&gt;%s product&lt;/strong&gt; low in stock&#039;, &#039;&lt;strong&gt;%s products&lt;/strong&gt; low in stock&#039;, $lowinstock_count, &#039;woocommerce&#039; ),
						$lowinstock_count
					); // phpcs:ignore WordPress.XSS.EscapeOutput.OutputNotEscaped
				?&gt;
				&lt;/a&gt;
			&lt;/li&gt;
			&lt;li class=&quot;out-of-stock&quot;&gt;
				&lt;a href=&quot;&lt;?php echo esc_url( admin_url( $outofstock_link ) ); ?&gt;&quot;&gt;
				&lt;?php
					printf(
						/* translators: %s: order count */
						_n( &#039;&lt;strong&gt;%s product&lt;/strong&gt; out of stock&#039;, &#039;&lt;strong&gt;%s products&lt;/strong&gt; out of stock&#039;, $outofstock_count, &#039;woocommerce&#039; ),
						$outofstock_count
					); // phpcs:ignore WordPress.XSS.EscapeOutput.OutputNotEscaped
				?&gt;
				&lt;/a&gt;
			&lt;/li&gt;
			&lt;?php
		}

		/**
		 * Recent reviews widget.
		 */
		public function recent_reviews() {
			global $wpdb;

			$query_from = apply_filters(
				&#039;woocommerce_report_recent_reviews_query_from&#039;,
				&quot;FROM {$wpdb-&gt;comments} comments
				LEFT JOIN {$wpdb-&gt;posts} posts ON (comments.comment_post_ID = posts.ID)
				WHERE comments.comment_approved = &#039;1&#039;
				AND comments.comment_type = &#039;review&#039;
				AND posts.post_password = &#039;&#039;
				AND posts.post_type = &#039;product&#039;
				AND comments.comment_parent = 0
				ORDER BY comments.comment_date_gmt DESC
				LIMIT 5&quot;
			);

			$comments = $wpdb-&gt;get_results(
				&quot;SELECT posts.ID, posts.post_title, comments.comment_author, comments.comment_author_email, comments.comment_ID, comments.comment_content {$query_from};&quot; // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared
			);

			if ( $comments ) {
				echo &#039;&lt;ul&gt;&#039;;
				foreach ( $comments as $comment ) {

					echo &#039;&lt;li&gt;&#039;;

					echo get_avatar( $comment-&gt;comment_author_email, &#039;32&#039; );

					$rating = intval( get_comment_meta( $comment-&gt;comment_ID, &#039;rating&#039;, true ) );

					/* translators: %s: rating */
					echo &#039;&lt;div class=&quot;star-rating&quot;&gt;&lt;span style=&quot;width:&#039; . esc_attr( $rating * 20 ) . &#039;%&quot;&gt;&#039; . sprintf( esc_html__( &#039;%s out of 5&#039;, &#039;woocommerce&#039; ), esc_html( $rating ) ) . &#039;&lt;/span&gt;&lt;/div&gt;&#039;;

					/* translators: %s: review author */
					echo &#039;&lt;h4 class=&quot;meta&quot;&gt;&lt;a href=&quot;&#039; . esc_url( get_permalink( $comment-&gt;ID ) ) . &#039;#comment-&#039; . esc_attr( absint( $comment-&gt;comment_ID ) ) . &#039;&quot;&gt;&#039; . esc_html( apply_filters( &#039;woocommerce_admin_dashboard_recent_reviews&#039;, $comment-&gt;post_title, $comment ) ) . &#039;&lt;/a&gt; &#039; . sprintf( esc_html__( &#039;reviewed by %s&#039;, &#039;woocommerce&#039; ), esc_html( $comment-&gt;comment_author ) ) . &#039;&lt;/h4&gt;&#039;;
					echo &#039;&lt;blockquote&gt;&#039; . wp_kses_data( $comment-&gt;comment_content ) . &#039;&lt;/blockquote&gt;&lt;/li&gt;&#039;;

				}
				echo &#039;&lt;/ul&gt;&#039;;
			} else {
				echo &#039;&lt;p&gt;&#039; . esc_html__( &#039;There are no product reviews yet.&#039;, &#039;woocommerce&#039; ) . &#039;&lt;/p&gt;&#039;;
			}
		}

		/**
		 * Network orders widget.
		 */
		public function network_orders() {
			$suffix  = Constants::is_true( &#039;SCRIPT_DEBUG&#039; ) ? &#039;&#039; : &#039;.min&#039;;
			$version = Constants::get_constant( &#039;WC_VERSION&#039; );

			wp_enqueue_style( &#039;wc-network-orders&#039;, WC()-&gt;plugin_url() . &#039;/assets/css/network-order-widget.css&#039;, array(), $version );

			wp_enqueue_script( &#039;wc-network-orders&#039;, WC()-&gt;plugin_url() . &#039;/assets/js/admin/network-orders&#039; . $suffix . &#039;.js&#039;, array( &#039;jquery&#039;, &#039;underscore&#039; ), $version, true );

			$user     = wp_get_current_user();
			$blogs    = get_blogs_of_user( $user-&gt;ID );
			$blog_ids = wp_list_pluck( $blogs, &#039;userblog_id&#039; );

			wp_localize_script(
				&#039;wc-network-orders&#039;,
				&#039;woocommerce_network_orders&#039;,
				array(
					&#039;nonce&#039;          =&gt; wp_create_nonce( &#039;wp_rest&#039; ),
					&#039;sites&#039;          =&gt; array_values( $blog_ids ),
					&#039;order_endpoint&#039; =&gt; get_rest_url( null, &#039;wc/v3/orders/network&#039; ),
				)
			);
			?&gt;
			&lt;div class=&quot;post-type-shop_order&quot;&gt;
			&lt;div id=&quot;woocommerce-network-order-table-loading&quot; class=&quot;woocommerce-network-order-table-loading is-active&quot;&gt;
				&lt;p&gt;
					&lt;span class=&quot;spinner is-active&quot;&gt;&lt;/span&gt; &lt;?php esc_html_e( &#039;Loading network orders&#039;, &#039;woocommerce&#039; ); ?&gt;
				&lt;/p&gt;

			&lt;/div&gt;
			&lt;table id=&quot;woocommerce-network-order-table&quot; class=&quot;woocommerce-network-order-table&quot;&gt;
				&lt;thead&gt;
					&lt;tr&gt;
						&lt;td&gt;&lt;?php esc_html_e( &#039;Order&#039;, &#039;woocommerce&#039; ); ?&gt;&lt;/td&gt;
						&lt;td&gt;&lt;?php esc_html_e( &#039;Status&#039;, &#039;woocommerce&#039; ); ?&gt;&lt;/td&gt;
						&lt;td&gt;&lt;?php esc_html_e( &#039;Total&#039;, &#039;woocommerce&#039; ); ?&gt;&lt;/td&gt;
					&lt;/tr&gt;
				&lt;/thead&gt;
				&lt;tbody id=&quot;network-orders-tbody&quot;&gt;

				&lt;/tbody&gt;
			&lt;/table&gt;
			&lt;div id=&quot;woocommerce-network-orders-no-orders&quot; class=&quot;woocommerce-network-orders-no-orders&quot;&gt;
				&lt;p&gt;
					&lt;?php esc_html_e( &#039;No orders found&#039;, &#039;woocommerce&#039; ); ?&gt;
				&lt;/p&gt;
			&lt;/div&gt;
			&lt;?php // @codingStandardsIgnoreStart ?&gt;
			&lt;script type=&quot;text/template&quot; id=&quot;network-orders-row-template&quot;&gt;
				&lt;tr&gt;
					&lt;td&gt;
						&lt;a href=&quot;&lt;%- edit_url %&gt;&quot; class=&quot;order-view&quot;&gt;&lt;strong&gt;#&lt;%- number %&gt; &lt;%- customer %&gt;&lt;/strong&gt;&lt;/a&gt;
						&lt;br&gt;
						&lt;em&gt;
							&lt;%- blog.blogname %&gt;
						&lt;/em&gt;
					&lt;/td&gt;
					&lt;td&gt;
						&lt;mark class=&quot;order-status status-&lt;%- status %&gt;&quot;&gt;&lt;span&gt;&lt;%- status_name %&gt;&lt;/span&gt;&lt;/mark&gt;
					&lt;/td&gt;
					&lt;td&gt;
						&lt;%= formatted_total %&gt;
					&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/script&gt;
			&lt;?php // @codingStandardsIgnoreEnd ?&gt;
		&lt;/div&gt;
			&lt;?php
		}

		/**
		 * Gets the sales performance data from the new WooAdmin store.
		 *
		 * @return stdClass|WP_Error|WP_REST_Response
		 */
		private function get_wc_admin_performance_data() {
			$request    = new \WP_REST_Request( &#039;GET&#039;, &#039;/wc-analytics/reports/performance-indicators&#039; );
			$start_date = gmdate( &#039;Y-m-01 00:00:00&#039;, current_time( &#039;timestamp&#039; ) );
			$end_date   = gmdate( &#039;Y-m-d 23:59:59&#039;, current_time( &#039;timestamp&#039; ) );
			$request-&gt;set_query_params(
				array(
					&#039;before&#039; =&gt; $end_date,
					&#039;after&#039;  =&gt; $start_date,
					&#039;stats&#039;  =&gt; &#039;revenue/total_sales,revenue/net_revenue,orders/orders_count,products/items_sold,variations/items_sold&#039;,
				)
			);
			$response = rest_do_request( $request );

			if ( is_wp_error( $response ) ) {
				return $response;
			}

			if ( 200 !== $response-&gt;get_status() ) {
				return new \WP_Error( &#039;woocommerce_analytics_performance_indicators_result_failed&#039;, __( &#039;Sorry, fetching performance indicators failed.&#039;, &#039;woocommerce&#039; ) );
			}
			$report_keys      = array(
				&#039;net_revenue&#039; =&gt; &#039;net_sales&#039;,
			);
			$performance_data = new stdClass();
			foreach ( $response-&gt;get_data() as $indicator ) {
				if ( isset( $indicator[&#039;chart&#039;] ) &amp;&amp; isset( $indicator[&#039;value&#039;] ) ) {
					$key                    = isset( $report_keys[ $indicator[&#039;chart&#039;] ] ) ? $report_keys[ $indicator[&#039;chart&#039;] ] : $indicator[&#039;chart&#039;];
					$performance_data-&gt;$key = $indicator[&#039;value&#039;];
				}
			}
			return $performance_data;
		}

		/**
		 * Overwrites the original sparkline to use the new reports data if WooAdmin is enabled.
		 * Prepares a sparkline to show sales in the last X days.
		 *
		 * @param  WC_Admin_Report $reports old class for getting reports.
		 * @param  bool            $is_wc_admin_disabled If WC Admin is disabled or not.
		 * @param  int             $id ID of the product to show. Blank to get all orders.
		 * @param  string          $type Type of sparkline to get. Ignored if ID is not set.
		 * @return string
		 */
		private function sales_sparkline( $reports, $is_wc_admin_disabled = false, $id = &#039;&#039;, $type = &#039;sales&#039; ) {
			$days = max( 7, gmdate( &#039;d&#039;, current_time( &#039;timestamp&#039; ) ) );
			if ( $is_wc_admin_disabled ) {
				return $reports-&gt;sales_sparkline( $id, $days, $type );
			}
			$sales_endpoint = &#039;/wc-analytics/reports/revenue/stats&#039;;
			$start_date     = gmdate( &#039;Y-m-d 00:00:00&#039;, current_time( &#039;timestamp&#039; ) - ( ( $days - 1 ) * DAY_IN_SECONDS ) );
			$end_date       = gmdate( &#039;Y-m-d 23:59:59&#039;, current_time( &#039;timestamp&#039; ) );
			$meta_key       = &#039;net_revenue&#039;;
			$params         = array(
				&#039;order&#039;    =&gt; &#039;asc&#039;,
				&#039;interval&#039; =&gt; &#039;day&#039;,
				&#039;per_page&#039; =&gt; 100,
				&#039;before&#039;   =&gt; $end_date,
				&#039;after&#039;    =&gt; $start_date,
			);
			if ( $id ) {
				$sales_endpoint     = &#039;/wc-analytics/reports/products/stats&#039;;
				$meta_key           = ( &#039;sales&#039; === $type ) ? &#039;net_revenue&#039; : &#039;items_sold&#039;;
				$params[&#039;products&#039;] = $id;
			}
			$request          = new \WP_REST_Request( &#039;GET&#039;, $sales_endpoint );
			$params[&#039;fields&#039;] = array( $meta_key );
			$request-&gt;set_query_params( $params );

			$response = rest_do_request( $request );

			if ( is_wp_error( $response ) ) {
				return $response;
			}

			$resp_data = $response-&gt;get_data();
			$data      = $resp_data[&#039;intervals&#039;];

			$sparkline_data = array();
			$total          = 0;
			foreach ( $data as $d ) {
				$total += $d[&#039;subtotals&#039;]-&gt;$meta_key;
				array_push( $sparkline_data, array( strval( strtotime( $d[&#039;interval&#039;] ) * 1000 ), $d[&#039;subtotals&#039;]-&gt;$meta_key ) );
			}

			if ( &#039;sales&#039; === $type ) {
				/* translators: 1: total income 2: days */
				$tooltip = sprintf( __( &#039;Sold %1$s worth in the last %2$d days&#039;, &#039;woocommerce&#039; ), strip_tags( wc_price( $total ) ), $days );
			} else {
				/* translators: 1: total items sold 2: days */
				$tooltip = sprintf( _n( &#039;Sold %1$d item in the last %2$d days&#039;, &#039;Sold %1$d items in the last %2$d days&#039;, $total, &#039;woocommerce&#039; ), $total, $days );
			}

			return &#039;&lt;span class=&quot;wc_sparkline &#039; . ( ( &#039;sales&#039; === $type ) ? &#039;lines&#039; : &#039;bars&#039; ) . &#039; tips&quot; data-color=&quot;#777&quot; data-tip=&quot;&#039; . esc_attr( $tooltip ) . &#039;&quot; data-barwidth=&quot;&#039; . 60 * 60 * 16 * 1000 . &#039;&quot; data-sparkline=&quot;&#039; . wc_esc_json( wp_json_encode( $sparkline_data ) ) . &#039;&quot;&gt;&lt;/span&gt;&#039;;
		}
	}

endif;

return new WC_Admin_Dashboard();
</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>WooCommerce Code Reference API documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on July 12th, 2021 at 10:33 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1626085993"></script>
    <script src="../js/search.js?updated=1626085993"></script>
</body>
</html>
